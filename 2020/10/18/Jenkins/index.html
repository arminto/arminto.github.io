<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Jenkins | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="article">
<meta property="og:title" content="Jenkins">
<meta property="og:url" content="http://example.com/2020/10/18/Jenkins/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk0l7abysmj317w0hkjug.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk0lbc8ow8j31660u0tdw.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk0le38t6bj315z0u0gn7.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwgy1gk0lf5irtsj31fc0u01kx.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwgy1gk0ll4nclyj31jm0dqk23.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk0ls1abibj324g0ogn3f.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk0ltol3j0j30y007bq4f.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk0ogw7t02j30x40cmgq0.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk0lxsqolej30rk09paa7.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk0lzu7mf0j31ca0du0su.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk0m1dhr5dj31cg0ket8w.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk0n4h5w85j30mu09z0sn.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk0m3aihdrj319k0k8jrl.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk0m4f98m1j317c0egaa7.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk0m6y6dprj319y042t8k.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk0m7pkvwyj314k01ojrf.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk0m88fn58j314q0303ys.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk0n6y9wcxj30n10crgml.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk0m9o50hzj315i02yglq.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk0maurt4jj3150050t9d.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk0nebuy32j30n00fsq3v.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk0mce1pthj313m0m6juv.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk0mcv7un7j315k0740t9.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk0mdi40f8j313y0u078b.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk0mf0ul5oj315c034mxl.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk0meuxspqj314y01omwz.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk0mfo0kruj318o01gwei.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk0mhowd34j31ea0nwaea.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk0ngi9j2fj30zw0jmjsb.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk0nfx95i4j30r50g1q31.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk0nhdik5xj30zw0pcgmt.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk0nhulxqmj310f0pc3zx.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk0nibjyblj30zx0pcmz1.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk0nlcxs9yj30v60ka40d.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk0nlrnw85j30v60aejtf.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk0nm1z7esj310c0m9gml.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk0nmh1pu8j310f0mbdhl.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk0nmqxgnzj310f0mk0u7.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk0nn31cryj30oa03gt8z.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk0nnn9g29j30v60a7dgm.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk0nny0mx4j30ql07xwfe.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk0noizvxqj30v60j6acr.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk0nos1n4oj310f0jp75h.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk0np6qtyfj30v60iitai.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk0nprd7e7j30v606p3z6.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk0nq10736j310f0drgme.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk0nql72spj30ri0c1q3g.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk0nqzmv5rj30sx0i2gmk.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk8x32qcxej310f0drjs0.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk8x5sc6wtj30ri0c1jrr.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk0nqzmv5rj30sx0i2gmk.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk8xamlaa3j31ca07emyk.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk8xjddd6kj31400k6t9v.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk8xg4tjroj31ak0ka75t.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk8xhf93ofj31ao0km3zz.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk8xi4t072j31du0leq4d.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk8xin4h4rj31ei0cadgf.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk8xhf93ofj31ao0km3zz.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk8xi4t072j31du0leq4d.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk8xin4h4rj31ei0cadgf.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk8xi4t072j31du0leq4d.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk8xin4h4rj31ei0cadgf.jpg">
<meta property="article:published_time" content="2020-10-18T10:10:26.000Z">
<meta property="article:modified_time" content="2021-06-05T14:43:31.219Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="DevOps">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://tva1.sinaimg.cn/large/0081Kckwly1gk0l7abysmj317w0hkjug.jpg">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-Jenkins" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/10/18/Jenkins/" class="article-date">
  <time class="dt-published" datetime="2020-10-18T10:10:26.000Z" itemprop="datePublished">2020-10-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      Jenkins
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <!--toc-->
<span id="more"></span>

<h1 id="一、持续集成、持续交付、持续部署"><a href="#一、持续集成、持续交付、持续部署" class="headerlink" title="一、持续集成、持续交付、持续部署"></a>一、持续集成、持续交付、持续部署</h1><h2 id="1-简介："><a href="#1-简介：" class="headerlink" title="1. 简介："></a>1. 简介：</h2><p>软件开发周期中需要一些可以帮助开发者提升速度的自动化工具。其中工具最重要的目的是促进软件项目的持续集成与交付。通过CI/CD工具，开发团队可以保持软件更新并将其迅速的投入实践中。CI/CD也被认为是敏捷开发的最重要实践。</p>
<h2 id="2-持续集成-CI"><a href="#2-持续集成-CI" class="headerlink" title="2. 持续集成(CI)"></a>2. 持续集成(CI)</h2><p><strong>概述：持续集成指的是，频繁地（一天多次）将代码集成到主干</strong></p>
<ul>
<li>持续集成（Continuous integration，简称CI），一种软件开发实践，即团队开发成员经常集成他们的工作，通过每个成员每天至少集成一次，也就意味着每天可能会发生多次集成。每次集成都通过自动化的构建 (包括推送代码，自动化集成，自动化测试，返回结果) 来验证，从而尽早地发现集成错误。</li>
<li>整体流程：推送代码  – &gt; 集成代码 – &gt; 构建 –&gt; 代码测试 – &gt; 反馈结果</li>
<li>持续集成的最终目的就是 让产品可以快速迭代，同时还能保持高质量，简化工作流程<br><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk0l7abysmj317w0hkjug.jpg"></li>
</ul>
<h2 id="3-持续交付-CD"><a href="#3-持续交付-CD" class="headerlink" title="3. 持续交付(CD)"></a>3. 持续交付(CD)</h2><p><strong>概述：持续 将通过持续集成后的代码进行手动部署</strong></p>
<ul>
<li>持续交付（Continuous Delivery, CD）是一种软件工程的手段，让软件在短周期内产出，确保软件随时可以被可靠地发布。其目的在于更快、更频繁地构建、测试以及发布软件。通过加强对生产环境的应用进行渐进式更新，这种手段可以降低交付变更的成本与风险。一个简单直观的与可重复的部署过程对于持续交付来说是很重要的。</li>
<li>整体流程：推送代码 – &gt; 集成代码 – &gt; 构建 –&gt; 代码测试 — &gt; 反馈结果  –&gt; 测试 –&gt; 手动 –&gt; 部署到生产</li>
<li>持续交付指的是在持续集成后的环境基础之上，将代码部署到预生产环境上。<br><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk0lbc8ow8j31660u0tdw.jpg"></li>
</ul>
<h2 id="4-持续部署（CD）"><a href="#4-持续部署（CD）" class="headerlink" title="4. 持续部署（CD）"></a>4. 持续部署（CD）</h2><p><strong>概述：基于 集成 交付之上的，部署和交付的区别在于 无论何时 代码都是可以部署的 没有问题的</strong></p>
<ul>
<li>持续部署（Continuous Deployment，缩写为 CD）是持续交付的下一步，指的是代码通过评审以后，自动部署到生产环境；持续部署的目标是，代码在任何时刻都是可部署的，可以进入生产阶段。</li>
<li>持续部署指的是持续交付的下一步，指代码可以在任何时刻都是可以部署的 没问题的，最后部署到生产环境下的过程</li>
<li>整体流程：推送代码 – &gt; 集成代码 – &gt; 构建 –&gt; 代码测试 — &gt; 反馈结果  –&gt; 测试 –&gt; 自动 –&gt; 部署到生产<br><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk0le38t6bj315z0u0gn7.jpg"></li>
</ul>
<h2 id="5-集成-amp-交付软件"><a href="#5-集成-amp-交付软件" class="headerlink" title="5. 集成 &amp; 交付软件"></a>5. 集成 &amp; 交付软件</h2><p><strong>概述：典型的部署流水线，CD 流水线由几个不同的阶段组成; 一个工具不能满足所有这些步骤。</strong><br><img src="https://tva1.sinaimg.cn/large/0081Kckwgy1gk0lf5irtsj31fc0u01kx.jpg"></p>
<h1 id="二、Git版本控制器"><a href="#二、Git版本控制器" class="headerlink" title="二、Git版本控制器"></a>二、Git版本控制器</h1><h2 id="1-Git架构图"><a href="#1-Git架构图" class="headerlink" title="1. Git架构图"></a>1. Git架构图</h2><p><img src="https://tva1.sinaimg.cn/large/0081Kckwgy1gk0ll4nclyj31jm0dqk23.jpg" alt="image-20201024182607375"></p>
<h2 id="2-四个区域和五种状态"><a href="#2-四个区域和五种状态" class="headerlink" title="2. 四个区域和五种状态"></a>2. 四个区域和五种状态</h2><h3 id="2-1-四个区域"><a href="#2-1-四个区域" class="headerlink" title="2.1 四个区域"></a>2.1 四个区域</h3><ul>
<li>工作区(Working Area)</li>
<li>暂存区(Stage)</li>
<li>本地仓库(Local Repository)</li>
<li>远程仓库(Remote Repository)</li>
</ul>
<h3 id="2-2-五种状态"><a href="#2-2-五种状态" class="headerlink" title="2.2 五种状态"></a>2.2 五种状态</h3><ul>
<li>未修改(Origin)</li>
<li>已修改(Modified)&amp;未追踪(Untracked)</li>
<li>已暂存(Staged)</li>
<li>已提交(Committed)</li>
<li>已推送(Pushed)</li>
</ul>
<h2 id="3-安装git"><a href="#3-安装git" class="headerlink" title="3. 安装git"></a>3. 安装git</h2><p><strong>随便打开一台虚拟机用来练习git的使用</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@git ~]<span class="comment"># yum -y install git</span></span><br></pre></td></tr></table></figure>

<h2 id="4-常见的-Git-命令："><a href="#4-常见的-Git-命令：" class="headerlink" title="4. 常见的 Git 命令："></a>4. 常见的 Git 命令：</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">开始一个工作区（参见：git <span class="built_in">help</span> tutorial）</span><br><span class="line">   <span class="built_in">clone</span>      克隆一个仓库到一个新目录</span><br><span class="line">   init       创建一个空的 Git 仓库或重新初始化一个已存在的仓库</span><br><span class="line"></span><br><span class="line">在当前变更上工作（参见：git <span class="built_in">help</span> everyday）</span><br><span class="line">   add        添加文件内容至索引</span><br><span class="line">   mv         移动或重命名一个文件、目录或符号链接</span><br><span class="line">   reset      重置当前 HEAD 到指定状态</span><br><span class="line">   rm         从工作区和索引中删除文件</span><br><span class="line"></span><br><span class="line">检查历史和状态（参见：git <span class="built_in">help</span> revisions）</span><br><span class="line">   bisect     通过二分查找定位引入 bug 的提交</span><br><span class="line">   grep       输出和模式匹配的行</span><br><span class="line">   <span class="built_in">log</span>        显示提交日志</span><br><span class="line">   show       显示各种类型的对象</span><br><span class="line">   status     显示工作区状态</span><br><span class="line"></span><br><span class="line">扩展、标记和调校您的历史记录</span><br><span class="line">   branch     列出、创建或删除分支</span><br><span class="line">   checkout   切换分支或恢复工作区文件</span><br><span class="line">   commit     记录变更到仓库</span><br><span class="line">   diff       显示提交之间、提交和工作区之间等的差异</span><br><span class="line">   merge      合并两个或更多开发历史</span><br><span class="line">   rebase     本地提交转移至更新后的上游分支中</span><br><span class="line">   tag        创建、列出、删除或校验一个 GPG 签名的标签对象</span><br><span class="line"></span><br><span class="line">协同（参见：git <span class="built_in">help</span> workflows）</span><br><span class="line">   fetch      从另外一个仓库下载对象和引用</span><br><span class="line">   pull       获取并整合另外的仓库或一个本地分支</span><br><span class="line">   push       更新远程引用和相关的对象</span><br></pre></td></tr></table></figure>

<h2 id="5-配置git"><a href="#5-配置git" class="headerlink" title="5. 配置git"></a>5. 配置git</h2><p><strong>你是谁，你的邮箱是什么。这样就知道是谁提交的代码了</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@git ~]<span class="comment"># git config --global user.name &quot;lemon&quot;                     #名字</span></span><br><span class="line">[root@git ~]<span class="comment"># git config --global user.email &quot;lemon_row@163.com&quot;        #邮箱</span></span><br><span class="line">[root@git ~]<span class="comment"># git config --global color.ui true                         #颜色</span></span><br></pre></td></tr></table></figure>

<h2 id="6-检查配置信息"><a href="#6-检查配置信息" class="headerlink" title="6. 检查配置信息"></a>6. 检查配置信息</h2><p><strong>这个 <code>.gitconfig</code> 是在你当前的家目录下的一个隐藏文件</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@git ~]<span class="comment"># cat .gitconfig </span></span><br><span class="line">[user]</span><br><span class="line">	name = lemon</span><br><span class="line">	email = lemon_row@163.com</span><br><span class="line">[color]</span><br><span class="line">	ui = <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h2 id="7-基本使用案例"><a href="#7-基本使用案例" class="headerlink" title="7. 基本使用案例"></a>7. 基本使用案例</h2><h3 id="7-1-实战（一）git如何快速的提交目录文件至本地仓库？"><a href="#7-1-实战（一）git如何快速的提交目录文件至本地仓库？" class="headerlink" title="7.1 实战（一）git如何快速的提交目录文件至本地仓库？"></a>7.1 实战（一）git如何快速的提交目录文件至本地仓库？</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">[root@git ~]<span class="comment"># mkdir project &amp;&amp; cd project    #创建git工作目录</span></span><br><span class="line">[root@git project]<span class="comment"># git init                 #初始化该目录为git本地仓库</span></span><br><span class="line">初始化空的 Git 版本库于 /root/project/.git/</span><br><span class="line"></span><br><span class="line">[root@git project]<span class="comment"># ls -a                   #初始化成功后会在该目录下生成一个.git的隐藏目录</span></span><br><span class="line">.  ..  .git</span><br><span class="line"></span><br><span class="line">[root@git project]<span class="comment"># touch file&#123;1..3&#125;.txt     #创建三个文件</span></span><br><span class="line"></span><br><span class="line">[root@git project]<span class="comment"># ls</span></span><br><span class="line">file1.txt  file2.txt  file3.txt</span><br><span class="line"></span><br><span class="line">[root@git project]<span class="comment"># git status               #查看暂存区状态</span></span><br><span class="line"><span class="comment"># 位于分支 master</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 初始提交</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 未跟踪的文件:</span></span><br><span class="line"><span class="comment">#   （使用 &quot;git add &lt;file&gt;...&quot; 以包含要提交的内容）</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#	file1.txt</span></span><br><span class="line"><span class="comment">#	file2.txt</span></span><br><span class="line"><span class="comment">#	file3.txt</span></span><br><span class="line">提交为空，但是存在尚未跟踪的文件（使用 <span class="string">&quot;git add&quot;</span> 建立跟踪）</span><br><span class="line"></span><br><span class="line">[root@git project]<span class="comment"># git add .                #将文件添加到暂存区</span></span><br><span class="line">[root@git project]<span class="comment"># git status               #查看暂存区状态</span></span><br><span class="line"><span class="comment"># 位于分支 master</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 初始提交</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 要提交的变更：</span></span><br><span class="line"><span class="comment">#   （使用 &quot;git rm --cached &lt;file&gt;...&quot; 撤出暂存区）</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#	新文件：    file1.txt</span></span><br><span class="line"><span class="comment">#	新文件：    file2.txt</span></span><br><span class="line"><span class="comment">#	新文件：    file3.txt</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line">[root@git project]<span class="comment"># git commit -m &quot;NOW 1 add --&gt; file1 file2 file3&quot;        #将其提交至本地仓库</span></span><br><span class="line">[master（根提交） 75b88ee] NOW 1 add --&gt; file1 file2 file3</span><br><span class="line"> 3 files changed, 0 insertions(+), 0 deletions(-)</span><br><span class="line"> create mode 100644 file1.txt</span><br><span class="line"> create mode 100644 file2.txt</span><br><span class="line"> create mode 100644 file3.txt</span><br><span class="line"></span><br><span class="line">[root@git project]<span class="comment"># git status</span></span><br><span class="line"><span class="comment"># 位于分支 master</span></span><br><span class="line">无文件要提交，干净的工作区</span><br></pre></td></tr></table></figure>
<h3 id="7-2-实战（二）git-如何将文件改名并重新提交到本地仓库？"><a href="#7-2-实战（二）git-如何将文件改名并重新提交到本地仓库？" class="headerlink" title="7.2 实战（二）git 如何将文件改名并重新提交到本地仓库？"></a>7.2 实战（二）git 如何将文件改名并重新提交到本地仓库？</h3><p>  第一种方法：使用 <code>git mv</code> 命令（推荐使用）</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@git project]<span class="comment"># git mv file1.txt file.txt     #修改file.txt文件名为file1.txt</span></span><br><span class="line">[root@git project]<span class="comment"># ls</span></span><br><span class="line">file2.txt  file3.txt  file.txt</span><br><span class="line">  </span><br><span class="line">[root@git project]<span class="comment"># git status</span></span><br><span class="line"><span class="comment"># 位于分支 master</span></span><br><span class="line"><span class="comment"># 要提交的变更：</span></span><br><span class="line"><span class="comment">#   （使用 &quot;git reset HEAD &lt;file&gt;...&quot; 撤出暂存区）</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#	重命名：    file1.txt -&gt; file.txt</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">[root@git project]<span class="comment"># git add .</span></span><br><span class="line">[root@git project]<span class="comment"># git status</span></span><br><span class="line"><span class="comment"># 位于分支 master</span></span><br><span class="line"><span class="comment"># 要提交的变更：</span></span><br><span class="line"><span class="comment">#   （使用 &quot;git reset HEAD &lt;file&gt;...&quot; 撤出暂存区）</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#	重命名：    file1.txt -&gt; file.txt</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">[root@git project]<span class="comment"># git commit -m &quot;NOW 2 rename file1 --&gt; file.txt&quot;</span></span><br><span class="line">[master dbff765] NOW 2 rename file1 --&gt; file.txt</span><br><span class="line"> 1 file changed, 0 insertions(+), 0 deletions(-)</span><br><span class="line"> rename file1.txt =&gt; file.txt (100%)</span><br><span class="line">  </span><br><span class="line">[root@git project]<span class="comment"># git status</span></span><br><span class="line"><span class="comment"># 位于分支 master</span></span><br><span class="line">无文件要提交，干净的工作区</span><br></pre></td></tr></table></figure>
<p>  第二种方法：使用 <code>mv</code> 命令（不推荐使用）</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[root@git project]<span class="comment"># mv file.txt file1.txt    #修改file1.txt文件名为file.txt</span></span><br><span class="line">[root@git project]<span class="comment"># ls</span></span><br><span class="line">file2.txt  file3.txt  file.txt</span><br><span class="line">  </span><br><span class="line">[root@git project]<span class="comment"># git status               #查看一下暂存区状态</span></span><br><span class="line"><span class="comment"># 位于分支 master</span></span><br><span class="line"><span class="comment"># 尚未暂存以备提交的变更：</span></span><br><span class="line"><span class="comment">#   （使用 &quot;git add/rm &lt;file&gt;...&quot; 更新要提交的内容）</span></span><br><span class="line"><span class="comment">#   （使用 &quot;git checkout -- &lt;file&gt;...&quot; 丢弃工作区的改动）</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#	删除：      file.txt</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 未跟踪的文件:</span></span><br><span class="line"><span class="comment">#   （使用 &quot;git add &lt;file&gt;...&quot; 以包含要提交的内容）</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#	file1.txt</span></span><br><span class="line">修改尚未加入提交（使用 <span class="string">&quot;git add&quot;</span> 和/或 <span class="string">&quot;git commit -a&quot;</span>）</span><br><span class="line">  </span><br><span class="line">[root@git project]<span class="comment"># git rm file.txt</span></span><br><span class="line">rm <span class="string">&#x27;file.txt&#x27;</span></span><br><span class="line">  </span><br><span class="line">[root@git project]<span class="comment"># git add file1.txt</span></span><br><span class="line">  </span><br><span class="line">[root@git project]<span class="comment"># git status</span></span><br><span class="line"><span class="comment"># 位于分支 master</span></span><br><span class="line"><span class="comment"># 要提交的变更：</span></span><br><span class="line"><span class="comment">#   （使用 &quot;git reset HEAD &lt;file&gt;...&quot; 撤出暂存区）</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#	重命名：    file.txt -&gt; file1.txt</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">  </span><br><span class="line">[root@git project]<span class="comment"># git commit -m &quot;NOW 3 rename file --&gt; file1.txt&quot;</span></span><br><span class="line">[master 6e97421] NOW 3 rename file --&gt; file1.txt</span><br><span class="line"> 1 file changed, 0 insertions(+), 0 deletions(-)</span><br><span class="line"> rename file.txt =&gt; file1.txt (100%)</span><br><span class="line"> </span><br><span class="line">[root@git project]<span class="comment"># git status</span></span><br><span class="line"><span class="comment"># 位于分支 master</span></span><br><span class="line">无文件要提交，干净的工作区</span><br></pre></td></tr></table></figure>
<h3 id="7-3-实战（三）如何比对-工作目录文件内容、暂存区文件内容、本地仓库文件内容之间的差役？"><a href="#7-3-实战（三）如何比对-工作目录文件内容、暂存区文件内容、本地仓库文件内容之间的差役？" class="headerlink" title="7.3 实战（三）如何比对 工作目录文件内容、暂存区文件内容、本地仓库文件内容之间的差役？"></a>7.3 实战（三）如何比对 工作目录文件内容、暂存区文件内容、本地仓库文件内容之间的差役？</h3><p><strong>1、使用 <code>git diff</code> 命令来 比对 工作目录文件内容 与 暂存区文件内容</strong><br><strong>2、使用 <code>git diff --cached</code> 命令来 比对 暂存区文件内容、本地仓库文件内容</strong><br><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk0ls1abibj324g0ogn3f.jpg"><br>1.工作区 <code>file1</code> 内容 与 暂存区 <code>file1</code> 内容比较之间的差异</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#给file1.txt文件加点内容 后并 提交到本地仓库</span></span><br><span class="line">[root@git project]<span class="comment"># echo &#x27;aaaaa&#x27; &gt;&gt; file1.txt </span></span><br><span class="line">[root@git project]<span class="comment"># git add .</span></span><br><span class="line">[root@git project]<span class="comment"># git commit -m &quot;NOW 4 read-in file1.txt --&gt; aaaaa&quot;</span></span><br><span class="line">[master 3485684] NOW 4 read-in file1.txt --&gt; aaaaa</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"> </span><br><span class="line"><span class="comment">#给file1.txt文件加点内容 不提交</span></span><br><span class="line">[root@git project]<span class="comment"># echo &#x27;bbbbb&#x27; &gt;&gt; file1.txt </span></span><br><span class="line">[root@git project]<span class="comment"># git status</span></span><br><span class="line"><span class="comment"># 位于分支 master</span></span><br><span class="line"><span class="comment"># 尚未暂存以备提交的变更：</span></span><br><span class="line"><span class="comment">#   （使用 &quot;git add &lt;file&gt;...&quot; 更新要提交的内容）</span></span><br><span class="line"><span class="comment">#   （使用 &quot;git checkout -- &lt;file&gt;...&quot; 丢弃工作区的改动）</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#	修改：      file1.txt</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">修改尚未加入提交（使用 <span class="string">&quot;git add&quot;</span> 和/或 <span class="string">&quot;git commit -a&quot;</span>）</span><br><span class="line"></span><br><span class="line"><span class="comment">#工作区与暂存区比较差役</span></span><br><span class="line">[root@git project]<span class="comment"># git diff file1.txt</span></span><br><span class="line">diff --git a/file1.txt b/file1.txt</span><br><span class="line">index ccc3e7b..be4e668 100644</span><br><span class="line">--- a/file1.txt           <span class="comment">#表示变动前的版本</span></span><br><span class="line">+++ b/file1.txt           <span class="comment">#表示变动后的版本</span></span><br><span class="line">@@ -1 +1,2 @@</span><br><span class="line"> aaaaa</span><br><span class="line">+bbbbb                    <span class="comment">#加入的内容</span></span><br></pre></td></tr></table></figure>
<p>2.暂存区 <code>file1</code> 内容 与 本地仓库 <code>file1</code> 内容比较之间的差异</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#将其修改的文件添加到暂存区中</span></span><br><span class="line">[root@git project]<span class="comment"># git add .</span></span><br><span class="line">[root@git project]<span class="comment"># git diff file1.txt</span></span><br><span class="line">[root@git project]<span class="comment"># 这个时候可以看到，工作区 与 缓存区 已经保持抑一致了</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#暂存区与本地仓库比较差役</span></span><br><span class="line">[root@git project]<span class="comment"># git diff --cached file1.txt</span></span><br><span class="line">diff --git a/file1.txt b/file1.txt</span><br><span class="line">index ccc3e7b..be4e668 100644</span><br><span class="line">--- a/file1.txt</span><br><span class="line">+++ b/file1.txt</span><br><span class="line">@@ -1 +1,2 @@</span><br><span class="line"> aaaaa</span><br><span class="line">+bbbbb</span><br><span class="line"></span><br><span class="line"><span class="comment">#然后将其所有暂存区内容提交至本地仓库</span></span><br><span class="line">[root@git project]<span class="comment"># git commit -m &quot;NOW 5 read-in file1.txt --&gt; bbbbb&quot;</span></span><br><span class="line">[master fdf30db] NOW 5 read-in file1.txt --&gt; bbbbb</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line">[root@git project]<span class="comment"># </span></span><br><span class="line">[root@git project]<span class="comment"># git diff --cached file1.txt</span></span><br><span class="line">[root@git project]<span class="comment"># 此时可以看到，暂存区 与 本地仓库 已经保持抑一致了</span></span><br></pre></td></tr></table></figure>
<h3 id="7-4-实战（四）如何理解git-commit-提交操作？"><a href="#7-4-实战（四）如何理解git-commit-提交操作？" class="headerlink" title="7.4 实战（四）如何理解git  commit 提交操作？"></a>7.4 实战（四）如何理解git  commit 提交操作？</h3><p><strong>可以将其理解为虚拟机的快照功能，简单来说就是每次commit就是相当于对文件做了一次快照。</strong><br><strong>FQ：知道了commit相当于快照后，那如何得知该文件快照了多少次  都修改了哪些内容呢？</strong><br><strong>答：使用 <code>git log</code> 或者 <code>git reflog</code> 查看历史的commit快照记录</strong><br><strong>但是这种查看方式，输出的信息太过多余，我们可以使用 <code>--oneline</code> 选项</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看历史的git commit快照</span></span><br><span class="line">[root@git project]<span class="comment"># git log</span></span><br><span class="line">commit fdf30db3870322636d06b79a74ed5feb399213ea      <span class="comment">#commit的id编号（唯一的）</span></span><br><span class="line">Author: lemon &lt;lemon_row@163.com&gt;                    <span class="comment">#是谁提交的</span></span><br><span class="line">Date:   Wed May 20 09:55:33 2020 +0800               <span class="comment">#什么时间提交的</span></span><br><span class="line"></span><br><span class="line">    NOW 5 read-in file1.txt --&gt; bbbbb                <span class="comment">#提交的信息描述</span></span><br><span class="line"></span><br><span class="line">commit 34856846ee0540482ab21a3df4bf821dd2329961</span><br><span class="line">Author: lemon &lt;lemon_row@163.com&gt;</span><br><span class="line">Date:   Wed May 20 09:51:53 2020 +0800</span><br><span class="line"></span><br><span class="line">    NOW 4 read-in file1.txt --&gt; aaaaa</span><br><span class="line"></span><br><span class="line">commit 2b1c545d923502f1bfd20c25a3f58ff8519a44f0</span><br><span class="line">Author: lemon &lt;lemon_row@163.com&gt;</span><br><span class="line">Date:   Wed May 20 09:50:12 2020 +0800</span><br><span class="line"></span><br><span class="line">    NOW 3 rename file --&gt; file1.txt</span><br><span class="line"></span><br><span class="line">commit 0c943fc2c68773efea85a0ed0a26dcfbf973e351</span><br><span class="line">Author: lemon &lt;lemon_row@163.com&gt;</span><br><span class="line">Date:   Wed May 20 09:49:20 2020 +0800</span><br><span class="line"></span><br><span class="line">    NOW 2 rename file1 --&gt; file.txt</span><br><span class="line"></span><br><span class="line">commit 75b88eeb1dc16a54b6da9419f5d8e872b900df0e</span><br><span class="line">Author: lemon &lt;lemon_row@163.com&gt;</span><br><span class="line">Date:   Wed May 20 09:46:46 2020 +0800</span><br><span class="line"></span><br><span class="line">    NOW 1 add --&gt; file1 file2 file3</span><br><span class="line">(END)</span><br><span class="line"></span><br><span class="line"><span class="comment">##但是这种查看方式，输出的信息太过多余，我们可以使用--oneline选项</span></span><br><span class="line">[root@git project]<span class="comment"># git log --oneline</span></span><br><span class="line">fdf30db NOW 5 read-in file1.txt --&gt; bbbbb</span><br><span class="line">3485684 NOW 4 read-in file1.txt --&gt; aaaaa</span><br><span class="line">2b1c545 NOW 3 rename file --&gt; file1.txt</span><br><span class="line">0c943fc NOW 2 rename file1 --&gt; file.txt</span><br><span class="line">75b88ee NOW 1 add --&gt; file1 file2 file3</span><br><span class="line"></span><br><span class="line"><span class="comment">#还有git log -n 的方式，查看最近的n次快照</span></span><br><span class="line">[root@git project]<span class="comment"># git log --oneline -2</span></span><br><span class="line">c652338 NOW 7 read-in file1 ---&gt; ddddd</span><br><span class="line">f405afa NOW 6 read-in file1 ---&gt; ccccc</span><br></pre></td></tr></table></figure>
<h3 id="7-5-实战（五）git-保存了状态后，想回退怎么办？"><a href="#7-5-实战（五）git-保存了状态后，想回退怎么办？" class="headerlink" title="7.5 实战（五）git 保存了状态后，想回退怎么办？"></a>7.5 实战（五）git 保存了状态后，想回退怎么办？</h3><blockquote>
<p><strong>如果使用虚拟机的话，肯定想都不用想，直接还原快照就得了，那么 git 优势如何实现的呢？</strong></p>
</blockquote>
<p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk0ltol3j0j30y007bq4f.jpg"><br>1.如果本地工作目录修改文件错误像回退怎么办？【工作目录 与 暂存区的撤销】</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#误操作</span></span><br><span class="line">[root@git project]<span class="comment"># &gt; file1.txt</span></span><br><span class="line"></span><br><span class="line">[root@git project]<span class="comment"># git status</span></span><br><span class="line"><span class="comment"># 位于分支 master</span></span><br><span class="line"><span class="comment"># 尚未暂存以备提交的变更：</span></span><br><span class="line"><span class="comment">#   （使用 &quot;git add &lt;file&gt;...&quot; 更新要提交的内容）</span></span><br><span class="line"><span class="comment">#   （使用 &quot;git checkout -- &lt;file&gt;...&quot; 丢弃工作区的改动）</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#	修改：      file1.txt</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">修改尚未加入提交（使用 <span class="string">&quot;git add&quot;</span> 和/或 <span class="string">&quot;git commit -a&quot;</span>）</span><br><span class="line"></span><br><span class="line"><span class="comment">#丢弃工作区的改动（恢复）</span></span><br><span class="line">[root@git project]<span class="comment"># git checkout file1.txt</span></span><br><span class="line"></span><br><span class="line">[root@git project]<span class="comment"># git status</span></span><br><span class="line"><span class="comment"># 位于分支 master</span></span><br><span class="line">无文件要提交，干净的工作区</span><br><span class="line"></span><br><span class="line">[root@git project]<span class="comment"># cat file1.txt </span></span><br><span class="line">aaaaa</span><br><span class="line">bbbbb</span><br></pre></td></tr></table></figure>
<p>2.工作文件误操作提交至暂存区中该怎么办？</p>
<blockquote>
<p>使用 本地仓库 —  覆盖  —  暂存区  —  覆盖   —  工作仓库<br>git  reset  HEAD  文件名</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#误操作</span></span><br><span class="line">[root@git project]<span class="comment"># &gt; file1.txt </span></span><br><span class="line">[root@git project]<span class="comment"># git add .</span></span><br><span class="line">[root@git project]<span class="comment"># git status</span></span><br><span class="line"><span class="comment"># 位于分支 master</span></span><br><span class="line"><span class="comment"># 要提交的变更：</span></span><br><span class="line"><span class="comment">#   （使用 &quot;git reset HEAD &lt;file&gt;...&quot; 撤出暂存区）</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#	修改：      file1.txt</span></span><br><span class="line"></span><br><span class="line">[root@git project]<span class="comment"># git reset HEAD file1.txt     #取消这个暂存区的内容</span></span><br><span class="line">重置后撤出暂存区的变更：</span><br><span class="line">M	file1.txt</span><br><span class="line"></span><br><span class="line">[root@git project]<span class="comment"># git status</span></span><br><span class="line"><span class="comment"># 位于分支 master</span></span><br><span class="line"><span class="comment"># 尚未暂存以备提交的变更：</span></span><br><span class="line"><span class="comment">#   （使用 &quot;git add &lt;file&gt;...&quot; 更新要提交的内容）</span></span><br><span class="line"><span class="comment">#   （使用 &quot;git checkout -- &lt;file&gt;...&quot; 丢弃工作区的改动）</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#	修改：      file1.txt</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">修改尚未加入提交（使用 <span class="string">&quot;git add&quot;</span> 和/或 <span class="string">&quot;git commit -a&quot;</span>）</span><br><span class="line"></span><br><span class="line">[root@git project]<span class="comment"># git checkout file1.txt</span></span><br><span class="line"></span><br><span class="line">[root@git project]<span class="comment"># git status</span></span><br><span class="line"><span class="comment"># 位于分支 master</span></span><br><span class="line">无文件要提交，干净的工作区</span><br><span class="line"></span><br><span class="line">[root@git project]<span class="comment"># cat file1.txt </span></span><br><span class="line">aaaaa</span><br><span class="line">bbbbb</span><br></pre></td></tr></table></figure>
<h3 id="7-6-实战（六）回滚版本，回滚之前的版本-和-回滚之后的版本"><a href="#7-6-实战（六）回滚版本，回滚之前的版本-和-回滚之后的版本" class="headerlink" title="7.6 实战（六）回滚版本，回滚之前的版本 和 回滚之后的版本"></a>7.6 实战（六）回滚版本，回滚之前的版本 和 回滚之后的版本</h3><p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk0ogw7t02j30x40cmgq0.jpg"></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">[root@git project]<span class="comment"># echo &#x27;ccccc&#x27; &gt;&gt; file1.txt </span></span><br><span class="line">[root@git project]<span class="comment"># git add .</span></span><br><span class="line">[root@git project]<span class="comment"># git commit -m &quot;NOW 6 read-in file1 ---&gt; ccccc&quot;</span></span><br><span class="line"></span><br><span class="line">[root@git project]<span class="comment"># echo &#x27;ddddd&#x27; &gt;&gt; file1.txt </span></span><br><span class="line">[root@git project]<span class="comment"># git add .</span></span><br><span class="line">[root@git project]<span class="comment"># git commit -m &quot;NOW 7 read-in file1 ---&gt; ddddd&quot;</span></span><br><span class="line">[root@git project]<span class="comment"># cat file1.txt </span></span><br><span class="line">aaaaa</span><br><span class="line">bbbbb</span><br><span class="line">ccccc</span><br><span class="line">ddddd</span><br><span class="line"></span><br><span class="line"><span class="comment">#比如我就想回退到ccccc的版本（回滚之前的版本）</span></span><br><span class="line">[root@git project]<span class="comment"># git log --oneline</span></span><br><span class="line">c652338 NOW 7 read-in file1 ---&gt; ddddd</span><br><span class="line">f405afa NOW 6 read-in file1 ---&gt; ccccc            <span class="comment">#使用前面第一段commit的id进行回滚操作</span></span><br><span class="line">fdf30db NOW 5 read-in file1.txt --&gt; bbbbb</span><br><span class="line">3485684 NOW 4 read-in file1.txt --&gt; aaaaa</span><br><span class="line">2b1c545 NOW 3 rename file --&gt; file1.txt</span><br><span class="line">0c943fc NOW 2 rename file1 --&gt; file.txt</span><br><span class="line">75b88ee NOW 1 add --&gt; file1 file2 file3</span><br><span class="line"></span><br><span class="line">[root@git project]<span class="comment"># git reset --hard f405afa      #回滚</span></span><br><span class="line">HEAD 现在位于 f405afa NOW 6 read-in file1 ---&gt; ccccc</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看是否已经回到这个版本</span></span><br><span class="line">[root@git project]<span class="comment"># git rev-parse HEAD</span></span><br><span class="line">f405afac0930c1feb0ee86cfa8b4c6032afd4b69</span><br><span class="line">[root@git project]<span class="comment"># cat file1.txt</span></span><br><span class="line">aaaaa</span><br><span class="line">bbbbb</span><br><span class="line">ccccc</span><br><span class="line"></span><br><span class="line"><span class="comment">#但是，有个问题，此时我又想回到ddddd的版本怎么办？（回滚之后的版本）</span></span><br><span class="line">[root@git project]<span class="comment"># git log --oneline    #这次会发现ddddd的版本消失了</span></span><br><span class="line">f405afa NOW 6 read-in file1 ---&gt; ccccc</span><br><span class="line">fdf30db NOW 5 read-in file1.txt --&gt; bbbbb</span><br><span class="line">3485684 NOW 4 read-in file1.txt --&gt; aaaaa</span><br><span class="line">2b1c545 NOW 3 rename file --&gt; file1.txt</span><br><span class="line">0c943fc NOW 2 rename file1 --&gt; file.txt</span><br><span class="line">75b88ee NOW 1 add --&gt; file1 file2 file3</span><br><span class="line"></span><br><span class="line"><span class="comment">#答：使用git reflog</span></span><br><span class="line">[root@git project]<span class="comment"># git reflog</span></span><br><span class="line">f405afa HEAD@&#123;0&#125;: reset: moving to f405afa</span><br><span class="line">c652338 HEAD@&#123;1&#125;: commit: NOW 7 read-in file1 ---&gt; ddddd           <span class="comment">#这次就可以找到了</span></span><br><span class="line">f405afa HEAD@&#123;2&#125;: commit: NOW 6 read-in file1 ---&gt; ccccc</span><br><span class="line">fdf30db HEAD@&#123;3&#125;: commit: NOW 5 read-in file1.txt --&gt; bbbbb</span><br><span class="line">3485684 HEAD@&#123;4&#125;: commit: NOW 4 read-in file1.txt --&gt; aaaaa</span><br><span class="line">2b1c545 HEAD@&#123;5&#125;: commit: NOW 3 rename file --&gt; file1.txt</span><br><span class="line">0c943fc HEAD@&#123;6&#125;: commit: NOW 2 rename file1 --&gt; file.txt</span><br><span class="line">75b88ee HEAD@&#123;7&#125;: commit (initial): NOW 1 add --&gt; file1 file2 file3</span><br><span class="line"></span><br><span class="line">[root@git project]<span class="comment"># git reset --hard c652338                       #在进行回滚</span></span><br><span class="line">HEAD 现在位于 c652338 NOW 7 read-in file1 ---&gt; ddddd</span><br><span class="line"></span><br><span class="line">[root@lemon project01]<span class="comment"># git rev-parse HEAD</span></span><br><span class="line">c652338f12a5102e9691dce3ecac4f57cf19639e</span><br><span class="line">[root@git project]<span class="comment"># cat file1.txt </span></span><br><span class="line">aaaaa</span><br><span class="line">bbbbb</span><br><span class="line">ccccc</span><br><span class="line">ddddd</span><br></pre></td></tr></table></figure>

<h2 id="8-Git-标签的-创建-删除"><a href="#8-Git-标签的-创建-删除" class="headerlink" title="8. Git 标签的 创建 删除"></a>8. Git 标签的 创建 删除</h2><ul>
<li><strong>git 标签能起到什么作用？</strong><br>当git仓库内的数据有改善或功能时，我们经常会打一个类似于软件版本号的tag标签，这样就能通过标签将版本库中的某个版本给记录下来，便于我们后续将特定时期的数据取出来用。<br>简单来说：标签也是一个版本库的一个快照，他与commit id 是绑定在一起的东西。</li>
<li><strong>为什么要使用git标签？既然都已经有了commit id了，为什么还要用tag标签？</strong><br>因为commit的id号不容易使人记忆，所以，使用tag标签就是因为他好记 <code>v1.0.0</code><br>绝大部分公司都是基于标签进行对代码版本的管理</li>
<li><strong>git 标签的基本使用</strong></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#为最新提交的代码创建标签</span></span><br><span class="line">[root@git project]<span class="comment"># git tag -a &quot;v1.0.0&quot; -m &quot;latest&quot;</span></span><br><span class="line">[root@git project]<span class="comment"># git tag             #查看当前分支的所有标签</span></span><br><span class="line">v1.0.0</span><br><span class="line"></span><br><span class="line">[root@git project]<span class="comment"># git show --oneline v1.0.0     #查看这个标签是基于哪个commit快照</span></span><br><span class="line">tag v1.0.0</span><br><span class="line"></span><br><span class="line">latest</span><br><span class="line">c652338 NOW 7 read-in file1 ---&gt; ddddd</span><br><span class="line">diff --git a/file1.txt b/file1.txt</span><br><span class="line">index d0bc53a..8dd8367 100644</span><br><span class="line">--- a/file1.txt</span><br><span class="line">+++ b/file1.txt</span><br><span class="line">@@ -1,3 +1,4 @@</span><br><span class="line"> aaaaa</span><br><span class="line"> bbbbb</span><br><span class="line"> ccccc</span><br><span class="line">+ddddd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#以指定的commit id 而创建标签</span></span><br><span class="line">[root@lemon project01]<span class="comment"># git log --oneline</span></span><br><span class="line">c652338 NOW 7 read-in file1 ---&gt; ddddd</span><br><span class="line">f405afa NOW 6 read-in file1 ---&gt; ccccc</span><br><span class="line">fdf30db NOW 5 read-in file1.txt --&gt; bbbbb</span><br><span class="line">3485684 NOW 4 read-in file1.txt --&gt; aaaaa</span><br><span class="line">2b1c545 NOW 3 rename file --&gt; file1.txt</span><br><span class="line">0c943fc NOW 2 rename file1 --&gt; file.txt</span><br><span class="line">75b88ee NOW 1 add --&gt; file1 file2 file3</span><br><span class="line"></span><br><span class="line">[root@git project]<span class="comment"># git tag -a &#x27;v1.0.1&#x27; f405afa -m &quot;NOW 6&quot;</span></span><br><span class="line">[root@git project]<span class="comment"># git tag</span></span><br><span class="line">v1.0.0</span><br><span class="line">v1.0.1</span><br><span class="line">[root@git project]<span class="comment"># git show v1.0.1</span></span><br><span class="line">tag v1.0.1</span><br><span class="line">Tagger: lemon &lt;lemon_row@163.com&gt;</span><br><span class="line">Date:   Wed May 20 11:16:03 2020 +0800</span><br><span class="line"></span><br><span class="line">NOW 6</span><br><span class="line"></span><br><span class="line">commit f405afac0930c1feb0ee86cfa8b4c6032afd4b69</span><br><span class="line">Author: lemon &lt;lemon_row@163.com&gt;</span><br><span class="line">Date:   Wed May 20 10:03:44 2020 +0800</span><br><span class="line"></span><br><span class="line">    NOW 6 read-in file1 ---&gt; ccccc</span><br><span class="line"></span><br><span class="line">diff --git a/file1.txt b/file1.txt</span><br><span class="line">index be4e668..d0bc53a 100644</span><br><span class="line">--- a/file1.txt</span><br><span class="line">+++ b/file1.txt</span><br><span class="line">@@ -1,2 +1,3 @@</span><br><span class="line"> aaaaa</span><br><span class="line"> bbbbb</span><br><span class="line">+ccccc</span><br><span class="line"></span><br><span class="line"><span class="comment">#不小心打错了标签，怎么删除这个标签？</span></span><br><span class="line">[root@git project]<span class="comment"># git tag -d v1.0.1</span></span><br><span class="line">已删除标签 <span class="string">&#x27;v1.0.1&#x27;</span>（曾为 608f0e6）</span><br><span class="line"></span><br><span class="line">[root@git project]<span class="comment"># git tag</span></span><br><span class="line">v1.0.0</span><br></pre></td></tr></table></figure>

<h2 id="9-Git-分支"><a href="#9-Git-分支" class="headerlink" title="9. Git 分支"></a>9. Git 分支</h2><h3 id="9-1-分支概念"><a href="#9-1-分支概念" class="headerlink" title="9.1 分支概念"></a>9.1 分支概念</h3><p>分支就是科幻电影里面的平行宇宙，当你正在电脑前努力学习Git的时候，另一个你正在另一个平行宇宙里努力学习SVN。<br>如果两个平行宇宙互不干扰，那对现在的你也没啥影响。不过，在某个时间点，两个平行宇宙合并了，结果，你既学会了Git又学会了SVN！<br><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk0lxsqolej30rk09paa7.jpg"></p>
<h3 id="9-2-创建与合并分支原理"><a href="#9-2-创建与合并分支原理" class="headerlink" title="9.2 创建与合并分支原理"></a>9.2 创建与合并分支原理</h3><p>每次提交，Git都把它们串成一条时间线，这条时间线就是一个分支。截止到目前，只有一条时间线，在Git里，这个分支叫主分支，即 <code>master</code> 分支。<code>HEAD</code>严格来说不是指向提交，而是指向<code>master</code>，<code>master</code>才是指向提交的，所以，<code>HEAD</code>指向的就是当前分支。<br>一开始的时候，<code>master</code>分支是一条线，Git用<code>master</code>指向最新的提交，再用<code>HEAD</code>指向<code>master</code>，就能确定当前分支，<strong>以及当前分支的提交点：</strong><br><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk0lzu7mf0j31ca0du0su.jpg"><br>每次提交，<code>master</code>分支都会向前移动一步，这样，随着你不断提交，<code>master</code>分支的线也越来越长，当我们创建新的分支，例如<code>dev</code>时，Git新建了一个指针叫<code>dev</code>，指向<code>master</code>相同的提交，再把<code>HEAD</code>指向<code>dev</code>，就表示当前分支在<code>dev</code>上：<br><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk0m1dhr5dj31cg0ket8w.jpg"><br>可以看到，Git创建一个分支很快，因为除了增加一个<code>dev</code>指针，改改<code>HEAD</code>的指向，工作区的文件都没有任何变化！<br>不过，从现在开始，对工作区的修改和提交就是针对<code>dev</code>分支了，比如新提交一次后，<code>dev</code>指针往前移动一步，<strong>而<code>master</code>指针不变：</strong><br><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk0n4h5w85j30mu09z0sn.jpg"><br>假如我们在<code>dev</code>上的工作完成了，就可以把<code>dev</code>合并到<code>master</code>上。Git怎么合并呢？最简单的方法，就是直接把<code>master</code>指向<code>dev</code>的当前提交，<strong>就完成了合并：</strong><br><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk0m3aihdrj319k0k8jrl.jpg"><br>所以Git合并分支也很快！就改改指针，工作区内容也不变！<br>合并完分支后，甚至可以删除<code>dev</code>分支。删除<code>dev</code>分支就是把<code>dev</code>指针给删掉，删掉后，<strong>我们就剩下了一条<code>master</code>分支：</strong><br><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk0m4f98m1j317c0egaa7.jpg"></p>
<h3 id="9-3-常见的分支命令"><a href="#9-3-常见的分支命令" class="headerlink" title="9.3 常见的分支命令"></a>9.3 常见的分支命令</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">//创建分支</span><br><span class="line">git branch &lt;name&gt;           <span class="comment">#基于当前commit创建test分支。.git/HEAD文件中记录了当前分支名字。</span></span><br><span class="line"></span><br><span class="line">//删除分支</span><br><span class="line">git branch -d <span class="built_in">test</span>     <span class="comment">#删除本地test分支</span></span><br><span class="line">git branch -D <span class="built_in">test</span>     <span class="comment">#test分支还没有合入当前分支，所以要用-D参数才能删掉。</span></span><br><span class="line">git push origin --delete <span class="built_in">test</span>    <span class="comment">#删除远程test分支</span></span><br><span class="line"></span><br><span class="line">//查看分支</span><br><span class="line">git branch                       <span class="comment">#列出当前分支清单</span></span><br><span class="line">git branch -v                    <span class="comment">#查看各个分支最后一个提交信息</span></span><br><span class="line">git branch -a                    <span class="comment">#查看远程分支和本地分支</span></span><br><span class="line">git branch --merged              <span class="comment">#查看哪些分支被合并</span></span><br><span class="line">git branch --no-merged           <span class="comment">#查看哪些分支未被合并</span></span><br><span class="line"></span><br><span class="line">//融合及切换分支</span><br><span class="line">git merge                        <span class="comment">#融合分支</span></span><br><span class="line">git checkout -b &lt;name&gt;           <span class="comment">#创建+切换分支</span></span><br><span class="line">git checkout                     <span class="comment">#切换分支</span></span><br><span class="line"></span><br><span class="line">//拉取分支</span><br><span class="line">git fetch origin                 <span class="comment">#同步远程服务器的数据到本地</span></span><br><span class="line">git checkout -b <span class="built_in">test</span> origin/test_remote     <span class="comment">#将远程分支test_remote拉取下来到本地test分支</span></span><br><span class="line">git checkout <span class="built_in">test</span>                <span class="comment">#将远程分支test拉取下来到本地test分支</span></span><br><span class="line">git pull <span class="built_in">test</span>                    <span class="comment">#从远程分支test中checkout下来的本地分支test成为跟踪分支，使用git pull或者git push就会操作到对应的远程分支test</span></span><br></pre></td></tr></table></figure>
<h3 id="9-4-分支的使用演示"><a href="#9-4-分支的使用演示" class="headerlink" title="9.4 分支的使用演示"></a>9.4 分支的使用演示</h3><blockquote>
<p>创建分支,开发新功能是不能在master分支上开发</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@git <span class="built_in">test</span>]<span class="comment"># git branch about            #创建about分支</span></span><br><span class="line">[root@git <span class="built_in">test</span>]<span class="comment"># git branch                  #查看分支</span></span><br></pre></td></tr></table></figure>
<p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk0m6y6dprj319y042t8k.jpg"></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@git <span class="built_in">test</span>]<span class="comment"># git checkout about          #切换分支</span></span><br></pre></td></tr></table></figure>
<p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk0m7pkvwyj314k01ojrf.jpg"></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@git <span class="built_in">test</span>]<span class="comment"># git status</span></span><br></pre></td></tr></table></figure>
<p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk0m88fn58j314q0303ys.jpg"></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@git <span class="built_in">test</span>]<span class="comment"># git log         #查看about分支的commit记录</span></span><br></pre></td></tr></table></figure>
<p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk0n6y9wcxj30n10crgml.jpg"></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@git <span class="built_in">test</span>]<span class="comment"># echo &quot;about us&quot; &gt;&gt; about.html         #在当前分支开发新功能</span></span><br></pre></td></tr></table></figure>
<p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk0m9o50hzj315i02yglq.jpg"></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@git <span class="built_in">test</span>]<span class="comment"># git add .</span></span><br><span class="line">[root@git <span class="built_in">test</span>]<span class="comment"># git commit -m &quot;about&quot;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk0maurt4jj3150050t9d.jpg"></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@git <span class="built_in">test</span>]<span class="comment"># git log         #查看about分支的commit记录</span></span><br></pre></td></tr></table></figure>
<p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk0nebuy32j30n00fsq3v.jpg"></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@git <span class="built_in">test</span>]<span class="comment"># git checkout master          #切换到master分支</span></span><br><span class="line">[root@git <span class="built_in">test</span>]<span class="comment"># git log                      #查看master分支的commit记录</span></span><br></pre></td></tr></table></figure>
<p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk0mce1pthj313m0m6juv.jpg"></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@git <span class="built_in">test</span>]<span class="comment"># git merge about               #在master分支上合并about分支</span></span><br><span class="line">//注意：在公司中可不是这么搞的，因为你不能保证master分支的线路会一直保持在原地，所以一般开发都是先在自己的分支上重新将master分支合并（相当于同步master分支内容），然后在测试有没有问题，没有问题后才会到master分支上将其开发好的分支合并到master上面，然后在删除合并到master的分支</span><br></pre></td></tr></table></figure>
<p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk0mcv7un7j315k0740t9.jpg"></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@git <span class="built_in">test</span>]<span class="comment"># git log &amp;&amp; ls</span></span><br></pre></td></tr></table></figure>
<p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk0mdi40f8j313y0u078b.jpg"></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@git <span class="built_in">test</span>]<span class="comment"># git branch test                  #创建test分支</span></span><br><span class="line">[root@git <span class="built_in">test</span>]<span class="comment"># git checkout test                #切换到test分支进行开发</span></span><br><span class="line">[root@git <span class="built_in">test</span>]<span class="comment"># echo &quot;test&quot; &gt; test.html</span></span><br><span class="line">[root@git <span class="built_in">test</span>]<span class="comment"># git add .</span></span><br><span class="line">[root@git <span class="built_in">test</span>]<span class="comment"># git commit -m &quot;test&quot;</span></span><br><span class="line"></span><br><span class="line">[root@git <span class="built_in">test</span>]<span class="comment"># git checkout master              #切换至master分支</span></span><br><span class="line">[root@git <span class="built_in">test</span>]<span class="comment"># git branch --merged              #查看已经合并的分支</span></span><br></pre></td></tr></table></figure>
<p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk0mf0ul5oj315c034mxl.jpg"></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@git <span class="built_in">test</span>]<span class="comment"># git branch --no-merged            #查看未合并的分支</span></span><br></pre></td></tr></table></figure>
<p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk0meuxspqj314y01omwz.jpg"></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@git <span class="built_in">test</span>]<span class="comment"># git branch -D test                #删除test分支</span></span><br></pre></td></tr></table></figure>
<p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk0mfo0kruj318o01gwei.jpg"></p>
<h3 id="9-5-分支冲突"><a href="#9-5-分支冲突" class="headerlink" title="9.5 分支冲突"></a>9.5 分支冲突</h3><p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk0mhowd34j31ea0nwaea.jpg"></p>
<h2 id="10-Git远程仓库-–-github"><a href="#10-Git远程仓库-–-github" class="headerlink" title="10. Git远程仓库 – github"></a>10. Git远程仓库 – github</h2><h3 id="10-1-github-是什么"><a href="#10-1-github-是什么" class="headerlink" title="10.1  github 是什么"></a>10.1  github 是什么</h3><p><code>GitHub</code>是一个面向开源及私有软件项目的托管平台，因为只支持git 作为唯一的版本库格式进行托管，故名<code>GitHub</code>。<br><code>GitHub</code>于2008年4月10日正式上线，除了Git代码仓库托管及基本的 Web管理界面以外，还提供了订阅、讨论组、文本渲染、在线文件编辑器、协作图谱（报表）、代码片段分享（Gist）等功能。目前，其注册用户已经超过350万，托管版本数量也是非常之多，其中不乏知名开源项目 Ruby on Rails、python 等。<br>对于我们个人的话，GIT服务器并不需要我们搭建，使用<code>github</code>就可以满足我们的需求。</p>
<h3 id="10-2-登陆-github"><a href="#10-2-登陆-github" class="headerlink" title="10.2 登陆 github"></a>10.2 登陆 github</h3><blockquote>
<p>官网：<a target="_blank" rel="noopener" href="https://github.com/">https://github.com/</a></p>
</blockquote>
<p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk0ngi9j2fj30zw0jmjsb.jpg"><br><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk0nfx95i4j30r50g1q31.jpg"></p>
<h3 id="10-3-创建远程仓库"><a href="#10-3-创建远程仓库" class="headerlink" title="10.3 创建远程仓库"></a>10.3 创建远程仓库</h3><p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk0nhdik5xj30zw0pcgmt.jpg"><br><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk0nhulxqmj310f0pc3zx.jpg"><br><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk0nibjyblj30zx0pcmz1.jpg"></p>
<ul>
<li><strong>说明：</strong><ul>
<li>code：代码</li>
<li>issues：问题</li>
<li>pull requests：拉取要求</li>
<li>Actions：动作</li>
<li>projects：专案</li>
<li>Wiki：维基</li>
<li>Security：安全</li>
<li>lnsights：见解</li>
<li>settings：设置</li>
</ul>
</li>
<li><strong>克隆仓库的两种协议：</strong><ul>
<li>https 协议：如果你这个仓库是私有的，克隆仓库时需要输入用户名 密码</li>
<li>ssh协议：需要在github上加入你机器上某个用户的ssh公钥才能使用</li>
</ul>
</li>
<li><strong>常用的git远程仓库命令</strong><ul>
<li>git  remote                                          #查看当前的远程库</li>
<li>git  remote  -v                                    #执行时加上 -v 参数，你还可以看到每个别名的实际链接地址。</li>
<li>git  remote  add  [别名]   url            #添加一个远程仓库</li>
<li>git  remote  rm    [别名]                   #删除远程仓库</li>
<li>git  push  -u  origin  master             #推送本地到远程分支</li>
<li>git  pull    -u  origin  master             #获取最新master代码到本地</li>
</ul>
</li>
</ul>
<h3 id="10-4-使用-GitHub"><a href="#10-4-使用-GitHub" class="headerlink" title="10.4 使用 GitHub"></a>10.4 使用 GitHub</h3><p><strong>这里 <code>https</code> 的我就不掩饰了，很简单，这里我使用ssh协议的，而且使用 <code>win10</code> 展示</strong><br><strong>为用户生成一个ssh的公钥 及 私钥 目录</strong><br><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk0nlcxs9yj30v60ka40d.jpg"><br><strong>将其 公钥 拷贝到 <code>github</code> 上</strong><br><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk0nlrnw85j30v60aejtf.jpg"><br><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk0nm1z7esj310c0m9gml.jpg"><br><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk0nmh1pu8j310f0mbdhl.jpg"><br><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk0nmqxgnzj310f0mk0u7.jpg"><br><strong>克隆远程仓库</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> git@github.com:lemonOps/project01.git </span><br></pre></td></tr></table></figure>
<p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk0nn31cryj30oa03gt8z.jpg"><br><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk0nnn9g29j30v60a7dgm.jpg"><br><strong>将本地仓库推送至远程仓库</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git remote add origin git@github.com:lemonOps/project01.git    <span class="comment">#添加好推送的仓库地址</span></span><br><span class="line"></span><br><span class="line">$ git  remote  -v              <span class="comment">#查看当前的远程仓库</span></span><br></pre></td></tr></table></figure>
<p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk0nny0mx4j30ql07xwfe.jpg"></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;# 第一次提交至远程仓库&quot;</span> &gt; README.md</span><br><span class="line"></span><br><span class="line">$ git add .</span><br><span class="line"></span><br><span class="line">$ git commit -m <span class="string">&quot;NOW 1 add --&gt; README.md&quot;</span></span><br><span class="line"></span><br><span class="line">$ git push -u origin master</span><br></pre></td></tr></table></figure>
<p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk0noizvxqj30v60j6acr.jpg"><br><strong>回到 <code>github</code>上查看</strong><br><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk0nos1n4oj310f0jp75h.jpg"><br><strong>给此次提交打上标签并再次推送至 <code>github</code></strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> --oneline</span><br><span class="line"></span><br><span class="line">$ git tag -a <span class="string">&quot;v1.0&quot;</span> 6de1296 -m <span class="string">&quot;标签 1&quot;</span></span><br><span class="line"></span><br><span class="line">$ git tag</span><br><span class="line"></span><br><span class="line">$ git show v1.0 --oneline</span><br><span class="line"></span><br><span class="line">$ git push -u origin v1.0</span><br></pre></td></tr></table></figure>
<p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk0np6qtyfj30v60iitai.jpg"><br><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk0nprd7e7j30v606p3z6.jpg"><br><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk0nq10736j310f0drgme.jpg"></p>
<h3 id="10-5-git-推送代码的整体过程"><a href="#10-5-git-推送代码的整体过程" class="headerlink" title="10.5 git 推送代码的整体过程"></a>10.5 git 推送代码的整体过程</h3><p><strong>创建自己的dev01分支</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Administrator@DESKTOP-HK1R5KR MINGW64 ~/Desktop/project01 (master)</span><br><span class="line">$ git branch dev01</span><br></pre></td></tr></table></figure>
<p><strong>模拟master主分支更新</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">Administrator@DESKTOP-HK1R5KR MINGW64 ~/Desktop/project01 (master)</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;# NOW 2 lemon very good&quot;</span> &gt; lemon.md</span><br><span class="line"></span><br><span class="line">Administrator@DESKTOP-HK1R5KR MINGW64 ~/Desktop/project01 (master)</span><br><span class="line">$ git add .</span><br><span class="line"></span><br><span class="line">Administrator@DESKTOP-HK1R5KR MINGW64 ~/Desktop/project01 (master)</span><br><span class="line">$ git commit -m <span class="string">&quot;NOW 2 add --&gt; lemon.md&quot;</span></span><br><span class="line">[master 87c2a24] NOW 2 add --&gt; lemon.md</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"> create mode 100644 lemon.md</span><br><span class="line"></span><br><span class="line">Administrator@DESKTOP-HK1R5KR MINGW64 ~/Desktop/project01 (master)</span><br><span class="line">$ git reflog --oneline</span><br><span class="line">87c2a24 (HEAD -&gt; master) HEAD@&#123;0&#125;: commit: NOW 2 add --&gt; lemon.md</span><br><span class="line">94a2b68 (tag: v1.0, origin/master, origin/HEAD, dev01) HEAD@&#123;1&#125;: <span class="built_in">clone</span>: from git@github.com:devopssss/project01.git</span><br><span class="line"></span><br><span class="line">Administrator@DESKTOP-HK1R5KR MINGW64 ~/Desktop/project01 (master)</span><br><span class="line">$ git tag -a <span class="string">&quot;v2.0&quot;</span> 87c2a24 -m <span class="string">&quot;第二此提交&quot;</span></span><br><span class="line"></span><br><span class="line">Administrator@DESKTOP-HK1R5KR MINGW64 ~/Desktop/project01 (master)</span><br><span class="line">$ git tag</span><br><span class="line">v1.0</span><br><span class="line">v2.0</span><br><span class="line"></span><br><span class="line">Administrator@DESKTOP-HK1R5KR MINGW64 ~/Desktop/project01 (master)</span><br><span class="line">$ git remote add origin git@github.com:devopssss/project01.git</span><br><span class="line"></span><br><span class="line">Administrator@DESKTOP-HK1R5KR MINGW64 ~/Desktop/project01 (master)</span><br><span class="line">$ git remote -v</span><br><span class="line">origin  git@github.com:devopssss/project01.git (fetch)</span><br><span class="line">origin  git@github.com:devopssss/project01.git (push)</span><br><span class="line"></span><br><span class="line">Administrator@DESKTOP-HK1R5KR MINGW64 ~/Desktop/project01 (master)</span><br><span class="line">$ git push -u origin master</span><br><span class="line"></span><br><span class="line">Administrator@DESKTOP-HK1R5KR MINGW64 ~/Desktop/project01 (master)</span><br><span class="line">$ git push -u origin v2.0</span><br></pre></td></tr></table></figure>
<p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk0nql72spj30ri0c1q3g.jpg"><br><strong>进行dev01分支的开发；（现在这个分支和master上的分支内容是不一致的 !）</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Administrator@DESKTOP-HK1R5KR MINGW64 ~/Desktop/project01 (master)</span><br><span class="line">$ git checkout dev01</span><br><span class="line"></span><br><span class="line">Administrator@DESKTOP-HK1R5KR MINGW64 ~/Desktop/project01 (dev01)</span><br><span class="line">$ ls</span><br><span class="line">README.md</span><br><span class="line"></span><br><span class="line">Administrator@DESKTOP-HK1R5KR MINGW64 ~/Desktop/project01 (dev01)</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;dev01&quot;</span> &gt; dev01.txt</span><br><span class="line"></span><br><span class="line">Administrator@DESKTOP-HK1R5KR MINGW64 ~/Desktop/project01 (dev01)</span><br><span class="line">$ ls</span><br><span class="line">dev01.txt  README.md</span><br><span class="line"></span><br><span class="line">Administrator@DESKTOP-HK1R5KR MINGW64 ~/Desktop/project01 (dev01)</span><br><span class="line">$ git add .</span><br><span class="line"></span><br><span class="line">Administrator@DESKTOP-HK1R5KR MINGW64 ~/Desktop/project01 (dev01)</span><br><span class="line">$ git commit -m <span class="string">&quot;dev01&quot;</span></span><br><span class="line">[dev01 01996d5] dev01</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"> create mode 100644 dev01.txt</span><br></pre></td></tr></table></figure>
<p><strong>使用git pull 在自己的分支上重新将master分支合并（相当于同步master分支内容），然后在测试有没有问题</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Administrator@DESKTOP-HK1R5KR MINGW64 ~/Desktop/project01 (dev01)</span><br><span class="line">$ git pull origin master</span><br><span class="line"></span><br><span class="line">Administrator@DESKTOP-HK1R5KR MINGW64 ~/Desktop/project01 (dev01)</span><br><span class="line">$ ls</span><br><span class="line">dev01.txt  lemon.md  README.md</span><br></pre></td></tr></table></figure>
<p><strong>测试没有问题后才会到master分支上将其开发好的分支合并到master上面，然后在删除合并到master的分支</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Administrator@DESKTOP-HK1R5KR MINGW64 ~/Desktop/project01 (dev01)</span><br><span class="line">$ git checkout master</span><br><span class="line"></span><br><span class="line">Administrator@DESKTOP-HK1R5KR MINGW64 ~/Desktop/project01 (master)</span><br><span class="line">$ git merge dev01</span><br><span class="line">Updating 87c2a24..aaed965</span><br><span class="line">Fast-forward</span><br><span class="line"> dev01.txt | 1 +</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"> create mode 100644 dev01.txt</span><br><span class="line"> </span><br><span class="line">Administrator@DESKTOP-HK1R5KR MINGW64 ~/Desktop/project01 (master)</span><br><span class="line">$ git branch -d dev01</span><br><span class="line">Deleted branch dev01 (was aaed965).</span><br></pre></td></tr></table></figure>
<p><strong>最后在推送至远程仓库</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">Administrator@DESKTOP-HK1R5KR MINGW64 ~/Desktop/project01 (master)</span><br><span class="line">$ git <span class="built_in">log</span> --oneline</span><br><span class="line">aaed965 (HEAD -&gt; master) Merge branch <span class="string">&#x27;master&#x27;</span> of github.com:devopssss/project01 into dev01</span><br><span class="line">01996d5 dev01</span><br><span class="line">87c2a24 (tag: v2.0, origin/master) NOW 2 add --&gt; lemon.md</span><br><span class="line">94a2b68 (tag: v1.0) NOW 1 add --&gt; README.md</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Administrator@DESKTOP-HK1R5KR MINGW64 ~/Desktop/project01 (master)</span><br><span class="line">$ git tag -a <span class="string">&quot;v3.0&quot;</span> aaed965 -m <span class="string">&quot;标签 3&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Administrator@DESKTOP-HK1R5KR MINGW64 ~/Desktop/project01 (master)</span><br><span class="line">$ git push -u origin master</span><br><span class="line">Total 0 (delta 0), reused 0 (delta 0), pack-reused 0</span><br><span class="line">To github.com:devopssss/project01.git</span><br><span class="line">   87c2a24..aaed965  master -&gt; master</span><br><span class="line">Branch <span class="string">&#x27;master&#x27;</span> <span class="built_in">set</span> up to track remote branch <span class="string">&#x27;master&#x27;</span> from <span class="string">&#x27;origin&#x27;</span>.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Administrator@DESKTOP-HK1R5KR MINGW64 ~/Desktop/project01 (master)</span><br><span class="line">$ git push -u origin v3.0</span><br><span class="line">Enumerating objects: 8, <span class="keyword">done</span>.</span><br><span class="line">Counting objects: 100% (8/8), <span class="keyword">done</span>.</span><br><span class="line">Delta compression using up to 8 threads</span><br><span class="line">Compressing objects: 100% (5/5), <span class="keyword">done</span>.</span><br><span class="line">Writing objects: 100% (6/6), 678 bytes | 339.00 KiB/s, <span class="keyword">done</span>.</span><br><span class="line">Total 6 (delta 1), reused 0 (delta 0), pack-reused 0</span><br><span class="line">remote: Resolving deltas: 100% (1/1), <span class="keyword">done</span>.</span><br><span class="line">To github.com:devopssss/project01.git</span><br><span class="line"> * [new tag]         v3.0 -&gt; v3.0</span><br></pre></td></tr></table></figure>
<p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk0nqzmv5rj30sx0i2gmk.jpg"></p>
<h1 id="三、Gitlab-代码仓库"><a href="#三、Gitlab-代码仓库" class="headerlink" title="三、Gitlab 代码仓库"></a>三、Gitlab 代码仓库</h1><h2 id="1-简介概述"><a href="#1-简介概述" class="headerlink" title="1. 简介概述"></a>1. 简介概述</h2><blockquote>
<ul>
<li>与 GitHub 一样，GitLab 是一个基于Web的资源库管理器，可让团队协作处理代码，复制代码以安全地创建和编辑新项目，然后将完成的代码合并到现有项目中。</li>
<li>GitLab 是用Ruby编程语言编写的，包含Wiki 和问题跟踪功能。它有不同的版本：GitLab 社区版（CE），企业版（EE） 和 GitLab托管版本GitLab.com。</li>
<li>它拥有超过1400名贡献者，并被阿里巴巴，美国宇航局，欧洲核子研究中心等主要组织使用。</li>
</ul>
</blockquote>
<h2 id="2-什么是-Gitlab"><a href="#2-什么是-Gitlab" class="headerlink" title="2. 什么是 Gitlab"></a>2. 什么是 Gitlab</h2><ul>
<li> GitLab 是一个开源分布式版本控制系统</li>
<li> 开发语言: Ruby</li>
<li> 功能:管理项目源代码、版本控制、代码复用与查找</li>
</ul>
<h2 id="3-GitLab-与-GitHub-的不同"><a href="#3-GitLab-与-GitHub-的不同" class="headerlink" title="3. GitLab 与 GitHub 的不同"></a>3. GitLab 与 GitHub 的不同</h2><ul>
<li><strong><code>Github</code></strong> 分布式在线代码托管仓库,个人版本可直接在线免费使用,企业版本收费且需要服务器安装。</li>
<li><strong><code>Gitlab</code></strong> 分布式在线代码仓库托管软件,分社区免费版本与企业收费版本，都需要服务器安装。</li>
</ul>
<h2 id="4-Gitlab-的优势和应用场景"><a href="#4-Gitlab-的优势和应用场景" class="headerlink" title="4. Gitlab 的优势和应用场景"></a>4. Gitlab 的优势和应用场景</h2><ul>
<li>开源免费，适合中小型公司将代码放置在该系统中</li>
<li>品差异化的版本管理，离线同步以及强大分支管理功能</li>
<li>便捷的GUI操作界面以及强大账户权限管理功能</li>
<li>集成度很高，能够集成绝大多数的开发工具,支持内置HA,保证在高并发下仍旧实现高可用性</li>
</ul>
<h2 id="5-GitLab-主要服务构成"><a href="#5-GitLab-主要服务构成" class="headerlink" title="5. GitLab 主要服务构成"></a>5. GitLab 主要服务构成</h2><ul>
<li><code>Nginx</code> 静态Web服务器</li>
<li><code>Gitlab-workhorse</code> 轻量级的反向代理服务器</li>
<li><code>Gitlab-shell</code> 用于处理Git命令和修改authorized keys列表</li>
<li><code>Logrotate</code> 日志文件管理工具</li>
<li><code>Postgresql</code> 数据库</li>
<li><code>Redis</code> 缓存服务器</li>
</ul>
<h2 id="6-GitLab-的工作流程"><a href="#6-GitLab-的工作流程" class="headerlink" title="6. GitLab 的工作流程"></a>6. GitLab 的工作流程</h2><ul>
<li>创建并克隆项目</li>
<li>创建项目某Feature分支</li>
<li>编写代码并提交至该分支</li>
<li>推送改项目分支至远程Gitlab 服务器</li>
<li>进行代码检查并提交Master主分支合并申请</li>
<li>项目领导审查代码并确认合并申请</li>
</ul>
<h2 id="7-安装-Gitlab-仓库系统"><a href="#7-安装-Gitlab-仓库系统" class="headerlink" title="7. 安装 Gitlab 仓库系统"></a>7. 安装 Gitlab 仓库系统</h2><blockquote>
<p><strong>打开一台虚拟机：192.168.2.1</strong></p>
</blockquote>
<h3 id="7-1-添加hosts解析文件"><a href="#7-1-添加hosts解析文件" class="headerlink" title="7.1 添加hosts解析文件"></a>7.1 添加hosts解析文件</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># cat &lt;&lt;END&gt;&gt; /etc/hosts</span></span><br><span class="line">192.168.2.1 gitlab.lemon.com</span><br><span class="line">192.168.2.2 jenkins.lemon.com</span><br><span class="line">192.168.2.3 lb.lemon.com</span><br><span class="line">END</span><br></pre></td></tr></table></figure>
<h3 id="7-2-安装-Gitlab-依赖"><a href="#7-2-安装-Gitlab-依赖" class="headerlink" title="7.2 安装 Gitlab 依赖"></a>7.2 安装 Gitlab 依赖</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># yum install -y policycoreutils openssh-server openssh-clients postfix lsof</span></span><br><span class="line">[root@gitlab ~]<span class="comment"># systemctl start postfix;systemctl enable postfix     #开启邮箱服务</span></span><br></pre></td></tr></table></figure>
<h3 id="7-3安装-Gitlab-12-0-3-版本"><a href="#7-3安装-Gitlab-12-0-3-版本" class="headerlink" title="7.3安装 Gitlab-12.0.3 版本"></a>7.3安装 Gitlab-12.0.3 版本</h3><p>由于国内网络偏慢，这里使用清华大学的镜像源进行安装gitlab-ce</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># cat &lt;&lt;END&gt;&gt; /etc/yum.repos.d/gitlab-ce.repo</span></span><br><span class="line">[gitlab-ce]</span><br><span class="line">name=gitlab-ce</span><br><span class="line">baseurl=http://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el7</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line">\<span class="comment">#gpgkey=</span></span><br><span class="line">END</span><br><span class="line"></span><br><span class="line">[root@gitlab ~]<span class="comment"># yum clean all &amp;&amp; yum makecache</span></span><br><span class="line"></span><br><span class="line">[[root@gitlab ~]<span class="comment"># yum -y install gitlab-ce-12.0.3-ce.0.el7</span></span><br></pre></td></tr></table></figure>
<p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk8x32qcxej310f0drjs0.jpg"></p>
<h3 id="7-4-Gitlab-管理命令"><a href="#7-4-Gitlab-管理命令" class="headerlink" title="7.4 Gitlab 管理命令"></a>7.4 Gitlab 管理命令</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># gitlab-ctl stop           #关闭gitlab</span></span><br><span class="line"></span><br><span class="line">[root@gitlab ~]<span class="comment"># gitlab-ctl start          #启动gitlab</span></span><br><span class="line"></span><br><span class="line">[root@gitlab ~]<span class="comment"># gitlab-ctl restart        #重启gitlab</span></span><br><span class="line"></span><br><span class="line">[root@gitlab ~]<span class="comment"># gitlab-ctl status         #状态gitlab</span></span><br><span class="line"></span><br><span class="line">[root@gitlab ~]<span class="comment"># gitlab-ctl reconfigure    #重载配置文件并启动glitlab</span></span><br></pre></td></tr></table></figure>
<h3 id="7-5-修改配置文件并启动-Gitlab"><a href="#7-5-修改配置文件并启动-Gitlab" class="headerlink" title="7.5 修改配置文件并启动 Gitlab"></a>7.5 修改配置文件并启动 Gitlab</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># vim /etc/gitlab/gitlab.rb</span></span><br><span class="line"><span class="comment">#配置gitlab的URL或IP地址</span></span><br><span class="line">external_url <span class="string">&#x27;http://gitlab.lemon.com&#x27;</span></span><br><span class="line"><span class="comment">#配置邮箱</span></span><br><span class="line"><span class="comment">### Email Settings</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;gitlab_email_enabled&#x27;</span>] = <span class="literal">true</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;gitlab_email_from&#x27;</span>] = <span class="string">&#x27;lemon_row@163.com&#x27;</span>       <span class="comment">#邮箱账号</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;gitlab_email_display_name&#x27;</span>] = <span class="string">&#x27;Gitlab-lemon&#x27;</span>    <span class="comment">#发送人显示名称</span></span><br><span class="line"><span class="comment">### GitLab email server settings</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_enable&#x27;</span>] = <span class="literal">true</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_address&#x27;</span>] = <span class="string">&quot;smtp.163.com&quot;</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_port&#x27;</span>] = 465</span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_user_name&#x27;</span>] = <span class="string">&quot;lemon_row@163.com&quot;</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_password&#x27;</span>] = <span class="string">&quot;TZVLGNYMVOEWCIHR&quot;</span>            <span class="comment">#授权码</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_domain&#x27;</span>] = <span class="string">&quot;163.com&quot;</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_authentication&#x27;</span>] = <span class="string">&quot;login&quot;</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_enable_starttls_auto&#x27;</span>] = <span class="literal">true</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_tls&#x27;</span>] = <span class="literal">true</span></span><br><span class="line">:wq</span><br><span class="line">[root@gitlab ~]<span class="comment"># gitlab-ctl reconfigure          #初始化gitlab，第一次会很慢</span></span><br></pre></td></tr></table></figure>
<p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk8x5sc6wtj30ri0c1jrr.jpg"><br><strong>注意：重新配置应用程序。修改了 <code>gitlab</code> 服务配置文件后，都需要执行一下这个命令。让各个服务的配置文件，重新加载一下配置文件。这里等个4分钟左右。</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># gitlab-ctl status                   #查看gitlab状态</span></span><br></pre></td></tr></table></figure>
<p><a href=""><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk0nqzmv5rj30sx0i2gmk.jpg" alt="image-20200505123636158"></a><br>提示：<code>gitlab</code> 需要使用到80端口，所以得保证80端口不被占用，或者改端口 </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># lsof -i:80</span></span><br></pre></td></tr></table></figure>
<p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk8xamlaa3j31ca07emyk.jpg"></p>
<h3 id="7-6-汉化-Gitlab"><a href="#7-6-汉化-Gitlab" class="headerlink" title="7.6 汉化 Gitlab"></a>7.6 汉化 Gitlab</h3><p>汉化包下载地址 ==&gt; <a target="_blank" rel="noopener" href="https://gitlab.com/xhang/gitlab.git">https://gitlab.com/xhang/gitlab.git</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">//查看gitlab的版本</span><br><span class="line">[root@gitlab ~]<span class="comment"># cat /opt/gitlab/embedded/service/gitlab-rails/VERSION</span></span><br><span class="line">11.2.3</span><br><span class="line"></span><br><span class="line">//下载对应版本的汉化包，解压汉化包，查看汉化包的版本</span><br><span class="line">[root@gitlab ~]<span class="comment"># cd /usr/local/src/</span></span><br><span class="line">[root@gitlab src]<span class="comment"># tar xf gitlab-v12.0.3-zh.tar.gz </span></span><br><span class="line">[root@gitlab src]<span class="comment"># rm -rf gitlab-v12.0.3-zh.tar.gz </span></span><br><span class="line">[root@gitlab src]<span class="comment"># cat gitlab-v12.0.3-zh/VERSION </span></span><br><span class="line">12.0.3</span><br><span class="line"></span><br><span class="line">//先备份，避免汉化失败后gitlab瘫痪</span><br><span class="line">[root@gitlab src]<span class="comment"># mkdir gitlab.bak</span></span><br><span class="line">[root@gitlab src]<span class="comment"># cp -r /opt/gitlab/embedded/service/gitlab-rails/* /usr/local/src/gitlab.bak</span></span><br><span class="line"></span><br><span class="line">//将下载好的汉化包覆盖拷贝过去</span><br><span class="line">[root@gitlab src]<span class="comment"># \cp -rf gitlab-v12.0.3-zh/* /opt/gitlab/embedded/service/gitlab-rails/</span></span><br><span class="line">cp: 无法以目录<span class="string">&quot;gitlab-v12.0.3-zh/log&quot;</span> 来覆盖非目录<span class="string">&quot;/opt/gitlab/embedded/service/gitlab-rails/log&quot;</span></span><br><span class="line">cp: 无法以目录<span class="string">&quot;gitlab-v12.0.3-zh/tmp&quot;</span> 来覆盖非目录<span class="string">&quot;/opt/gitlab/embedded/service/gitlab-rails/tmp&quot;</span></span><br><span class="line"></span><br><span class="line">//重新配置gitlab</span><br><span class="line">[root@gitlab src]<span class="comment"># gitlab-ctl reconfigure</span></span><br><span class="line"></span><br><span class="line">//重启gitlab</span><br><span class="line">[root@gitlab src]<span class="comment"># gitlab-ctl restart</span></span><br><span class="line"></span><br><span class="line">//检查是否启动成功</span><br><span class="line">[root@gitlab src]<span class="comment"># gitlab-ctl status  </span></span><br><span class="line">[root@gitlab src]<span class="comment"># lsof -i:80</span></span><br></pre></td></tr></table></figure>
<h3 id="7-7-访问浏览器测试"><a href="#7-7-访问浏览器测试" class="headerlink" title="7.7 访问浏览器测试"></a>7.7 访问浏览器测试</h3><p>注释：如果后期 web 界面访问时，总报 502的话，就把防火墙清空规则，另外内存要大于4G，不然以后内存不足，也报 502！<br><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk8xjddd6kj31400k6t9v.jpg"><br><code>Gitlab</code> 默认用户是root，拥有最高权限，密码我设置的是“abc123..”，最少八位数。<br><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk8xg4tjroj31ak0ka75t.jpg"><br>登陆 <code>Gitlab</code><br><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk8xhf93ofj31ao0km3zz.jpg"><br><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk8xi4t072j31du0leq4d.jpg"><br><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk8xin4h4rj31ei0cadgf.jpg"><br><strong><font color=#FF0000 >至此gitlab安装完成！</font></strong></p>
<h2 id="8-Gitlab-权限管理"><a href="#8-Gitlab-权限管理" class="headerlink" title="8. Gitlab 权限管理"></a>8. Gitlab 权限管理</h2><h3 id="8-1-创建Group，User，Project"><a href="#8-1-创建Group，User，Project" class="headerlink" title="8.1 创建Group，User，Project"></a>8.1 创建Group，User，Project</h3><p><strong>三者层级关系如下图：</strong><br><a href=""><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk8xhf93ofj31ao0km3zz.jpg" alt="image-20200505155246349"></a></p>
<h3 id="8-2-创建一个组，组名为java"><a href="#8-2-创建一个组，组名为java" class="headerlink" title="8.2 创建一个组，组名为java"></a>8.2 创建一个组，组名为java</h3><p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk8xi4t072j31du0leq4d.jpg" alt="image-20200505155125938"><br><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk8xin4h4rj31ei0cadgf.jpg" alt="image-20200520163930342"></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Gitlab中的组和项目有三种访问权限：Private、Internal、Public</span></span><br><span class="line"></span><br><span class="line">- Private：只有组成员才能看到</span><br><span class="line">- Internal：只要登录的用户就能看到,开源项目和组设置的是Internal</span><br><span class="line">- Public：所有人都能看到</span><br></pre></td></tr></table></figure>
<p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk8xi4t072j31du0leq4d.jpg" alt="image-20200520164034959"></p>
<h3 id="8-3-创建一个PM的用户作为项目管理者并加入到java组内"><a href="#8-3-创建一个PM的用户作为项目管理者并加入到java组内" class="headerlink" title="8.3 创建一个PM的用户作为项目管理者并加入到java组内"></a>8.3 创建一个PM的用户作为项目管理者并加入到java组内</h3><p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk8xin4h4rj31ei0cadgf.jpg" alt="image-20200520164704264"><br>![image-20200520164838332][image-60]<br><strong>注意：这里的邮箱在公司里一定要写上真实的，我这里为了方便，就随便写上了一个</strong><br><a href="">![image-20200520165021663][image-61]</a><br>![image-20200520165355480][image-62]<br>![image-20200520165404742][image-63]<br><strong>修改pm用户秘密: abc123..</strong><br>![image-20200520165453870][image-64]<br>![image-20200505160239790][image-65]<br>![image-20200520165528634][image-66]<br>![image-20200520165542652][image-67]</p>
<h3 id="8-4-将pm管理用户加入到java组内"><a href="#8-4-将pm管理用户加入到java组内" class="headerlink" title="8.4 将pm管理用户加入到java组内"></a>8.4 将pm管理用户加入到java组内</h3><p><a href="">![image-20200505160446031][image-68]</a><br>![image-20200520165717730][image-69]<br>![image-20200520165804474][image-70]<br><a href="">![image-20200520165901037][image-71]</a><br>![image-20200520165825710][image-72]<br><strong>Gitlab 权限管理：</strong></p>
<blockquote>
<p><strong>Gitlab 用户在组中有五种权限：Guest、Reporter、Developer、Master、Owner</strong></p>
</blockquote>
<ol>
<li><strong>Guest：</strong>可以创建issue、发表评论，不能读写版本库。</li>
<li><strong>Reporter：</strong>可以克隆代码，不能提交，QA、PM可以赋予这个权限。</li>
<li><strong>Developer：</strong>可以克隆代码、开发、提交、push，RD可以赋予这个权限。</li>
<li><strong>Maintainer：</strong>可以创建项目、添加tag、保护分支、添加项目成员、编辑项目，核心RD负责人可以赋予这个权限。</li>
<li><strong>Owner：</strong>可以设置项目访问权限 Visibility Level、删除项目、迁移项目、管理组成员，开发组leader能赋予这个权限。<h3 id="8-5-用PM用户创建一个项目app1"><a href="#8-5-用PM用户创建一个项目app1" class="headerlink" title="8.5 用PM用户创建一个项目app1"></a>8.5 用PM用户创建一个项目app1</h3><a href="">![image-20200505161058389][image-73]</a><br>![image-20200505161150381][image-74]<br><a href="">![image-20200520170235802][image-75]</a><br>![image-20200505161405176][image-76]<br><a href="">![image-20200520170340324][image-77]</a><br><a href="">![image-20200520170608480][image-78]</a><br>![image-20200520170723976][image-79]<br><a href="">![image-20200520170747102][image-80]</a><h3 id="8-6-在-gitlab-登陆页面下创建-dev1-dev2-用户，并作为开发者加入到-app1-项目中"><a href="#8-6-在-gitlab-登陆页面下创建-dev1-dev2-用户，并作为开发者加入到-app1-项目中" class="headerlink" title="8.6 在 gitlab 登陆页面下创建 dev1 dev2 用户，并作为开发者加入到 app1 项目中"></a>8.6 在 gitlab 登陆页面下创建 dev1 dev2 用户，并作为开发者加入到 app1 项目中</h3>![image-20200520170907356][image-81]<br>![image-20200520171038972][image-82]<br><a href="">![image-20200520171340537][image-83]</a><br>![image-20200520172319843][image-84]</li>
</ol>
<ul>
<li><strong>创建完了之后这两个用户很明显是看不到 <code>app1</code> 这个项目的</strong></li>
<li><strong>所以需要登陆pm或root用户将其创建的用户添加到 <code>java</code> 组里面中或者 <code>app1</code> 项目中（授权）</strong><br><a href="">![image-20200505162104889][image-85]</a><br>![image-20200520174937761][image-86]<br>![image-20200520175206249][image-87]<br>![image-20200520175251857][image-88]<br>![image-20200520175308120][image-89]<br><a href="">![image-20200520175140091][image-90]</a></li>
<li><strong>组成员添加完了之后 看一下 <code>app1</code> 项目中有没有添加这两个用户</strong><br>![image-20200520175353110][image-91]<br><a href="">![image-20200520175513606][image-92]</a><br>![image-20200520171736393][image-93]</li>
<li><strong>随便登陆这两个其中一个账号验证是否能够看到app1项目</strong><br>![image-20200520172641592][image-94]</li>
</ul>
<h2 id="9-gitlab-的基本使用"><a href="#9-gitlab-的基本使用" class="headerlink" title="9. gitlab 的基本使用"></a>9. gitlab 的基本使用</h2><h3 id="9-1-将-dev1-持有人的公钥放到-dev1-账号下"><a href="#9-1-将-dev1-持有人的公钥放到-dev1-账号下" class="headerlink" title="9.1 将 dev1 持有人的公钥放到 dev1 账号下"></a>9.1 将 dev1 持有人的公钥放到 dev1 账号下</h3><ul>
<li><strong>开启一台虚拟机，192.168.2.6</strong><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#添加hosts解析文件</span></span><br><span class="line">[root@dev1 ~]<span class="comment"># cat &lt;&lt;END&gt;&gt; /etc/hosts</span></span><br><span class="line">192.168.2.1 gitlab.lemon.com</span><br><span class="line">192.168.2.2 jenkins.lemon.com</span><br><span class="line">192.168.2.3 lb.lemon.com</span><br><span class="line">END</span><br><span class="line">[root@dev1 ~]<span class="comment"># ssh-keygen </span></span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file <span class="keyword">in</span> <span class="built_in">which</span> to save the key (/root/.ssh/id_rsa): </span><br><span class="line">Created directory <span class="string">&#x27;/root/.ssh&#x27;</span>.</span><br><span class="line">Enter passphrase (empty <span class="keyword">for</span> no passphrase): </span><br><span class="line">Enter same passphrase again: </span><br><span class="line">Your identification has been saved <span class="keyword">in</span> /root/.ssh/id_rsa.</span><br><span class="line">Your public key has been saved <span class="keyword">in</span> /root/.ssh/id_rsa.pub.</span><br><span class="line">The key fingerprint is:</span><br><span class="line">SHA256:R5PUO4f4FLhExQ6YaD6B20GMn1Fdgzw98YXtEX/jfMo root@dev1</span><br><span class="line">The key<span class="string">&#x27;s randomart image is:</span></span><br><span class="line"><span class="string">+---[RSA 2048]----+</span></span><br><span class="line"><span class="string">|     =.o.*oO=. +o|</span></span><br><span class="line"><span class="string">|    o B o.O.*o.oo|</span></span><br><span class="line"><span class="string">|     * = .+* =.o+|</span></span><br><span class="line"><span class="string">|    . *  .o.* + +|</span></span><br><span class="line"><span class="string">|       .S .o o o.|</span></span><br><span class="line"><span class="string">|         .  .. ..|</span></span><br><span class="line"><span class="string">|              E  |</span></span><br><span class="line"><span class="string">|                 |</span></span><br><span class="line"><span class="string">|                 |</span></span><br><span class="line"><span class="string">+----[SHA256]-----+</span></span><br><span class="line"><span class="string">[root@dev1 ~]# cat .ssh/id_rsa.pub </span></span><br><span class="line"><span class="string">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDDzzBDqVPZ9H0nVKucS3B3QNx318tAan06c17dZ0npQpsoAZaMUFxneMH+zoEjd+cG5Ee7f2D2n+iqV0wLGYDs9CY/8RqsSZ9SSx9K2aM9I1XFP6AUpuM5ddI/b3nhBVcbFjzpEckXPMz3O4C0twO1/aRD4byFtyivfdrry/KDNrYEMGojzv7PuktIvC/Qp0vKpvNG7msD6ePg4eHKCunHNGIboojL/vckpJZkvDt0MuDbeHdIE8Gj1XNkoudyWrCVwNTj8TEUkZE6pE7fYfBOzC1gOWv/+evROmwYLioprRJx+ZklRe4YmJzHw7Qiia4CluidQyUquMT5geGIme/3 root@dev1</span></span><br></pre></td></tr></table></figure>
<a href="">![image-20200520181739636][image-95]</a><br>![image-20200520181938491][image-96]<br><a href="">![image-20200520181949116][image-97]</a><h3 id="9-2-以ssh协议推送代码至远程仓库"><a href="#9-2-以ssh协议推送代码至远程仓库" class="headerlink" title="9.2 以ssh协议推送代码至远程仓库"></a>9.2 以ssh协议推送代码至远程仓库</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">[root@dev1 ~]<span class="comment"># git config --global user.name &quot;dev1&quot;</span></span><br><span class="line">[root@dev1 ~]<span class="comment"># git config --global user.email &quot;dev1@163.com&quot;</span></span><br><span class="line"></span><br><span class="line">[root@dev1 ~]<span class="comment"># git clone git@gitlab.lemon.com:java/app1.git</span></span><br><span class="line">正克隆到 <span class="string">&#x27;app1&#x27;</span>...</span><br><span class="line">warning: 您似乎克隆了一个空版本库。</span><br><span class="line"></span><br><span class="line">[root@dev1 ~]<span class="comment"># cd app1</span></span><br><span class="line">[root@dev1 app1]<span class="comment"># echo &#x27;# 第一次提交 测试&#x27; &gt;&gt; README.md</span></span><br><span class="line">[root@dev1 app1]<span class="comment"># git add .</span></span><br><span class="line">[root@dev1 app1]<span class="comment"># git commit -m &quot;NOW 1 add README.md&quot;</span></span><br><span class="line">[master（根提交） e4c5af0] NOW 1 add README.md</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"> create mode 100644 README.md</span><br><span class="line"></span><br><span class="line">[root@dev1 app1]<span class="comment"># git tag -a &#x27;v1.0&#x27; -m &#x27;版本 1&#x27;</span></span><br><span class="line">[root@dev1 app1]<span class="comment"># git show --oneline v1.0</span></span><br><span class="line">tag v1.0</span><br><span class="line"></span><br><span class="line">版本 1</span><br><span class="line">e4c5af0 NOW 1 add README.md</span><br><span class="line">diff --git a/README.md b/README.md</span><br><span class="line">new file mode 100644</span><br><span class="line">index 0000000..e4460ab</span><br><span class="line">--- /dev/null</span><br><span class="line">+++ b/README.md</span><br><span class="line">@@ -0,0 +1 @@</span><br><span class="line">+<span class="comment"># 第一次提交 测试</span></span><br><span class="line"></span><br><span class="line">[root@dev1 app1]<span class="comment"># git push -u origin master</span></span><br><span class="line">Counting objects: 3, <span class="keyword">done</span>.</span><br><span class="line">Writing objects: 100% (3/3), 241 bytes | 0 bytes/s, <span class="keyword">done</span>.</span><br><span class="line">Total 3 (delta 0), reused 0 (delta 0)</span><br><span class="line">To git@gitlab.lemon.com:java/app1.git</span><br><span class="line"> * [new branch]      master -&gt; master</span><br><span class="line">分支 master 设置为跟踪来自 origin 的远程分支 master。</span><br><span class="line"></span><br><span class="line">[root@dev1 app1]<span class="comment"># git push -u origin v1.0</span></span><br><span class="line">Counting objects: 1, <span class="keyword">done</span>.</span><br><span class="line">Writing objects: 100% (1/1), 157 bytes | 0 bytes/s, <span class="keyword">done</span>.</span><br><span class="line">Total 1 (delta 0), reused 0 (delta 0)</span><br><span class="line">To git@gitlab.lemon.com:java/app1.git</span><br><span class="line"> * [new tag]         v1.0 -&gt; v1.0</span><br></pre></td></tr></table></figure>
![image-20200520182932298][image-98]<h3 id="9-3-下面以PM用户进行创建开发计划分配给dev2"><a href="#9-3-下面以PM用户进行创建开发计划分配给dev2" class="headerlink" title="9.3 下面以PM用户进行创建开发计划分配给dev2"></a>9.3 下面以PM用户进行创建开发计划分配给dev2</h3></li>
<li><strong>开启一台虚拟机，192.168.2.7</strong><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#添加hosts解析文件</span></span><br><span class="line">[root@dev2 ~]<span class="comment"># cat &lt;&lt;END&gt;&gt; /etc/hosts</span></span><br><span class="line">192.168.2.1 gitlab.lemon.com</span><br><span class="line">192.168.2.2 jenkins.lemon.com</span><br><span class="line">192.168.2.3 lb.lemon.com</span><br><span class="line">END</span><br></pre></td></tr></table></figure>
<h4 id="9-3-1-开发一个-官网-V1-0-版本，包含首页和新闻"><a href="#9-3-1-开发一个-官网-V1-0-版本，包含首页和新闻" class="headerlink" title="9.3.1 开发一个 官网 V1.0 版本，包含首页和新闻"></a>9.3.1 开发一个 <code>官网 V1.0 版本</code>，包含首页和新闻</h4></li>
</ul>
<p> <strong>（1）创建里程碑（Milestone）</strong><br>![image-20200520183610892][image-99]<br>![image-20200520184021120][image-100]<br>![image-20200520184055990][image-101]<br>![image-20200520184305649][image-102]<br><strong>（2）依次把任务首页，新闻添加到里程碑，并进行任务分配给dev2开发者</strong><br>![image-20200520184527869][image-103]<br><a href="">![image-20200520184604227][image-104]</a><br>![image-20200520184730629][image-105]<br><a href="">![image-20200520184758795][image-106]</a></p>
<h4 id="9-3-2-使用dev2用户登录查看，会有任务提示"><a href="#9-3-2-使用dev2用户登录查看，会有任务提示" class="headerlink" title="9.3.2  使用dev2用户登录查看，会有任务提示"></a>9.3.2  使用dev2用户登录查看，会有任务提示</h4><p>![image-20200520185000657][image-107]</p>
<h4 id="9-3-3-dev2-开发者收到任务，进行开发"><a href="#9-3-3-dev2-开发者收到任务，进行开发" class="headerlink" title="9.3.3 dev2 开发者收到任务，进行开发"></a>9.3.3 dev2 开发者收到任务，进行开发</h4><ul>
<li><strong>将 dev2 持有人的公钥放到 dev2 账号下</strong><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@dev2 ~]<span class="comment"># ssh-keygen </span></span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file <span class="keyword">in</span> <span class="built_in">which</span> to save the key (/root/.ssh/id_rsa): </span><br><span class="line">Created directory <span class="string">&#x27;/root/.ssh&#x27;</span>.</span><br><span class="line">Enter passphrase (empty <span class="keyword">for</span> no passphrase): </span><br><span class="line">Enter same passphrase again: </span><br><span class="line">Your identification has been saved <span class="keyword">in</span> /root/.ssh/id_rsa.</span><br><span class="line">Your public key has been saved <span class="keyword">in</span> /root/.ssh/id_rsa.pub.</span><br><span class="line">The key fingerprint is:</span><br><span class="line">SHA256:WC/AYWsXe0QwQDQtL7wlTJUzjGvAtyqAWd17tNwYZvk root@dev2</span><br><span class="line">The key<span class="string">&#x27;s randomart image is:</span></span><br><span class="line"><span class="string">+---[RSA 2048]----+</span></span><br><span class="line"><span class="string">|   o +B*==o      |</span></span><br><span class="line"><span class="string">|  . +o*+%=       |</span></span><br><span class="line"><span class="string">|.o   *=@+O.      |</span></span><br><span class="line"><span class="string">|+    .X=BoE      |</span></span><br><span class="line"><span class="string">| .   o.*S .      |</span></span><br><span class="line"><span class="string">|  . . .  .       |</span></span><br><span class="line"><span class="string">|   .             |</span></span><br><span class="line"><span class="string">|                 |</span></span><br><span class="line"><span class="string">|                 |</span></span><br><span class="line"><span class="string">+----[SHA256]-----+</span></span><br><span class="line"><span class="string">[root@dev2 ~]# cat .ssh/id_rsa.pub </span></span><br><span class="line"><span class="string">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDE1Wu54a56ryKqGRf5ctaJ71ZcApTV2KNxuG03ykSzZkcp7JSwUNxNRxrWu+XtbjKyCjkJnnBJ+Op18ixN17r69WY5edRxz3c50trNma2PDGm62fdzC0cdZLHnIKCRyizen5UrPxiPMkeJ6Gi2Z6ZmEZhxWhv6ePn3XE53lJg5PMyeSctMTZcikJ9qV0v3l3cZ8XD/fNaJnVQnYUswCxxg+JDEah5G8+sR5sKTJntTKxEjdJOd5/rsZFDGWzlMgieVzYYhPUWejLc2Fw+xQJRmGSQ5+TaKcNNwND/UYlJvzce+AkstgMiocXLN1pW9AFdX4dNo1+LjnjIHfbHobZlP root@dev2</span></span><br></pre></td></tr></table></figure>
<h4 id="9-3-4-将客户端公钥（id-rsa-pub）放进-dev2-账户中"><a href="#9-3-4-将客户端公钥（id-rsa-pub）放进-dev2-账户中" class="headerlink" title="9.3.4 将客户端公钥（id_rsa.pub）放进 dev2 账户中"></a>9.3.4 将客户端公钥（id_rsa.pub）放进 dev2 账户中</h4><a href="">![image-20200520191915565][image-108]</a><br>![image-20200520192004677][image-109]<br>![image-20200520192017477][image-110]<h4 id="9-3-5-进行开发"><a href="#9-3-5-进行开发" class="headerlink" title="9.3.5 进行开发"></a>9.3.5 进行开发</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@dev2 ~]<span class="comment"># git config --global user.name &quot;dev2&quot;</span></span><br><span class="line">[root@dev2 ~]<span class="comment"># git config --global user.email &quot;dev2@163.com&quot;</span></span><br><span class="line">[root@dev2 ~]<span class="comment"># git clone git@192.168.2.1:java/app1.git</span></span><br><span class="line">正克隆到 <span class="string">&#x27;app1&#x27;</span>...</span><br><span class="line">remote: Enumerating objects: 4, <span class="keyword">done</span>.</span><br><span class="line">remote: Counting objects: 100% (4/4), <span class="keyword">done</span>.</span><br><span class="line">remote: Compressing objects: 100% (2/2), <span class="keyword">done</span>.</span><br><span class="line">remote: Total 4 (delta 0), reused 0 (delta 0)</span><br><span class="line">接收对象中: 100% (4/4), <span class="keyword">done</span>.</span><br><span class="line">[root@dev2 ~]<span class="comment"># cd app1/ &amp;&amp; ls</span></span><br><span class="line">README.md</span><br><span class="line">[root@dev2 app1]<span class="comment"># git checkout -b shouye</span></span><br><span class="line">切换到一个新分支 <span class="string">&#x27;shouye&#x27;</span></span><br><span class="line">[root@dev2 app1]<span class="comment"># echo &quot;&lt;h1&gt; www.lemon.com&quot; &gt; index.html</span></span><br><span class="line">[root@dev2 app1]<span class="comment"># git add .</span></span><br><span class="line">[root@dev2 app1]<span class="comment"># git commit -m &quot;shouye&quot;    #创建并切换首页分支</span></span><br><span class="line">[shouye aa7b19c] shouye</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"> create mode 100644 index.html</span><br><span class="line">[root@dev2 app1]<span class="comment"># git push origin shouye</span></span><br><span class="line">Counting objects: 4, <span class="keyword">done</span>.</span><br><span class="line">Compressing objects: 100% (2/2), <span class="keyword">done</span>.</span><br><span class="line">Writing objects: 100% (3/3), 282 bytes | 0 bytes/s, <span class="keyword">done</span>.</span><br><span class="line">Total 3 (delta 0), reused 0 (delta 0)</span><br><span class="line">remote: </span><br><span class="line">remote: To create a merge request <span class="keyword">for</span> shouye, visit:</span><br><span class="line">remote:   http://gitlab.lemon.com/java/app1/merge_requests/new?merge_request%5Bsource_branch%5D=shouye</span><br><span class="line">remote: </span><br><span class="line">To git@192.168.2.1:java/app1.git</span><br><span class="line"> * [new branch]      shouye -&gt; shouye</span><br></pre></td></tr></table></figure>
<h4 id="9-3-6-回到-gitlab-上可以看到有刚才创建的分支，点击”Merge-request”合并分支请求，之后PM用户登录处理合并请求。此时，一个功能的开发流程就完成。"><a href="#9-3-6-回到-gitlab-上可以看到有刚才创建的分支，点击”Merge-request”合并分支请求，之后PM用户登录处理合并请求。此时，一个功能的开发流程就完成。" class="headerlink" title="9.3.6 回到 gitlab 上可以看到有刚才创建的分支，点击”Merge request”合并分支请求，之后PM用户登录处理合并请求。此时，一个功能的开发流程就完成。"></a>9.3.6 回到 gitlab 上可以看到有刚才创建的分支，点击”Merge request”合并分支请求，之后PM用户登录处理合并请求。此时，一个功能的开发流程就完成。</h4>![image-20200520192650404][image-111]<br>![image-20200520192908247][image-112]<br>![image-20200520193038752][image-113]<h4 id="9-3-7-登陆PM用户合并请求"><a href="#9-3-7-登陆PM用户合并请求" class="headerlink" title="9.3.7 登陆PM用户合并请求"></a>9.3.7 登陆PM用户合并请求</h4><a href="">![image-20200505175911359][image-114]</a><br>![image-20200520193144859][image-115]<br><a href="">![image-20200520193234910][image-116]</a><br><a href="">![image-20200520193453612][image-117]</a><br><a href="">![image-20200520193510406][image-118]</a><h4 id="9-3-8-验证分支是否合并"><a href="#9-3-8-验证分支是否合并" class="headerlink" title="9.3.8 验证分支是否合并"></a>9.3.8 验证分支是否合并</h4><a href="">![image-20200505181325806][image-119]</a></li>
</ul>
<h2 id="10-Gitlab-的备份和恢复"><a href="#10-Gitlab-的备份和恢复" class="headerlink" title="10. Gitlab 的备份和恢复"></a>10. Gitlab 的备份和恢复</h2><h3 id="10-1-创建备份目录，并授权"><a href="#10-1-创建备份目录，并授权" class="headerlink" title="10.1 创建备份目录，并授权"></a>10.1 创建备份目录，并授权</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># mkdir /data/backups/gitlab -p</span></span><br><span class="line">[root@gitlab ~]<span class="comment"># chown -R git.git /data/</span></span><br></pre></td></tr></table></figure>
<h3 id="10-2-修改-gitlab-配置"><a href="#10-2-修改-gitlab-配置" class="headerlink" title="10.2 修改 gitlab 配置"></a>10.2 修改 gitlab 配置</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># vim /etc/gitlab/gitlab.rb </span></span><br><span class="line">299 gitlab_rails[<span class="string">&#x27;backup_path&#x27;</span>] = <span class="string">&quot;/data/backups/gitlab&quot;</span>  <span class="comment">#备份路径</span></span><br><span class="line">307 gitlab_rails[<span class="string">&#x27;backup_keep_time&#x27;</span>] = 604800             <span class="comment">#备份7天</span></span><br><span class="line"></span><br><span class="line">[root@gitlab ~]<span class="comment"># gitlab-ctl reconfigure</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="10-3-备份"><a href="#10-3-备份" class="headerlink" title="10.3 备份"></a>10.3 备份</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># gitlab-rake gitlab:backup:create</span></span><br></pre></td></tr></table></figure>

<h2 id="11-整体总结"><a href="#11-整体总结" class="headerlink" title="11. 整体总结"></a>11. 整体总结</h2><ul>
<li><em>PM在 <code>gitlab</code> 创建任务，分配给开发人员</em></li>
<li><em>开发人员领取任务后，在本地使用git clone拉取代码库</em></li>
<li><em>开发人员创建开发分支（git checkout -b dev），并进行开发</em></li>
<li><em>开发人员完成之后，提交到本地仓库（git commit ）</em></li>
<li><em>开发人员在gitlab界面上申请分支合并请求（Merge request）</em></li>
<li><em>PM在gitlab上查看提交和代码修改情况，确认无误后，确认将开发人员的分支合并到主分支（master）</em></li>
<li><em>开发人员在gitlab上Mark done确认开发完成，并关闭issue。这一步在提交合并请求时可以通过描述中填写”close #1”等字样，可以直接关闭issue。</em></li>
</ul>
<h1 id="四、部署-jenkins"><a href="#四、部署-jenkins" class="headerlink" title="四、部署 jenkins"></a>四、部署 jenkins</h1><ul>
<li><strong>开启一台虚拟机，192.168.2.2</strong><h2 id="1-安装-JDK-和-Maven"><a href="#1-安装-JDK-和-Maven" class="headerlink" title="1. 安装 JDK 和 Maven"></a>1. 安装 <code>JDK</code> 和 <code>Maven</code></h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#添加hosts解析文件</span></span><br><span class="line">[root@jenkins ~]<span class="comment"># cat &lt;&lt;END&gt;&gt; /etc/hosts</span></span><br><span class="line">192.168.2.1 gitlab.lemon.com</span><br><span class="line">192.168.2.2 jenkins.lemon.com</span><br><span class="line">192.168.2.3 lb.lemon.com</span><br><span class="line">END</span><br><span class="line">[root@jenkins ~]<span class="comment"># tar xf jdk-8u181-linux-x64.tar.gz </span></span><br><span class="line">[root@jenkins ~]<span class="comment"># tar xf apache-maven-3.5.4-bin.tar.gz</span></span><br><span class="line">[root@jenkins ~]<span class="comment"># mv jdk1.8.0_181 /usr/local/java</span></span><br><span class="line">[root@jenkins ~]<span class="comment"># mv apache-maven-3.5.4 /usr/local/maven</span></span><br><span class="line">[root@jenkins ~]<span class="comment"># vi /etc/profile</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/<span class="built_in">local</span>/java</span><br><span class="line"><span class="built_in">export</span> CLASSPATH=<span class="variable">$JAVA_HOME</span>/lib/tools.jar:<span class="variable">$JAVA_HOME</span>/lib/dt.jar:<span class="variable">$JAVA_HOME</span>/lib</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> MAVEN_HOME=/usr/<span class="built_in">local</span>/maven</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$MAVEN_HOME</span>/bin</span><br><span class="line">[root@jenkins ~]<span class="comment"># source /etc/profile</span></span><br><span class="line"></span><br><span class="line">[root@jenkins ~]<span class="comment"># java -version</span></span><br><span class="line">java version <span class="string">&quot;1.8.0_181&quot;</span></span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_181-b13)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.181-b13, mixed mode) </span><br><span class="line"></span><br><span class="line">[root@jenkins ~]<span class="comment"># mvn -v</span></span><br><span class="line">Apache Maven 3.5.4 (1edded0938998edf8bf061f1ceb3cfdeccf443fe; 2018-06-18T02:33:14+08:00)</span><br><span class="line">Maven home: /usr/<span class="built_in">local</span>/maven</span><br><span class="line">Java version: 1.8.0_181, vendor: Oracle Corporation, runtime: /usr/<span class="built_in">local</span>/java/jre</span><br><span class="line">Default locale: zh_CN, platform encoding: UTF-8</span><br><span class="line">OS name: <span class="string">&quot;linux&quot;</span>, version: <span class="string">&quot;3.10.0-693.el7.x86_64&quot;</span>, arch: <span class="string">&quot;amd64&quot;</span>, family: <span class="string">&quot;unix&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#将maven的下载源换成国内的</span></span><br><span class="line">[root@jenkins ~]<span class="comment"># vim /usr/local/maven/conf/settings.xml +159</span></span><br><span class="line"><span class="comment">#在159行的上面添加以下内容</span></span><br><span class="line">    &lt;mirror&gt;</span><br><span class="line">      &lt;id&gt;aliyunmaven&lt;/id&gt;</span><br><span class="line">      &lt;mirrorOf&gt;central&lt;/mirrorOf&gt;</span><br><span class="line">      &lt;name&gt;aliyun maven&lt;/name&gt;</span><br><span class="line">      &lt;url&gt;https://maven.aliyun.com/repository/public &lt;/url&gt;</span><br><span class="line">    &lt;/mirror&gt;</span><br><span class="line">:wq!</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="2-下载-jenkins-rpm-包并安装"><a href="#2-下载-jenkins-rpm-包并安装" class="headerlink" title="2. 下载 jenkins-rpm 包并安装"></a>2. 下载 jenkins-rpm 包并安装</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">//安装jenkins</span><br><span class="line">[root@jenkins ~]<span class="comment"># yum -y install jenkins-2.233-1.1.noarch.rpm</span></span><br><span class="line"></span><br><span class="line">//修改jenkins配置文件</span><br><span class="line">[root@jenkins ~]<span class="comment"># vim /etc/sysconfig/jenkins</span></span><br><span class="line">19 JENKINS_JAVA_CMD=<span class="string">&quot;/usr/local/java/bin/java&quot;</span></span><br><span class="line">29 JENKINS_USER=<span class="string">&quot;root&quot;</span>                          <span class="comment">#这里为了方便，使用root用户运行jenkins</span></span><br><span class="line">65 JENKINS_LISTEN_ADDRESS=<span class="string">&quot;192.168.2.2&quot;</span></span><br><span class="line"></span><br><span class="line">//启动jenkins</span><br><span class="line">[root@jenkins ~]<span class="comment"># systemctl start jenkins</span></span><br><span class="line">[root@jenkins ~]<span class="comment"># netstat -anptu|grep &quot;8080&quot;</span></span><br><span class="line">tcp6   0   0   192.168.2.2:8080   :::*   LISTEN   67706/java</span><br></pre></td></tr></table></figure>

<h2 id="3-jenkins-的目录介绍"><a href="#3-jenkins-的目录介绍" class="headerlink" title="3. jenkins 的目录介绍"></a>3. jenkins 的目录介绍</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># rpm -ql jenkins</span></span><br><span class="line">/etc/init.d/jenkins             <span class="comment">#jenkins的启动文件</span></span><br><span class="line">/etc/logrotate.d/jenkins        <span class="comment">#记载Jenkins日至位置的文件</span></span><br><span class="line">/etc/sysconfig/jenkins          <span class="comment">#jenkins的配置文件</span></span><br><span class="line">/usr/lib/jenkins                <span class="comment">#jenkins的war包，升级就是在这做的 </span></span><br><span class="line">/usr/lib/jenkins/jenkins.war    <span class="comment">#jenkins的程序war包</span></span><br><span class="line">/usr/sbin/rcjenkins             <span class="comment">#jenkins的为二进制文件</span></span><br><span class="line">/var/cache/jenkins              <span class="comment">#jenkins的程序文件，运行程序解压出来的</span></span><br><span class="line">/var/lib/jenkins                <span class="comment">#jenkins的主目录</span></span><br><span class="line">/var/<span class="built_in">log</span>/jenkins                <span class="comment">#jenkins的日志文件</span></span><br><span class="line">/var/lib/jenkins/workspace      <span class="comment">#拉取代码的存放路径</span></span><br><span class="line">/var/lib/jenkins/plugins/       <span class="comment">#这个目录下是我们安装所有的插件</span></span><br><span class="line">/var/lib/jenkins/secrets/initialAdminPassword       <span class="comment">#管理员密码文件</span></span><br></pre></td></tr></table></figure>

<h2 id="4-跳过-jenkins-插件安装"><a href="#4-跳过-jenkins-插件安装" class="headerlink" title="4. 跳过 jenkins 插件安装"></a>4. 跳过 jenkins 插件安装</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@jenkins ~]<span class="comment"># cat /var/lib/jenkins/secrets/initialAdminPassword</span></span><br><span class="line">3b99cdf79df747e494484426efb8bd1c         <span class="comment">#管理员密码</span></span><br></pre></td></tr></table></figure>
<ul>
<li>访问：<a target="_blank" rel="noopener" href="http://jenkins.lemon.com:8080/">http://jenkins.lemon.com:8080/</a><br><a href="">![image-20200505192734398][image-120]</a><br><a href="">![image-20200520231715521][image-121]</a><br><a href="">![image-20200520231751361][image-122]</a><br><a href="">![image-20200520231819993][image-123]</a><br><a href="">![image-20200520231859006][image-124]</a></li>
<li><strong>修改admin用户密码</strong><br>![image-20200520212137256][image-125]<br>![image-20200520212217903][image-126]<br><a href="">![image-20200520231957176][image-127]</a></li>
</ul>
<h2 id="5-更换jenkins插件下载源"><a href="#5-更换jenkins插件下载源" class="headerlink" title="5. 更换jenkins插件下载源"></a>5. 更换jenkins插件下载源</h2><p>![image-20200520212258589][image-128]<br>![image-20200520212328361][image-129]</p>
<ul>
<li><strong>清华源：</strong><a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json">https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json</a><br><a href="">![image-20200520212447372][image-130]</a></li>
<li><strong>完事之后将网页关掉并down掉 <code>jenkins</code>，替换完官方的 <code>json</code> 文件之后在启动。</strong></li>
<li><strong>注：系统重启后，<code>default.json</code> 文件会还原，所以只要系统重启就执行下面这个命令</strong>。<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@jenkins ~]<span class="comment"># systemctl stop jenkins</span></span><br><span class="line">[root@jenkins ~]<span class="comment"># cd /var/lib/jenkins/updates/</span></span><br><span class="line">[root@jenkins updates]<span class="comment"># sed -i &#x27;s/http:\/\/updates.jenkins-ci.org\/download/https:\/\/mirrors.tuna.tsinghua.edu.cn\/jenkins/g&#x27; default.json &amp;&amp; sed -i &#x27;s/http:\/\/www.google.com/https:\/\/www.baidu.com/g&#x27; default.json</span></span><br><span class="line">[root@jenkins updates]<span class="comment"># systemctl start jenkins</span></span><br><span class="line">[root@jenkins updates]<span class="comment"># netstat -anptu|grep &quot;java&quot;</span></span><br><span class="line">tcp6       0      0 192.168.2.2:8080      :::*       LISTEN      11591/java</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="6-离线安装-jenkins-插件"><a href="#6-离线安装-jenkins-插件" class="headerlink" title="6.离线安装 jenkins 插件"></a>6.离线安装 jenkins 插件</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@jenkins ~]<span class="comment"># systemctl stop jenkins</span></span><br><span class="line">[root@jenkins ~]<span class="comment"># rm -rf /var/lib/jenkins/plugins/</span></span><br><span class="line">[root@jenkins ~]<span class="comment"># tar xf jenkins-2.233_plugins.tar.gz -C /var/lib/jenkins/</span></span><br><span class="line">[root@jenkins ~]<span class="comment"># chown -R jenkins:jenkins /var/lib/jenkins/plugins/</span></span><br><span class="line">[root@jenkins ~]<span class="comment"># systemctl start jenkins</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>jenkins 插件安装完成</strong><br>![image-20200520213421856][image-131]<br>![image-20200520213450701][image-132]</li>
</ul>
<h1 id="五、Jenkins-集成-Gitlab（持续集成）"><a href="#五、Jenkins-集成-Gitlab（持续集成）" class="headerlink" title="五、Jenkins 集成 Gitlab（持续集成）"></a>五、Jenkins 集成 Gitlab（持续集成）</h1><p><strong>整体思路：</strong><br>![image-20200520233459886][image-133]</p>
<h2 id="1-在-gitlab-上创建项目并将代码推送上去"><a href="#1-在-gitlab-上创建项目并将代码推送上去" class="headerlink" title="1. 在 gitlab 上创建项目并将代码推送上去"></a>1. 在 gitlab 上创建项目并将代码推送上去</h2><ul>
<li><strong>使用pm用户基于 <code>java</code> 组创建 <code>monitor</code>项目</strong><br>![image-20200520235036801][image-134]<br>![image-20200520235313198][image-135]</li>
<li><strong>使用 <code>dev1</code> 或者 <code>dev2</code> 开发用户将monitor代码推送至此项目中</strong><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@dev1 ~]<span class="comment"># unzip monitor_html.zip                #解压我本地的项目代码</span></span><br><span class="line">[root@dev1 ~]<span class="comment"># ll</span></span><br><span class="line">总用量 13688</span><br><span class="line">drwxr-xr-x 9 root root     4096 5月  20 08:57 monitor</span><br><span class="line">-rw-r--r-- 1 root root 14008331 5月  20 08:59 monitor_html.zip</span><br><span class="line">[root@dev1 ~]<span class="comment"># cd monitor                            #进入解压后的代码目录中</span></span><br><span class="line">[root@dev1 monitor]<span class="comment"># git init                        #初始化monitor目录</span></span><br><span class="line">重新初始化现存的 Git 版本库于 /root/monitor/.git/</span><br><span class="line">[root@dev1 monitor]<span class="comment"># git add .                       #加入到暂存区</span></span><br><span class="line">[root@dev1 monitor]<span class="comment"># git status                      #查看暂存区状态</span></span><br><span class="line">[root@dev1 monitor]<span class="comment"># git commit -m &quot;NOW 1&quot;           #提交至本地仓库</span></span><br><span class="line">[master 9c1c324] NOW 1</span><br><span class="line"> 110 files changed, 65709 insertions(+), 65709 deletions(-)</span><br><span class="line"> </span><br><span class="line">[root@dev1 monitor]<span class="comment"># git remote add origin git@gitlab.lemon.com:java/monitor.git   #添加远程仓库</span></span><br><span class="line">[root@dev1 monitor]<span class="comment"># git remote -v                      #查看远程仓库（ssh协议的）</span></span><br><span class="line">origin	git@gitlab.lemon.com:java/monitor.git (fetch)</span><br><span class="line">origin	git@gitlab.lemon.com:java/monitor.git (push)</span><br><span class="line">[root@dev1 monitor]<span class="comment"># git push -u origin master          #推送代码至远程仓库</span></span><br><span class="line">Counting objects: 564, <span class="keyword">done</span>.</span><br><span class="line">Compressing objects: 100% (497/497), <span class="keyword">done</span>.</span><br><span class="line">Writing objects: 100% (564/564), 9.03 MiB | 0 bytes/s, <span class="keyword">done</span>.</span><br><span class="line">Total 564 (delta 159), reused 363 (delta 54)</span><br><span class="line">remote: Resolving deltas: 100% (159/159), <span class="keyword">done</span>.</span><br><span class="line">To git@gitlab.lemon.com:java/monitor.git</span><br><span class="line"> * [new branch]      master -&gt; master</span><br><span class="line">分支 master 设置为跟踪来自 origin 的远程分支 master。</span><br></pre></td></tr></table></figure></li>
<li><strong>查看是否推送至monitor项目中</strong><br>![image-20200521002049018][image-136]</li>
</ul>
<h2 id="2-下载集成-gitlab-的插件"><a href="#2-下载集成-gitlab-的插件" class="headerlink" title="2. 下载集成 gitlab 的插件"></a>2. 下载集成 <code>gitlab</code> 的插件</h2><ul>
<li>这些插件我都已经在上面安装好了，所以这一步可以跳过<br>![image-20200521002447884][image-137]</li>
</ul>
<h2 id="3-在-jenkins-里配置实现持续集成"><a href="#3-在-jenkins-里配置实现持续集成" class="headerlink" title="3. 在 jenkins 里配置实现持续集成"></a>3. 在 jenkins 里配置实现持续集成</h2><blockquote>
<p><strong>进入主页–创建一个新任务</strong><br>![image-20200521003043921][image-138]<br><strong>输入项目名称 freestyle-monitor—构建一个自由风格的软件项目—确认</strong><br>![image-20200521002958391][image-139]<br><strong>General–填写项目描述–Discard old builds</strong><br>![image-20200521003526153][image-140]<br><strong>源码管理–Git–添加 <code>gitlab</code> 项目的URL–授权认证</strong><br>![image-20200521003803292][image-141]<br>![image-20200521004019949][image-142]</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">//在jenkins服务器上生成私钥，马上就用</span><br><span class="line">[root@jenkins ~]<span class="comment"># ssh-keygen</span></span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file <span class="keyword">in</span> <span class="built_in">which</span> to save the key (/root/.ssh/id_rsa): </span><br><span class="line">Enter passphrase (empty <span class="keyword">for</span> no passphrase): </span><br><span class="line">Enter same passphrase again: </span><br><span class="line">Your identification has been saved <span class="keyword">in</span> /root/.ssh/id_rsa.</span><br><span class="line">Your public key has been saved <span class="keyword">in</span> /root/.ssh/id_rsa.pub.</span><br><span class="line">The key fingerprint is:</span><br><span class="line">SHA256:cYOfmb21FU4/mqzakUqAqwFPW1G7Mz2hmLti6eDfia8 root@jenkins</span><br><span class="line">The key<span class="string">&#x27;s randomart image is:</span></span><br><span class="line"><span class="string">+---[RSA 2048]----+</span></span><br><span class="line"><span class="string">|       .         |</span></span><br><span class="line"><span class="string">|      . ..       |</span></span><br><span class="line"><span class="string">|     . .o.o    o |</span></span><br><span class="line"><span class="string">|      = ++.*  o o|</span></span><br><span class="line"><span class="string">| . . = *So= . .oo|</span></span><br><span class="line"><span class="string">|  + o o + . oooo.|</span></span><br><span class="line"><span class="string">| . +.o   . o.+.  |</span></span><br><span class="line"><span class="string">|. .+= o . o o    |</span></span><br><span class="line"><span class="string">| .+E+=   o.o     |</span></span><br><span class="line"><span class="string">+----[SHA256]-----+</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[root@jenkins ~]# cat .ssh/id_rsa.pub      #公钥</span></span><br><span class="line"><span class="string">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDj13aUUWlOxpLv/tGDHF7v1dBUrs0wVirnxKXbFwetXUECnqGyd9UOHSrkkEiKW512ommbXDziX+TEa6S5QULZCrS0dM3tN4WCLyouhPbPzjiOA+HHJj0XpgXxnSz6MobeAVPByS0l9LhJkISIxl+gmz+e/VvMcSOmwOXHm70kIngA59X6xy5t2xeb0vwkQXGmoA5bQdQx32mugDT4HA1IBpoRRV3h6cfjhSW85wjdgWRGWFIRFLfLKCyBPBaGxGY7XJB9Fpu3SaMfBb85EYBk///L1Ha8dEKLkmiECrDo6SgQHWoF7GVcyzATku80NHR6boZFC4belELS2rPmTfe9 root@jenkins</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[root@jenkins ~]# cat .ssh/id_rsa          #私钥</span></span><br><span class="line"><span class="string">-----BEGIN RSA PRIVATE KEY-----</span></span><br><span class="line"><span class="string">MIIEowIBAAKCAQEA49d2lFFpTsaS7/7Rgxxe79XQVK7NMFYq58Sl2xcHrV1BAp6h</span></span><br><span class="line"><span class="string">snfVDh0q5JBIiluddqJpm1w84l/kxGukuUFC2Qq0tHTN7TeFgi8qLoT2z844jgPh</span></span><br><span class="line"><span class="string">xyY9F6YF8Z0s+jKG3gFTwcktJfS4SZCEiMZfoJs/nv1bzHEjpsDlx5u9JCJ4AOfV</span></span><br><span class="line"><span class="string">+scubdsXm9L8JEFxpqAOW0HUMd9proA0+BwNSAaaEUVd4enH44UlvOcI3YFkRlhS</span></span><br><span class="line"><span class="string">ERS3yygsgTwWhsRmO1yQfRabt0mjHwW/ORGAZP//y9R2vHRCi5JohAqw6OkoEB1q</span></span><br><span class="line"><span class="string">BexlXMswE5LvNDR0em6GRQuG3pRC0tqz5k33vQIDAQABAoIBAQDcu22CG60uSGsq</span></span><br><span class="line"><span class="string">X3CS2PWQ3VBL+l2HqrM+fuE/9HvXlTTaWNzGjhm25sMbVD0y7bcLrCUsApxppAV5</span></span><br><span class="line"><span class="string">1d9sKrGcnCadfVvTqaqKiS8QiniismNQEqq1yXH+azXu8hsU+cZ3ZknCwCghUYkI</span></span><br><span class="line"><span class="string">nB4KdEVIz58/ZK1+z01+y/rQ+yyux3GQQq7ZM+gQDhAmrgma+r/lov0itCM86Eo5</span></span><br><span class="line"><span class="string">PN9ZQ5I7m23ACQsZNjZOQ9yxIqjsYYAo+iJuT96ZUlOkPnzTwQ2mtI1SaMgPUZJb</span></span><br><span class="line"><span class="string">gjb4A3FaU0rVru+bsQX93mZEEWAQqBzr1JkE8gd4P5VCMmjxlNxQwzThKMaGsvU9</span></span><br><span class="line"><span class="string">ijqXDZaBAoGBAPzZ7y/UDLd5cMgljPtGG3buk9vWKmL32DTRShj2OdrXJO49QGy3</span></span><br><span class="line"><span class="string">uMUi9qQ3j8ShmvclKdQ3LXofEFruwBmkP0F/oEYJ5/MEXkgi1+dE8RgjIg6v7+Ww</span></span><br><span class="line"><span class="string">sAhFJrhnK+rGbVSABJ5O9bb9qmEKgZq+2W1/4Y6RF/+DSSN/jxXllP3JAoGBAOat</span></span><br><span class="line"><span class="string">zO34RMHemgQoRQCW6NOTHnWOpn1ubhMR21rNHfgwmsyaPMv/LDkBQObyKMLb4VgC</span></span><br><span class="line"><span class="string">D7jD2NW9DlTcKiZjqmjgDALxR1tt3mXZ2znTWEDI774Tc2QebJCpRIdQqKG1nm5H</span></span><br><span class="line"><span class="string">d131E5CS72cNCVmacVc9xi7kO107e6bc+34g8hRVAoGAe8/PcpEYBQN/OVJB3Yyv</span></span><br><span class="line"><span class="string">yCX82unc6YdJJFvTN7PiEonE+K+fi1zPKiD7ut/GE1e6xQg6mkLGjwUFAjHkeOnX</span></span><br><span class="line"><span class="string">W6A9/+272WCrNhFxvToiAFq7w4tdIhDJsdMCqctDUvwE7xqcqFQrt4Yw1sHJQtfv</span></span><br><span class="line"><span class="string">KdIzxZbAtIo51xsQGn3H3hkCgYAZhpnqq1JQcaVxWFNqYUiaQOlZ8NMThijAC3XO</span></span><br><span class="line"><span class="string">cmwijp5Sja60lCP8mtrns1w3U8V3y6KZu3I/FJCFa2duoBC3UjOCD9jpkRrPAnBz</span></span><br><span class="line"><span class="string">0aMuaA2/Zr+aEJPK3jArGQ3P9xz07wuSZhAoK1o6eQLT23c3RCqt/atkAbUJHeLm</span></span><br><span class="line"><span class="string">bhbbkQKBgFytaJklEVRibl0iiDYZfkzIhD/v1I43JyUmuv+VuTwGDYFx4b0jBOAm</span></span><br><span class="line"><span class="string">EeKnpRzyvmSbG52XHcJeaGt0iLaZVnpby/y04aowJC+2sQ7fGKE61PYy9WDasHBr</span></span><br><span class="line"><span class="string">uRuMiY5YzMC9LsGeSs4gF/oVt6d80M2itaqf+MSRZpT3VVpqGXw9</span></span><br><span class="line"><span class="string">-----END RSA PRIVATE KEY-----</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>把 <code>jenkins</code> 服务器上的公钥放到 <code>gitlab</code> 的  pm 账户上用来拉取代码</strong><br>![image-20200521004915704][image-143]<br>![image-20200521004934281][image-144]</li>
<li><strong>验证 <code>jenkins</code> 服务器能否克隆这个项目</strong><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@jenkins ~]<span class="comment"># git clone git@gitlab.lemon.com:java/monitor.git</span></span><br><span class="line">正克隆到 <span class="string">&#x27;monitor&#x27;</span>...</span><br><span class="line">remote: Enumerating objects: 564, <span class="keyword">done</span>.</span><br><span class="line">remote: Counting objects: 100% (564/564), <span class="keyword">done</span>.</span><br><span class="line">remote: Compressing objects: 100% (392/392), <span class="keyword">done</span>.</span><br><span class="line">remote: Total 564 (delta 159), reused 564 (delta 159)</span><br><span class="line">接收对象中: 100% (564/564), 9.03 MiB | 0 bytes/s, <span class="keyword">done</span>.</span><br><span class="line">处理 delta 中: 100% (159/159), <span class="keyword">done</span>.</span><br><span class="line"></span><br><span class="line">[root@jenkins ~]<span class="comment"># rm -rf monitor/</span></span><br><span class="line"></span><br><span class="line">//很明显，jenkins服务器已经能够克隆gitlab上的项目了</span><br></pre></td></tr></table></figure></li>
<li><strong>再回到 jenkins 的web页面上将他自己的私钥放到 jenkins 凭据上</strong><br>![image-20200521010030412][image-145]<blockquote>
<p>Credentials—选择 root<br>![image-20200521010337874][image-146]<br>![image-20200521010815380][image-147]</p>
</blockquote>
</li>
</ul>
<h2 id="4-点击立即构建"><a href="#4-点击立即构建" class="headerlink" title="4. 点击立即构建"></a>4. 点击立即构建</h2><p>![image-20200521011053244][image-148]</p>
<h2 id="5-构建成功后点击-控制台输出-和-工作区"><a href="#5-构建成功后点击-控制台输出-和-工作区" class="headerlink" title="5. 构建成功后点击 控制台输出 和 工作区"></a>5. 构建成功后点击 控制台输出 和 工作区</h2><ul>
<li><strong>点击控制台输出</strong><blockquote>
<p><strong>控制台输出，SUCCESS则构建成功</strong><br>![image-20200521011929942][image-149]<br><a href="">![image-20200521012036181][image-150]</a></p>
</blockquote>
</li>
<li><strong>点击工作去</strong><br>![image-20200521011356399][image-151]<br>![image-20200521011658186][image-152]</li>
<li><strong>查看 <code>jenkins</code> 服务器上的 <code>/var/lib/jenkins/workspace/</code> 目录是否下载了代码</strong><br>![image-20200521011751571][image-153]<blockquote>
<p><strong>可以看到，在工作目录下边有部署的代码；上面只是完成了第一步，也就是持续集成，下面我们先开始搭建集群，在修改此任务的配置（持续集成 + 持续部署）。</strong></p>
</blockquote>
</li>
</ul>
<h2 id="六、搭建web集群"><a href="#六、搭建web集群" class="headerlink" title="六、搭建web集群"></a>六、搭建web集群</h2><blockquote>
<p><strong>打开三台虚拟机</strong></p>
<p>IP  192.168.2.3         主机名  LB                  软件  nginx充当负载均衡</p>
<p>IP  192.168.2.4         主机名 web01            软件  nginxc充当web服务</p>
<p>IP  192.168.2.5         主机名 web02            软件  nginx充当web服务</p>
</blockquote>
<h2 id="1-在这三台节点上都安装nginx（操作相同）"><a href="#1-在这三台节点上都安装nginx（操作相同）" class="headerlink" title="1. 在这三台节点上都安装nginx（操作相同）"></a>1. 在这三台节点上都安装nginx（操作相同）</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#添加hosts解析文件</span></span><br><span class="line">cat &lt;&lt;<span class="string">END&gt;&gt; /etc/hosts</span></span><br><span class="line"><span class="string">192.168.2.1 gitlab.lemon.com</span></span><br><span class="line"><span class="string">192.168.2.2 jenkins.lemon.com</span></span><br><span class="line"><span class="string">192.168.2.3 lb.lemon.com</span></span><br><span class="line"><span class="string">END</span></span><br><span class="line"></span><br><span class="line">wget -O /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class="line"></span><br><span class="line">vim /etc/yum.repos.d/nginx.repo </span><br><span class="line">[nginx-stable]</span><br><span class="line">name=nginx stable repo</span><br><span class="line">baseurl=http://nginx.org/packages/centos/<span class="variable">$releasever</span>/<span class="variable">$basearch</span>/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=https://nginx.org/keys/nginx_signing.key</span><br><span class="line">module_hotfixes=<span class="literal">true</span></span><br><span class="line">[nginx-mainline]</span><br><span class="line">name=nginx mainline repo</span><br><span class="line">baseurl=http://nginx.org/packages/mainline/centos/<span class="variable">$releasever</span>/<span class="variable">$basearch</span>/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=https://nginx.org/keys/nginx_signing.key</span><br><span class="line">module_hotfixes=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line">yum clean all</span><br><span class="line">yum makecache</span><br><span class="line"></span><br><span class="line">yum -y install nginx</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改这三台的主配置文件（配置相同）</span></span><br><span class="line">vim /etc/nginx/nginx.conf</span><br><span class="line">user  nginx;</span><br><span class="line">worker_processes  1;</span><br><span class="line">error_log  /var/<span class="built_in">log</span>/nginx/error.log warn;</span><br><span class="line">pid        /var/run/nginx.pid;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       /etc/nginx/mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line">    sendfile      on;</span><br><span class="line">    keepalive_timeout  0;</span><br><span class="line">    include /etc/nginx/conf.d/*.conf;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-配置-lb-主机"><a href="#2-配置-lb-主机" class="headerlink" title="2. 配置 lb 主机"></a>2. 配置 lb 主机</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@lb ~]<span class="comment"># cd /etc/nginx/conf.d/</span></span><br><span class="line">[root@lb conf.d]<span class="comment"># gzip default.conf              #将默认的虚拟主机文件注释掉</span></span><br><span class="line"></span><br><span class="line">[root@lb conf.d]<span class="comment"># vim proxy_lb.lemon.com.conf</span></span><br><span class="line">upstream lb &#123;</span><br><span class="line">        server 192.168.2.4:80;</span><br><span class="line">        server 192.168.2.5:80;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        server_name lb.lemon.com;</span><br><span class="line">        root /code;</span><br><span class="line">        location / &#123;</span><br><span class="line">                proxy_pass http://lb;</span><br><span class="line">                proxy_set_header Host <span class="variable">$http_host</span>;</span><br><span class="line">                proxy_set_header X-Forward-For <span class="variable">$remote_addr</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">:wq!</span><br><span class="line"></span><br><span class="line">[root@lb conf.d]<span class="comment"># nginx -t</span></span><br><span class="line">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /etc/nginx/nginx.conf <span class="built_in">test</span> is successful</span><br><span class="line"></span><br><span class="line">[root@lb conf.d]<span class="comment"># systemctl start nginx;systemctl enable nginx</span></span><br><span class="line">[root@lb conf.d]<span class="comment"># netstat -anptu|grep 80</span></span><br><span class="line">tcp        0      0 0.0.0.0:80     0.0.0.0:*     LISTEN      16216/nginx: master</span><br></pre></td></tr></table></figure>

<h2 id="3-配置-web01-主机"><a href="#3-配置-web01-主机" class="headerlink" title="3. 配置 web01 主机"></a>3. 配置 web01 主机</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@web01 ~]<span class="comment"># cd /etc/nginx/conf.d/</span></span><br><span class="line">[root@web01 conf.d]<span class="comment"># gzip default.conf</span></span><br><span class="line">[root@web01 conf.d]<span class="comment"># vim nginx_01.conf</span></span><br><span class="line">server &#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        server_name localhost;</span><br><span class="line">        root /code/web;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">                index index.html;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">:wq!</span><br><span class="line"></span><br><span class="line">[root@web01 conf.d]<span class="comment"># mkdir -p /code/web</span></span><br><span class="line"></span><br><span class="line">[root@web01 conf.d]<span class="comment"># nginx -t</span></span><br><span class="line">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /etc/nginx/nginx.conf <span class="built_in">test</span> is successful</span><br><span class="line"></span><br><span class="line">[root@web01 conf.d]<span class="comment"># systemctl start nginx;systemctl enable nginx</span></span><br><span class="line">[root@web01 conf.d]<span class="comment"># netstat -anptu|grep 80</span></span><br><span class="line">tcp        0      0 0.0.0.0:80        0.0.0.0:*     LISTEN      16171/nginx: master</span><br></pre></td></tr></table></figure>

<h2 id="4-配置-web02-主机"><a href="#4-配置-web02-主机" class="headerlink" title="4. 配置 web02 主机"></a>4. 配置 web02 主机</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@web02 ~]<span class="comment"># cd /etc/nginx/conf.d/</span></span><br><span class="line">[root@web02 conf.d]<span class="comment"># gzip default.conf</span></span><br><span class="line">[root@web02 conf.d]<span class="comment"># vim nginx_02.conf</span></span><br><span class="line">server &#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        server_name localhost;</span><br><span class="line">        root /code/web;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">                index index.html;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">:wq!</span><br><span class="line"></span><br><span class="line">[root@web02 conf.d]<span class="comment"># mkdir -p /code/web</span></span><br><span class="line"></span><br><span class="line">[root@web02 conf.d]<span class="comment"># nginx -t</span></span><br><span class="line">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /etc/nginx/nginx.conf <span class="built_in">test</span> is successful</span><br><span class="line"></span><br><span class="line">[root@web02 conf.d]<span class="comment"># systemctl start nginx;systemctl enable nginx</span></span><br><span class="line">[root@web02 conf.d]<span class="comment"># netstat -anptu|grep 80</span></span><br><span class="line">tcp        0      0 0.0.0.0:80        0.0.0.0:*     LISTEN      16171/nginx: master</span><br></pre></td></tr></table></figure>

<h2 id="5-将-jenkins-服务器上的代码拷贝到两台web节点上"><a href="#5-将-jenkins-服务器上的代码拷贝到两台web节点上" class="headerlink" title="5. 将 jenkins 服务器上的代码拷贝到两台web节点上"></a>5. 将 jenkins 服务器上的代码拷贝到两台web节点上</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@jenkins ~]<span class="comment"># cd /var/lib/jenkins/workspace/freestyle-monitor</span></span><br><span class="line">[root@jenkins freestyle-monitor]<span class="comment"># scp -r ./* root@192.168.2.4:/code/web</span></span><br><span class="line">[root@jenkins freestyle-monitor]<span class="comment"># scp -r ./* root@192.168.2.5:/code/web</span></span><br></pre></td></tr></table></figure>

<h2 id="6-查看并访问-http-lb-lemon-com"><a href="#6-查看并访问-http-lb-lemon-com" class="headerlink" title="6. 查看并访问 http://lb.lemon.com/"></a>6. 查看并访问 <a target="_blank" rel="noopener" href="http://lb.lemon.com/">http://lb.lemon.com/</a></h2><p>![image-20200521024919442][image-154]<br>![image-20200521024935986][image-155]<br>![image-20200521025224964][image-156]</p>
<ul>
<li><strong>思考一个问题：</strong><ul>
<li>如果我更新了一次代码，是不是还得要再来一次上面的操作步骤？</li>
<li>是的，所以就要用到下面  <code>jenkins</code> 的持续集成 + 持续部署 功能了。</li>
</ul>
</li>
</ul>
<h1 id="七、配置freestyle-monitor任务-持续集成-持续部署"><a href="#七、配置freestyle-monitor任务-持续集成-持续部署" class="headerlink" title="七、配置freestyle-monitor任务 持续集成 + 持续部署"></a>七、配置freestyle-monitor任务 持续集成 + 持续部署</h1><h2 id="1-将手动部署代码的操作编写成shell脚本，在由-jenkins-调度将其代码推送至web集群"><a href="#1-将手动部署代码的操作编写成shell脚本，在由-jenkins-调度将其代码推送至web集群" class="headerlink" title="1. 将手动部署代码的操作编写成shell脚本，在由 jenkins 调度将其代码推送至web集群"></a>1. 将手动部署代码的操作编写成shell脚本，在由 jenkins 调度将其代码推送至web集群</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">[root@jenkins ~]<span class="comment"># mkdir /jekins_scripts                   #创建jenkins脚本存放目录</span></span><br><span class="line">[root@jenkins ~]<span class="comment"># mkdir /jekins_code_tar                  #创建jenkins代码打包存放目录</span></span><br><span class="line">[root@jenkins ~]<span class="comment"># vim /jekins_scripts/monitor_html.sh  #创建jenkins任务的相关脚本存放目录</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#时间戳</span></span><br><span class="line">DATE=`date +%Y-%m-%d-%H-%M-%S`</span><br><span class="line"></span><br><span class="line"><span class="comment">#jenkins的项目目录,这里也可以直接用jenkins自身的 WORKSPACE 变量</span></span><br><span class="line">JENKINS_DIR=<span class="string">&quot;/var/lib/jenkins/workspace/freestyle-monitor&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#web集群的站点存放目录</span></span><br><span class="line">WEB_DIR=<span class="string">&quot;/code&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#web集群IP地址</span></span><br><span class="line">WEB_IP=<span class="string">&quot;192.168.2.4 192.168.2.5&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#进入到jenkins项目目录，并进行代码打包至/jekins_code_tar目录下，在将内容通过scp至web集群 并 进行新的代码上线</span></span><br><span class="line"><span class="function"><span class="title">env_build</span></span>() &#123;</span><br><span class="line">       <span class="built_in">cd</span> <span class="variable">$&#123;JENKINS_DIR&#125;</span> &amp;&amp; tar zcf /jekins_code_tar/web-<span class="variable">$&#123;DATE&#125;</span>.tar.gz ./*</span><br><span class="line">       <span class="keyword">for</span> hosts <span class="keyword">in</span> <span class="variable">$WEB_IP</span>;<span class="keyword">do</span></span><br><span class="line">            ssh root@<span class="variable">$&#123;hosts&#125;</span> <span class="string">&quot;if [ ! -d /web_backup ]; then mkdir /web_backup ; fi&quot;</span></span><br><span class="line">            scp /jekins_code_tar/web-<span class="variable">$&#123;DATE&#125;</span>.tar.gz root@<span class="variable">$&#123;hosts&#125;</span>:/web_backup</span><br><span class="line">            ssh root@<span class="variable">$&#123;hosts&#125;</span> <span class="string">&quot;rm -rf <span class="variable">$&#123;WEB_DIR&#125;</span>/* &amp;&amp; mkdir -p <span class="variable">$&#123;WEB_DIR&#125;</span>/web-<span class="variable">$&#123;DATE&#125;</span>&quot;</span></span><br><span class="line">            ssh root@<span class="variable">$&#123;hosts&#125;</span> <span class="string">&quot;tar xf /web_backup/web-<span class="variable">$&#123;DATE&#125;</span>.tar.gz -C <span class="variable">$&#123;WEB_DIR&#125;</span>/web-<span class="variable">$&#123;DATE&#125;</span>&quot;</span></span><br><span class="line">            ssh root@<span class="variable">$&#123;hosts&#125;</span> <span class="string">&quot;ln  -s <span class="variable">$&#123;WEB_DIR&#125;</span>/web-<span class="variable">$&#123;DATE&#125;</span> <span class="variable">$&#123;WEB_DIR&#125;</span>/web&quot;</span></span><br><span class="line">       <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#调用env_build函数</span></span><br><span class="line">env_build</span><br><span class="line"></span><br><span class="line">[root@jenkins ~]<span class="comment"># chmod -R +x /jekins_scripts</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#配置web节点免登</span></span><br><span class="line">[root@jenkins ~]<span class="comment"># ssh-copy-id root@192.168.2.4</span></span><br><span class="line">[root@jenkins ~]<span class="comment"># ssh-copy-id root@192.168.2.5</span></span><br></pre></td></tr></table></figure>

<h2 id="2-配置-freestyle-monitor-项目"><a href="#2-配置-freestyle-monitor-项目" class="headerlink" title="2. 配置 freestyle-monitor 项目"></a>2. 配置 freestyle-monitor 项目</h2><ul>
<li><strong>构建 – Execute shell</strong><br>![image-20200521114008140][image-157]<br>![image-20200521114243497][image-158]</li>
</ul>
<h2 id="3-构建此项目"><a href="#3-构建此项目" class="headerlink" title="3. 构建此项目"></a>3. 构建此项目</h2><ul>
<li>在构建之前先将web集群的页面和 <code>jenkins</code> 之前拉取下的代码全都删除，以便验证<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#jenkins服务器上</span></span><br><span class="line">[root@jenkins ~]<span class="comment"># ll /var/lib/jenkins/workspace/</span></span><br><span class="line">总用量 0</span><br><span class="line">[root@jenkins ~]<span class="comment"># ll /jekins_code_tar/</span></span><br><span class="line">总用量 0</span><br><span class="line">  </span><br><span class="line"><span class="comment">#web01服务器上</span></span><br><span class="line">[root@web01 ~]<span class="comment"># ll /code/</span></span><br><span class="line">总用量 0</span><br><span class="line">[root@web01 ~]<span class="comment"># ll /web_backup</span></span><br><span class="line">ls: 无法访问/web_backup: 没有那个文件或目录</span><br><span class="line">  </span><br><span class="line"><span class="comment">#web02服务器上</span></span><br><span class="line">[root@web02 ~]<span class="comment"># ll /code/</span></span><br><span class="line">总用量 0</span><br><span class="line">[root@web01 ~]<span class="comment"># ll /web_backup</span></span><br><span class="line">ls: 无法访问/web_backup: 没有那个文件或目录</span><br></pre></td></tr></table></figure></li>
<li>现在访问lb.lemon.com就会报错<br>![image-20200521114546597][image-159]</li>
</ul>
<h2 id="4-模拟开发更新代码推送至远程仓库"><a href="#4-模拟开发更新代码推送至远程仓库" class="headerlink" title="4. 模拟开发更新代码推送至远程仓库"></a>4. 模拟开发更新代码推送至远程仓库</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@dev1 ~]<span class="comment"># cd monitor</span></span><br><span class="line">[root@dev1 monitor]<span class="comment"># vim index.html +43</span></span><br><span class="line">&lt;a class=<span class="string">&quot;logo pull-left&quot;</span> href=<span class="string">&quot;index.html&quot;</span> style=<span class="string">&quot;width: 233px&quot;</span>&gt;lemon管理平台&lt;/a&gt;</span><br><span class="line">:wq!</span><br><span class="line">[root@dev1 monitor]<span class="comment"># git add .</span></span><br><span class="line">[root@dev1 monitor]<span class="comment"># git commit -m &quot;test&quot;</span></span><br><span class="line">[master 6cc63b2] <span class="built_in">test</span></span><br><span class="line"> 1 file changed, 1 insertion(+), 1 deletion(-)</span><br><span class="line">[root@dev1 monitor]<span class="comment"># git push origin master</span></span><br><span class="line">Counting objects: 5, <span class="keyword">done</span>.</span><br><span class="line">Compressing objects: 100% (3/3), <span class="keyword">done</span>.</span><br><span class="line">Writing objects: 100% (3/3), 282 bytes | 0 bytes/s, <span class="keyword">done</span>.</span><br><span class="line">Total 3 (delta 2), reused 0 (delta 0)</span><br><span class="line">To git@gitlab.lemon.com:java/monitor.git</span><br><span class="line">   481be52..6cc63b2  master -&gt; master</span><br></pre></td></tr></table></figure>

<h2 id="5-jenkins构建项目"><a href="#5-jenkins构建项目" class="headerlink" title="5. jenkins构建项目"></a>5. jenkins构建项目</h2><p>![image-20200521114623360][image-160]<br><a href="">![image-20200521114714801][image-161]</a><br>![image-20200522005243240][image-162]</p>
<h2 id="6-然后在访问一下lb-lemon-com"><a href="#6-然后在访问一下lb-lemon-com" class="headerlink" title="6. 然后在访问一下lb.lemon.com"></a>6. 然后在访问一下lb.lemon.com</h2><p>![image-20200522011420421][image-163]</p>
<h2 id="7-查看对应的目录"><a href="#7-查看对应的目录" class="headerlink" title="7. 查看对应的目录"></a>7. 查看对应的目录</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#jenkins服务器上</span></span><br><span class="line">[root@jenkins ~]<span class="comment"># ll  /var/lib/jenkins/workspace/</span></span><br><span class="line">总用量 4</span><br><span class="line">drwxr-xr-x 9 root root 4096 5月  22 00:50 freestyle-monitor</span><br><span class="line">drwxr-xr-x 2 root root    6 5月  22 00:50 freestyle-monitor@tmp</span><br><span class="line">[root@jenkins ~]<span class="comment"># ll /jekins_code_tar/</span></span><br><span class="line">总用量 4552</span><br><span class="line">-rw-r--r-- 1 root root 4659825 5月  22 00:50 web-2020-05-22-00-50-30.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment">#web01服务器上</span></span><br><span class="line">[root@web01 ~]<span class="comment"># ll /code/</span></span><br><span class="line">总用量 4</span><br><span class="line">lrwxrwxrwx 1 root root   29 5月  22 00:50 web -&gt; /code/web-2020-05-22-00-50-30</span><br><span class="line">drwxr-xr-x 8 root root 4096 5月  22 00:50 web-2020-05-22-00-50-30</span><br><span class="line">[root@web01 ~]<span class="comment"># ll /web_backup</span></span><br><span class="line">总用量 4552</span><br><span class="line">-rw-r--r-- 1 root root 4659825 5月  22 00:50 web-2020-05-22-00-50-30.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment">#web02服务器上</span></span><br><span class="line">[root@web02 ~]<span class="comment"># ll /code/</span></span><br><span class="line">总用量 4</span><br><span class="line">lrwxrwxrwx 1 root root   29 5月  22 00:50 web -&gt; /code/web-2020-05-22-00-50-30</span><br><span class="line">drwxr-xr-x 8 root root 4096 5月  22 00:50 web-2020-05-22-00-50-30</span><br><span class="line">[root@web02 ~]<span class="comment"># ll /web_backup</span></span><br><span class="line">总用量 4552</span><br><span class="line">-rw-r--r-- 1 root root 4659825 5月  22 00:50 web-2020-05-22-00-50-30.tar.gz</span><br></pre></td></tr></table></figure>

<h2 id="8-注意事项："><a href="#8-注意事项：" class="headerlink" title="8. 注意事项："></a>8. 注意事项：</h2><p><strong>1. Jenkins的启动用户得是root，不然会报错！因为ssh免登用的是root用户做的</strong><br><strong>2. 如果做了上面的步骤后还是报错，就执行命令删除rm -rf known_hosts。</strong><br><strong>3. 以上就是一个简单的不能再简单的静态页面 持续集成 + 持续部署项目</strong></p>
<h2 id="9-现在这个项目的配置还存在一些问题"><a href="#9-现在这个项目的配置还存在一些问题" class="headerlink" title="9. 现在这个项目的配置还存在一些问题"></a>9. 现在这个项目的配置还存在一些问题</h2><ul>
<li>怎么指定要构建的版本？<ul>
<li>答：需要定义 参数化构建过程的（Choice Parameter 和 Git Parameter）</li>
</ul>
</li>
<li>怎么不让已经构建成功后项目 构建？<ul>
<li>答：使用 <code>jenkins</code> 自带的两个变量进行判断</li>
</ul>
</li>
</ul>
<h2 id="10-解决上面两个存在的问题"><a href="#10-解决上面两个存在的问题" class="headerlink" title="10. 解决上面两个存在的问题"></a>10. 解决上面两个存在的问题</h2><ul>
<li><strong>由于之前的上线方式是直接获取最新代码，它会对后期版本回退的困难。</strong></li>
<li><strong>如果采用tag方式，比如第一次上线 v1.1 、第二次上线 v1.2 ，如果上线 v1.2 出现问题后，我们还可以使用tag快速回退至上一个版本的 v1.1 。</strong></li>
</ul>
<h2 id="11-实现tag版本上线的思路"><a href="#11-实现tag版本上线的思路" class="headerlink" title="11. 实现tag版本上线的思路"></a>11. 实现tag版本上线的思路</h2><ol>
<li><strong>开发如果需要发布新版本上线，必须将当前的版本打上一个标签。</strong></li>
<li><strong>配置jenkins任务的参数化构建过程；Choice Parameter 和 Git Parameter</strong></li>
<li><strong>jenkins需要让其脚本支持传参，比如：用户传递 v1.1 则拉取项目的 v1.1 标签</strong></li>
</ol>
<h2 id="12-jenkins配置tag版本的部署"><a href="#12-jenkins配置tag版本的部署" class="headerlink" title="12. jenkins配置tag版本的部署"></a>12. jenkins配置tag版本的部署</h2><ul>
<li>首先安装 Git Parameter插件，然后配置jenkins参数化构建，再让用户构建时选择对应的tag版本。<br>![image-20200521213401721][image-164]</li>
<li>添加 参数化构建过程（This project is parameterized）—&gt; Choice Parameter —&gt; Git Parameter<br>![image-20200521215729330][image-165]</li>
<li>配置 Choice Parameter 选项参数<br><a href="">![image-20200522021453925][image-166]</a></li>
<li>配置 Git Parameter 并  修改源码管理的 Git分支参数<br><a href="">![image-20200522013349907][image-167]</a><br>![image-20200522013610814][image-168]</li>
<li>修改jenkins上的 monitor_html.sh 脚本<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">[root@jenkins ~]<span class="comment"># vim /jekins_scripts/monitor_html.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#时间戳</span></span><br><span class="line">DATE=`date +%Y-%m-%d-%H-%M-%S`</span><br><span class="line">DATE_TAG=<span class="variable">$&#123;DATE&#125;</span>-<span class="variable">$&#123;GIT_VERSION&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#jenkins的项目目录,这里也可以直接用jenkins自身的 WORKSPACE 变量</span></span><br><span class="line">JENKINS_DIR=<span class="string">&quot;/var/lib/jenkins/workspace/freestyle-monitor&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#web集群的站点存放目录</span></span><br><span class="line">WEB_DIR=<span class="string">&quot;/code&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#web集群IP地址</span></span><br><span class="line">WEB_IP=<span class="string">&quot;192.168.2.4 192.168.2.5&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#进入到jenkins项目目录，并进行代码打包至/jekins_code_tar目录下，在将内容通过scp至web集群 并 进行新的代码上线</span></span><br><span class="line"><span class="function"><span class="title">env_build</span></span>() &#123;</span><br><span class="line">       <span class="built_in">cd</span> <span class="variable">$&#123;JENKINS_DIR&#125;</span> &amp;&amp; tar zcf /jekins_code_tar/web-<span class="variable">$&#123;DATE_TAG&#125;</span>.tar.gz ./*</span><br><span class="line">       <span class="keyword">for</span> hosts <span class="keyword">in</span> <span class="variable">$WEB_IP</span>;<span class="keyword">do</span></span><br><span class="line">            ssh root@<span class="variable">$&#123;hosts&#125;</span> <span class="string">&quot;if [ ! -d /web_backup ]; then mkdir /web_backup ; fi&quot;</span></span><br><span class="line">            scp /jekins_code_tar/web-<span class="variable">$&#123;DATE_TAG&#125;</span>.tar.gz root@<span class="variable">$&#123;hosts&#125;</span>:/web_backup</span><br><span class="line">            ssh root@<span class="variable">$&#123;hosts&#125;</span> <span class="string">&quot;rm -rf <span class="variable">$&#123;WEB_DIR&#125;</span>/* &amp;&amp; mkdir -p <span class="variable">$&#123;WEB_DIR&#125;</span>/web-<span class="variable">$&#123;DATE_TAG&#125;</span>&quot;</span></span><br><span class="line">            ssh root@<span class="variable">$&#123;hosts&#125;</span> <span class="string">&quot;tar xf /web_backup/web-<span class="variable">$&#123;DATE_TAG&#125;</span>.tar.gz -C <span class="variable">$&#123;WEB_DIR&#125;</span>/web-<span class="variable">$&#123;DATE_TAG&#125;</span>&quot;</span></span><br><span class="line">            ssh root@<span class="variable">$&#123;hosts&#125;</span> <span class="string">&quot;ln  -s <span class="variable">$&#123;WEB_DIR&#125;</span>/web-<span class="variable">$&#123;DATE_TAG&#125;</span> <span class="variable">$&#123;WEB_DIR&#125;</span>/web&quot;</span></span><br><span class="line">       <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#jenkins这边保留最近提交的五个代码tar包，其余的全部删掉，web那里只保留三个tar包</span></span><br><span class="line"><span class="function"><span class="title">env_clear</span></span>() &#123;</span><br><span class="line">       <span class="comment">#-----------清除web节点的tar包(只保留三个)------</span></span><br><span class="line">       <span class="keyword">for</span> hosts <span class="keyword">in</span> <span class="variable">$WEB_IP</span>;<span class="keyword">do</span></span><br><span class="line">            ssh root@<span class="variable">$&#123;hosts&#125;</span> <span class="string">&quot;bash -x /opt/clear_latest.sh&quot;</span></span><br><span class="line">       <span class="keyword">done</span></span><br><span class="line">       <span class="comment">#-----------清除jenkins节点的tar包(只保留五个)--</span></span><br><span class="line">       ReservedNum=5</span><br><span class="line">       FileDir=/jekins_code_tar</span><br><span class="line">       FileNum=$(ls -l <span class="variable">$FileDir</span>|grep ^- |wc -l)</span><br><span class="line">       <span class="keyword">while</span>(( <span class="variable">$FileNum</span> &gt; <span class="variable">$ReservedNum</span>));<span class="keyword">do</span></span><br><span class="line">       OldFile=$(ls -rt <span class="variable">$FileDir</span>| head -1)</span><br><span class="line">            rm -rf <span class="variable">$FileDir</span>/<span class="variable">$OldFile</span></span><br><span class="line">            <span class="built_in">let</span> <span class="string">&quot;FileNum--&quot;</span></span><br><span class="line">       <span class="keyword">done</span>       </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#判断到底是调用env_build函数 还是调用evn_clear函数；其实这里的值就是根据上面的 Choice Parameter 选项而定的</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$BUILD_CLEAR</span> == <span class="string">&quot;build&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">       env_build</span><br><span class="line"><span class="keyword">elif</span> [ <span class="variable">$BUILD_CLEAR</span> == <span class="string">&quot;clear&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">       env_clear</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure></li>
<li>在web节点上的opt目录下编写 clear_latest.sh 脚本（在此只实例web01，一样的内容）<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@dev1 ~]<span class="comment"># vim /opt/clear_latest.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment">#保留文件数，这里只保留最新的前三个版本</span></span><br><span class="line">ReservedNum=3</span><br><span class="line">FileDir=/web_backup</span><br><span class="line">date=$(date <span class="string">&quot;+%Y%m%d-%H%M%S&quot;</span>)</span><br><span class="line"></span><br><span class="line">FileNum=$(ls -l <span class="variable">$FileDir</span>|grep ^- |wc -l)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(( <span class="variable">$FileNum</span> &gt; <span class="variable">$ReservedNum</span>));<span class="keyword">do</span></span><br><span class="line">    OldFile=$(ls -rt <span class="variable">$FileDir</span>| head -1)</span><br><span class="line">    <span class="built_in">echo</span>  <span class="variable">$date</span> <span class="string">&quot;Delete File:&quot;</span><span class="variable">$OldFile</span></span><br><span class="line">    rm -rf <span class="variable">$FileDir</span>/<span class="variable">$OldFile</span></span><br><span class="line">    <span class="built_in">let</span> <span class="string">&quot;FileNum--&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">[root@web01 ~]<span class="comment"># chmod a+x /opt/clear_latest.sh</span></span><br></pre></td></tr></table></figure></li>
<li>开发更新代码，推送至远程仓库并打上标签（这里我实际上推送了三个tag标签）<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@dev1 ~]<span class="comment"># cd monitor</span></span><br><span class="line">[root@dev1 monitor]<span class="comment"># vim index.html +43</span></span><br><span class="line">&lt;a class=<span class="string">&quot;logo pull-left&quot;</span> href=<span class="string">&quot;index.html&quot;</span> style=<span class="string">&quot;width: 233px&quot;</span>&gt;lemon管理平台 v1.1&lt;/a&gt;</span><br><span class="line">:wq!</span><br><span class="line">[root@dev1 monitor]<span class="comment"># git add .</span></span><br><span class="line">[root@dev1 monitor]<span class="comment"># git commit -m &quot;v1.1&quot;</span></span><br><span class="line">[root@dev1 monitor]<span class="comment"># git push origin master</span></span><br><span class="line">[root@dev1 monitor]<span class="comment"># git tag -a &quot;v1.1&quot; -m &quot;v1.1&quot;</span></span><br><span class="line">[root@dev1 monitor]<span class="comment"># git push origin v1.1</span></span><br></pre></td></tr></table></figure></li>
<li>查看一下效果 并 进行构建 并查看 控制台信息<br>![image-20200522030745369][image-169]<br>![image-20200522032613859][image-170]</li>
<li>访问web服务查看是否更新到我想要的版本中<br>![image-20200522032725481][image-171]</li>
<li>查看我构建的tar包有多少了，然后使用clear清除（注意：此功能在工作环境上要慎重使用！！！！）<br>![image-20200522033011358][image-172]<br>![image-20200522033030405][image-173]<br>![image-20200522033044114][image-174]</li>
<li>调用clear构建 –&gt; 就是在运行脚本中的env_clear函数 —&gt;  查看 控制台信息<br>![image-20200522033129964][image-175]<br><a href="">![image-20200522034347752][image-176]</a></li>
<li>与上面对比一下可以看到，这个功能也实现了<br>![image-20200522040612025][image-177]<br>![image-20200522033703796][image-178]<br>![image-20200522033717301][image-179]</li>
</ul>
<h2 id="13-解决项目重复构建-和-无法精确回滚-的问题-可在生产环境使用"><a href="#13-解决项目重复构建-和-无法精确回滚-的问题-可在生产环境使用" class="headerlink" title="13. 解决项目重复构建 和 无法精确回滚 的问题 (可在生产环境使用)"></a>13. 解决项目重复构建 和 无法精确回滚 的问题 (可在生产环境使用)</h2><ul>
<li>在jenkins任务中的参数化构建中的选项构建那里 在添加一个rollback的选项参数<br>![image-20200522094542164][image-180]</li>
<li>修改脚本<ul>
<li>在脚本中添加一个 <code>env_rollabck</code> 的函数，并在脚本中使用 Jenkins自带的 <code>GIT_COMMIT</code> 和 <code>GIT_PREVIOUS_SUCCESSFUL_COMMIT</code>  进行判断<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">[root@jenkins ~]<span class="comment"># vim /jekins_scripts/monitor_html.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#时间戳</span></span><br><span class="line">DATE=`date +%Y-%m-%d-%H-%M-%S`</span><br><span class="line">DATE_TAG=<span class="variable">$&#123;DATE&#125;</span>-<span class="variable">$&#123;GIT_VERSION&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#jenkins的项目目录,这里也可以直接用jenkins自身的 WORKSPACE 变量</span></span><br><span class="line">JENKINS_DIR=<span class="string">&quot;/var/lib/jenkins/workspace/freestyle-monitor&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#web集群的站点存放目录</span></span><br><span class="line">WEB_DIR=<span class="string">&quot;/code&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#web集群IP地址</span></span><br><span class="line">WEB_IP=<span class="string">&quot;192.168.2.4 192.168.2.5&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#进入到jenkins项目目录，并进行代码打包至/jekins_code_tar目录下，在将内容通过scp至web集群 并 进行新的代码上线</span></span><br><span class="line"><span class="function"><span class="title">env_build</span></span>() &#123;</span><br><span class="line">       <span class="built_in">cd</span> <span class="variable">$&#123;JENKINS_DIR&#125;</span> &amp;&amp; tar zcf /jekins_code_tar/web-<span class="variable">$&#123;DATE_TAG&#125;</span>.tar.gz ./*</span><br><span class="line">       <span class="keyword">for</span> hosts <span class="keyword">in</span> <span class="variable">$WEB_IP</span>;<span class="keyword">do</span></span><br><span class="line">            ssh root@<span class="variable">$&#123;hosts&#125;</span> <span class="string">&quot;if [ ! -d /web_backup ]; then mkdir /web_backup ; fi&quot;</span></span><br><span class="line">            scp /jekins_code_tar/web-<span class="variable">$&#123;DATE_TAG&#125;</span>.tar.gz root@<span class="variable">$&#123;hosts&#125;</span>:/web_backup</span><br><span class="line">            ssh root@<span class="variable">$&#123;hosts&#125;</span> <span class="string">&quot;rm -rf <span class="variable">$&#123;WEB_DIR&#125;</span>/* &amp;&amp; mkdir -p <span class="variable">$&#123;WEB_DIR&#125;</span>/web-<span class="variable">$&#123;DATE_TAG&#125;</span>&quot;</span></span><br><span class="line">            ssh root@<span class="variable">$&#123;hosts&#125;</span> <span class="string">&quot;tar xf /web_backup/web-<span class="variable">$&#123;DATE_TAG&#125;</span>.tar.gz -C <span class="variable">$&#123;WEB_DIR&#125;</span>/web-<span class="variable">$&#123;DATE_TAG&#125;</span>&quot;</span></span><br><span class="line">            ssh root@<span class="variable">$&#123;hosts&#125;</span> <span class="string">&quot;ln  -s <span class="variable">$&#123;WEB_DIR&#125;</span>/web-<span class="variable">$&#123;DATE_TAG&#125;</span> <span class="variable">$&#123;WEB_DIR&#125;</span>/web&quot;</span></span><br><span class="line">       <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#回滚函数</span></span><br><span class="line"><span class="function"><span class="title">env_rollback</span></span>() &#123;</span><br><span class="line">       ROLL_BACKUP=`ssh root@192.168.2.4 <span class="string">&quot;find /web_backup -maxdepth 1 -type f -name &quot;</span>*<span class="variable">$&#123;GIT_VERSION&#125;</span>*<span class="string">&quot; &quot;</span>`</span><br><span class="line">       <span class="keyword">for</span> hosts <span class="keyword">in</span> <span class="variable">$WEB_IP</span>;<span class="keyword">do</span></span><br><span class="line">            ssh root@<span class="variable">$&#123;hosts&#125;</span> <span class="string">&quot;rm -rf <span class="variable">$&#123;WEB_DIR&#125;</span>/* &amp;&amp; mkdir -p <span class="variable">$&#123;WEB_DIR&#125;</span>/web-<span class="variable">$&#123;DATE_TAG&#125;</span>&quot;</span></span><br><span class="line">            ssh root@<span class="variable">$&#123;hosts&#125;</span> <span class="string">&quot;tar xf <span class="variable">$&#123;ROLL_BACKUP&#125;</span> -C <span class="variable">$&#123;WEB_DIR&#125;</span>/web-<span class="variable">$&#123;DATE_TAG&#125;</span>&quot;</span></span><br><span class="line">            ssh root@<span class="variable">$&#123;hosts&#125;</span> <span class="string">&quot;ln  -s <span class="variable">$&#123;WEB_DIR&#125;</span>/web-<span class="variable">$&#123;DATE_TAG&#125;</span> <span class="variable">$&#123;WEB_DIR&#125;</span>/web&quot;</span></span><br><span class="line">       <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#jenkins这边保留最近提交的五个代码tar包，其余的全部删掉，web那里只保留三个tar包</span></span><br><span class="line"><span class="function"><span class="title">env_clear</span></span>() &#123;</span><br><span class="line">       <span class="comment">#-----------清除web节点的tar包(只保留三个)------</span></span><br><span class="line">       <span class="keyword">for</span> hosts <span class="keyword">in</span> <span class="variable">$WEB_IP</span>;<span class="keyword">do</span></span><br><span class="line">            ssh root@<span class="variable">$&#123;hosts&#125;</span> <span class="string">&quot;bash -x /opt/clear_latest.sh&quot;</span></span><br><span class="line">       <span class="keyword">done</span></span><br><span class="line">       <span class="comment">#-----------清除jenkins节点的tar包(只保留五个)--</span></span><br><span class="line">       ReservedNum=5</span><br><span class="line">       FileDir=/jekins_code_tar</span><br><span class="line">       FileNum=$(ls -l <span class="variable">$FileDir</span>|grep ^- |wc -l)</span><br><span class="line">       <span class="keyword">while</span>(( <span class="variable">$FileNum</span> &gt; <span class="variable">$ReservedNum</span>));<span class="keyword">do</span></span><br><span class="line">       OldFile=$(ls -rt <span class="variable">$FileDir</span>| head -1)</span><br><span class="line">            rm -rf <span class="variable">$FileDir</span>/<span class="variable">$OldFile</span></span><br><span class="line">            <span class="built_in">let</span> <span class="string">&quot;FileNum--&quot;</span></span><br><span class="line">       <span class="keyword">done</span>       </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#判断到底是调用env_build函数 还是调用evn_clear函数，并且在构建的时候会先判断一下此</span></span><br><span class="line"><span class="comment">#次构建的版本之前有没有构建够，如果构建过，那么将不再构建，如果没有，就构建此项目</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$BUILD_CLEAR</span> == <span class="string">&quot;build&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">       <span class="keyword">if</span> [ <span class="variable">$&#123;GIT_COMMIT&#125;</span> == <span class="variable">$&#123;GIT_PREVIOUS_SUCCESSFUL_COMMIT&#125;</span> ];<span class="keyword">then</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&quot;你已经成功构建过web-<span class="variable">$&#123;DATE_TAG&#125;</span>项目了&quot;</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&quot;你可以直接使用rollback的方式进行回滚web-<span class="variable">$&#123;DATE_TAG&#125;</span>项目版本&quot;</span></span><br><span class="line">                <span class="built_in">exit</span> 1</span><br><span class="line">       <span class="keyword">else</span></span><br><span class="line">                env_build</span><br><span class="line">       <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">elif</span> [ <span class="variable">$BUILD_CLEAR</span> == <span class="string">&quot;rollback&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">       env_rollback</span><br><span class="line"><span class="keyword">elif</span> [ <span class="variable">$BUILD_CLEAR</span> == <span class="string">&quot;clear&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">       env_clear</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>开发在重新推送两个新的分支<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@dev1 ~]<span class="comment"># cd monitor</span></span><br><span class="line">[root@dev1 monitor]<span class="comment"># vim index.html +43</span></span><br><span class="line">&lt;a class=<span class="string">&quot;logo pull-left&quot;</span> href=<span class="string">&quot;index.html&quot;</span> style=<span class="string">&quot;width: 233px&quot;</span>&gt;lemon管理平台 v1.4 &lt;/a&gt;</span><br><span class="line">:wq!</span><br><span class="line">[root@dev1 monitor]<span class="comment"># git add .</span></span><br><span class="line">[root@dev1 monitor]<span class="comment"># git commit -m &quot;v1.4&quot;</span></span><br><span class="line">[root@dev1 monitor]<span class="comment"># git push origin master</span></span><br><span class="line">[root@dev1 monitor]<span class="comment"># git tag -a &quot;v1.4&quot; -m &quot;v1.4&quot;</span></span><br><span class="line">[root@dev1 monitor]<span class="comment"># git push origin v1.4</span></span><br><span class="line"></span><br><span class="line">[root@dev1 monitor]<span class="comment"># vim index.html +43</span></span><br><span class="line">&lt;a class=<span class="string">&quot;logo pull-left&quot;</span> href=<span class="string">&quot;index.html&quot;</span> style=<span class="string">&quot;width: 233px&quot;</span>&gt;lemon管理平台 v1.5 &lt;/a&gt;</span><br><span class="line">:wq!</span><br><span class="line">[root@dev1 monitor]<span class="comment"># git add .</span></span><br><span class="line">[root@dev1 monitor]<span class="comment"># git commit -m &quot;v1.5&quot;</span></span><br><span class="line">[root@dev1 monitor]<span class="comment"># git push origin master</span></span><br><span class="line">[root@dev1 monitor]<span class="comment"># git tag -a &quot;v1.5&quot; -m &quot;v1.5&quot;</span></span><br><span class="line">[root@dev1 monitor]<span class="comment"># git push origin v1.5</span></span><br></pre></td></tr></table></figure></li>
<li>重复构建一下v1.5的版本<br>![image-20200522101126718][image-181]<br>![image-20200522103032311][image-182]<br>![image-20200522103116779][image-183]<br>![image-20200522102810984][image-184]</li>
<li>那比如我想在使用构建回到了v1.4的版本中，怎么才可以重新再回到v1.5版本的？<ul>
<li>答：使用我上面定义好的rollback函数会退就行了<br>![image-20200522103401222][image-185]<br>![image-20200522103858070][image-186]<br>![image-20200522110221733][image-187]</li>
</ul>
</li>
<li>再来测试清空tar包的功能还能否使用（注意：此功能在工作环境上要慎重使用！！！！）<br>![image-20200522110429290][image-188]<br>![image-20200522110438627][image-189]<br>![image-20200522110453895][image-190]<br>![image-20200522110520679][image-191]<br>![image-20200522110533954][image-192]<br>![image-20200522110545403][image-193]</li>
</ul>
<p><strong>注意：如果此时在想回退到v1.1 和v1.3 版本的时候会失败的，因为web节点上的这两个版本包已经被被我清空了，所以 clear这个函数在公司的时候要慎重使用！！！！【最好就别写这个函数方法最好】</strong></p>
<p><strong>至此，jenkins的使用就算是基本完成了，只要上面的内容会了，那么至于java项目那块基本上和上面的操作没有太大的区别</strong></p>
<h1 id="八、GitLab-Jenkins-Sonar-Qube-持续集成"><a href="#八、GitLab-Jenkins-Sonar-Qube-持续集成" class="headerlink" title="八、GitLab + Jenkins + Sonar Qube 持续集成"></a>八、GitLab + Jenkins + Sonar Qube 持续集成</h1><h2 id="1-java项目部署的基本概述"><a href="#1-java项目部署的基本概述" class="headerlink" title="1. java项目部署的基本概述"></a>1. java项目部署的基本概述</h2><h3 id="1-1-什么是-java-项目？"><a href="#1-1-什么是-java-项目？" class="headerlink" title="1.1 什么是 java 项目？"></a>1.1 什么是 java 项目？</h3><ul>
<li>简单来说就是用 java 编写的代码，我将其称为 java 项目<h3 id="1-2-为什么java项目需要Maven编译？"><a href="#1-2-为什么java项目需要Maven编译？" class="headerlink" title="1.2 为什么java项目需要Maven编译？"></a>1.2 为什么java项目需要Maven编译？</h3></li>
<li>由于 java 编写的代码是无法直接在服务器上运行的，需要使用Maven工具进行构建打成war包后才能在服务器上运行</li>
<li>简单理解：java 源代码就是你在菜市场的买回家的菜，你买了之后并不是直接放嘴里就吃的，而是先回到家里进行一次加工后（Maven）才吃的。</li>
</ul>
<h2 id="2-jenkins手动部署java项目至web集群"><a href="#2-jenkins手动部署java项目至web集群" class="headerlink" title="2. jenkins手动部署java项目至web集群"></a>2. jenkins手动部署java项目至web集群</h2><h3 id="2-1-搭建Nginx-Tomcat-MySQL-Sonar-Qube-集群"><a href="#2-1-搭建Nginx-Tomcat-MySQL-Sonar-Qube-集群" class="headerlink" title="2.1 搭建Nginx + Tomcat + MySQL + Sonar Qube 集群"></a>2.1 搭建Nginx + Tomcat + MySQL + Sonar Qube 集群</h3><ul>
<li>这里前 nginx 和 tomcat 这两部分的机器我们就不用考虑了，因为我们在上面就已经准备好了，我们只需要重新配置一下 nginx 负载均衡并在另外两台机器上安装一下Tomcat就行了。至于 MySQL 和 Sonar Qube 的话，我这里因机器不够用了，所以就直接把 MySQL 部署到 dev1 主机上 Sonar Qube 部署到 dev2 上就行了，不会有什么影响。</li>
</ul>
<ol>
<li>修改lb的 nginx 配置文件<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@lb ~]<span class="comment"># vim /etc/nginx/conf.d/proxy_lb.lemon.com.conf</span></span><br><span class="line">upstream lb &#123;</span><br><span class="line">        server 192.168.2.4:8080;</span><br><span class="line">        server 192.168.2.5:8080;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        server_name lb.lemon.com;</span><br><span class="line">        root /code;</span><br><span class="line">        location / &#123;</span><br><span class="line">                proxy_pass http://lb;</span><br><span class="line">                proxy_set_header Host <span class="variable">$http_host</span>;</span><br><span class="line">                proxy_set_header X-Forward-For <span class="variable">$remote_addr</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[root@lb ~]<span class="comment"># systemctl restart nginx</span></span><br></pre></td></tr></table></figure></li>
</ol>
<ul>
<li>现在访问负载均衡的话会报502错误，这很正常，因为我们还没有部署tomcat<br>![image-20200523092927454][image-194]</li>
</ul>
<ol start="2">
<li>在另外两台web节点上关闭 nginx 服务 并安装启动 Tomcat<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop nginx</span><br><span class="line">tar xf jdk-8u181-linux-x64.tar.gz</span><br><span class="line">mv jdk1.8.0_181 /usr/<span class="built_in">local</span>/java</span><br><span class="line">cat &lt;&lt;<span class="string">END&gt;&gt; /etc/profile</span></span><br><span class="line"><span class="string">export JAVA_HOME=/usr/local/java</span></span><br><span class="line"><span class="string">export PATH=$JAVA_HOME/bin:$PATH</span></span><br><span class="line"><span class="string">export CLASSPATH=$JAVA_HOME/lib/tools.jar:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib</span></span><br><span class="line"><span class="string">END</span></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line">tar xf apache-tomcat-8.5.32.tar.gz</span><br><span class="line">mv apache-tomcat-8.5.32 /usr/<span class="built_in">local</span>/tomcat</span><br><span class="line">/usr/<span class="built_in">local</span>/tomcat/bin/startup.sh </span><br><span class="line">netstat -anptu|grep <span class="string">&quot;8080&quot;</span></span><br><span class="line">tcp6       0      0 :::8080      :::*            LISTEN      1353/java</span><br></pre></td></tr></table></figure></li>
</ol>
<ul>
<li>在访问一下负载均衡<br>![image-20200523093055372][image-195]</li>
<li>但是看不出来是否已经负载均衡了，我们去修改两个tomcat的页面就行了<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@web01 ~]<span class="comment"># vim /usr/local/tomcat/webapps/ROOT/index.jsp +52</span></span><br><span class="line">&lt;h2&gt;Tomcat web01-192.168.2.4&lt;/h2&gt;</span><br><span class="line"><span class="comment">#最好重启一下tomcat</span></span><br><span class="line"></span><br><span class="line">[root@web02 ~]<span class="comment"># vim /usr/local/tomcat/webapps/ROOT/index.jsp +52</span></span><br><span class="line">&lt;h2&gt;Tomcat web02-192.168.2.5&lt;/h2&gt;</span><br><span class="line"><span class="comment">#最好重启一下tomcat</span></span><br></pre></td></tr></table></figure></li>
<li>再来访问<br>![image-20200523093517896][image-196]<br>![image-20200523093549527][image-197]</li>
</ul>
<ol start="3">
<li>提前先在 dev1 节点上部署好 MySQL ，一会用的 Sonar Qube 的时候会使用，现在还用不上</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@dev1 ~]<span class="comment"># yum -y install mariadb-server</span></span><br><span class="line">[root@dev1 ~]<span class="comment"># systemctl start mariadb;systemctl enable mariadb</span></span><br><span class="line">[root@dev1 ~]<span class="comment"># mysqladmin -u root password &#x27;123123&#x27;</span></span><br><span class="line">[root@dev1 ~]<span class="comment"># mysql -uroot -p123123</span></span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 8</span><br><span class="line">Server version: 5.5.65-MariaDB MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type <span class="string">&#x27;help;&#x27;</span> or <span class="string">&#x27;\h&#x27;</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">&#x27;\c&#x27;</span> to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| <span class="built_in">test</span>               |</span><br><span class="line">+--------------------+</span><br><span class="line">4 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; <span class="built_in">exit</span></span><br></pre></td></tr></table></figure>
<h3 id="2-2-新建一个gitlab的-hello-world-项目仓库"><a href="#2-2-新建一个gitlab的-hello-world-项目仓库" class="headerlink" title="2.2 新建一个gitlab的 hello world 项目仓库"></a>2.2 新建一个gitlab的 hello world 项目仓库</h3><p>![image-20200523095831415][image-198]<br><a href="">![image-20200523095953535][image-199]</a></p>
<h3 id="2-3-使用git将其java代码上传到hello-world仓库"><a href="#2-3-使用git将其java代码上传到hello-world仓库" class="headerlink" title="2.3 使用git将其java代码上传到hello-world仓库"></a>2.3 使用git将其java代码上传到hello-world仓库</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@dev1 hello-world]<span class="comment"># pwd</span></span><br><span class="line">/root/hello-world</span><br><span class="line"></span><br><span class="line">[root@dev1 hello-world]<span class="comment"># ll -a</span></span><br><span class="line">总用量 16</span><br><span class="line">-rw-r--r--  1 root root  700 12月 23 2018 .classpath</span><br><span class="line">-rw-r--r--  1 root root 1113 12月 23 2018 pom.xml</span><br><span class="line">-rw-r--r--  1 root root 1081 12月 23 2018 .project</span><br><span class="line">drwxr-xr-x  2 root root  322 6月  11 16:31 .settings</span><br><span class="line">drwxr-xr-x  3 root root   18 6月  11 16:31 src</span><br><span class="line">drwxr-xr-x  5 root root   56 6月  11 16:31 target</span><br><span class="line">-rw-r--r--  1 root root  491 12月 20 2018 time.java</span><br><span class="line"></span><br><span class="line">[root@dev1 hello-world]<span class="comment"># git init</span></span><br><span class="line">初始化空的 Git 版本库于 /root/hello-world/.git/</span><br><span class="line">[root@dev1 hello-world]<span class="comment"># git add .</span></span><br><span class="line">[root@dev1 hello-world]<span class="comment"># git commit -m &quot;Initial commit&quot;</span></span><br><span class="line">[root@dev1 hello-world]<span class="comment"># git remote add origin git@gitlab.lemon.com:java/hello-world.git</span></span><br><span class="line">[root@dev1 hello-world]<span class="comment"># git push origin master</span></span><br><span class="line">[root@dev1 hello-world]<span class="comment"># git tag -a &quot;v1.1&quot; -m &quot;v1.1&quot;</span></span><br><span class="line">[root@dev1 hello-world]<span class="comment"># git push origin v1.1</span></span><br></pre></td></tr></table></figure>
<p>![image-20200611163415669][image-200]</p>
<h3 id="2-4-在jenkins上拉取gitlab代码后手动编译成war包"><a href="#2-4-在jenkins上拉取gitlab代码后手动编译成war包" class="headerlink" title="2.4 在jenkins上拉取gitlab代码后手动编译成war包"></a>2.4 在jenkins上拉取gitlab代码后手动编译成war包</h3><ul>
<li>安装maven，由于我之前就安装过了 <code>JDK</code>  和  <code>maven</code>，所以这里就不用安装了，直接跳过</li>
<li>克隆刚才上传的 java 项目 并 手动编译成war包<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@jenkins ~]<span class="comment"># git clone git@gitlab.lemon.com:java/hello-world.git</span></span><br><span class="line">[root@jenkins ~]<span class="comment"># cd hello-world/</span></span><br><span class="line"></span><br><span class="line">[root@jenkins hello-world]<span class="comment"># mvn package -D maven.test.skip=true      #-D 跳过测试用例</span></span><br></pre></td></tr></table></figure>
![image-20200523103930568][image-201]</li>
<li>将其编译好的 <code>war包</code>  <code>scp</code> 到web节点的对应位置下<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#停止两台tomcat服务</span></span><br><span class="line">[root@web01 ~]<span class="comment"># /usr/local/tomcat/bin/shutdown.sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#删除tomcat默认页面</span></span><br><span class="line">[root@jenkins hello-world]<span class="comment"># for i in 192.168.2.&#123;4..5&#125;;do ssh root@$i &quot;rm -rf /usr/local/tomcat/webapps/ROOT&quot;; done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#将编译好的test1.war包scp至web节点上</span></span><br><span class="line">[root@jenkins hello-world]<span class="comment"># for i in 192.168.2.&#123;4..5&#125;;do scp target/test1.war root@$i:/usr/local/tomcat/webapps/ROOT.war; done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看war包是否拷贝过去</span></span><br><span class="line">[root@jenkins hello-world]<span class="comment"># for i in 192.168.2.&#123;4..5&#125;;do ssh root@$i &quot;ls -h /usr/local/tomcat/webapps/ROOT*&quot;; done</span></span><br><span class="line">/usr/<span class="built_in">local</span>/tomcat/webapps/ROOT.war</span><br><span class="line">/usr/<span class="built_in">local</span>/tomcat/webapps/ROOT.war</span><br><span class="line"></span><br><span class="line"><span class="comment">#启动两台tomcat服务；会自动生成一个ROOT网站目录</span></span><br><span class="line">[root@web01 ~]<span class="comment"># /usr/local/tomcat/bin/startup.sh</span></span><br><span class="line">[root@web01 ~]<span class="comment"># ll /usr/local/tomcat/webapps/</span></span><br><span class="line">总用量 32</span><br><span class="line">drwxr-x--- 14 root root  4096 6月  11 16:20 docs</span><br><span class="line">drwxr-x---  6 root root    83 6月  11 16:20 examples</span><br><span class="line">drwxr-x---  5 root root    87 6月  11 16:20 host-manager</span><br><span class="line">drwxr-x---  5 root root   103 6月  11 16:20 manager</span><br><span class="line">drwxr-x---  4 root root    54 6月  11 17:00 ROOT</span><br><span class="line">-rw-r--r--  1 root root 24711 6月  11 16:59 ROOT.war</span><br></pre></td></tr></table></figure></li>
<li>访问<br><a href="">![image-20200523105432256][image-202]</a></li>
</ul>
<p><strong>以上就是手动部署 java 代码的流程</strong></p>
<h2 id="3-jenkins-自动化部署-java-项目至web集群"><a href="#3-jenkins-自动化部署-java-项目至web集群" class="headerlink" title="3. jenkins 自动化部署 java 项目至web集群"></a>3. jenkins 自动化部署 java 项目至web集群</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/10/18/Jenkins/" data-id="ckpjvyk88000axwg068235rp6" data-title="Jenkins" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DevOps/" rel="tag">DevOps</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2020/10/25/Nginx/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Nginx
        
      </div>
    </a>
  
  
    <a href="/2020/10/18/MySQL/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">MySQL</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/DevOps/" rel="tag">DevOps</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/db/" rel="tag">db</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/k8s/" rel="tag">k8s</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web/" rel="tag">web</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/DevOps/" style="font-size: 10px;">DevOps</a> <a href="/tags/db/" style="font-size: 10px;">db</a> <a href="/tags/k8s/" style="font-size: 10px;">k8s</a> <a href="/tags/web/" style="font-size: 10px;">web</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">June 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/06/05/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2020/10/25/Nginx/">Nginx</a>
          </li>
        
          <li>
            <a href="/2020/10/18/Jenkins/">Jenkins</a>
          </li>
        
          <li>
            <a href="/2020/10/18/MySQL/">MySQL</a>
          </li>
        
          <li>
            <a href="/2020/10/07/Kubernetes/">kubernetes</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>