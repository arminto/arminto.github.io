<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="article">
<meta property="og:title" content="Redis">
<meta property="og:url" content="http://example.com/2021/06/15/Redis/index.html">
<meta property="og:site_name" content="LEMON">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNly1gric3k4xpzj311m0ekjtu.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNly1gric3mcir7j311m0ckq4v.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNly1gric3tdrazj311407y3zv.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNly1gric3qhy77j30vm06p751.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNly1gric3wn6oaj30rp0460sx.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNly1gric3zg91gj30w2048dg6.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNly1gric41snu0j30tp092q3b.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNly1gric47vvyvj30rm01sgli.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNly1gric4gnqoyj60t80in0ts02.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNly1gric4hq67hj30sb085acy.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNly1gric4lecrmj30v2043wep.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNly1gric4o7jj5j30uh01sjrd.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNly1gric4rzyyfj30xb0is775.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNly1gric55q4fdj30qq0bkgmu.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNly1gric5b7phvj60yv0trdhf02.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNly1gric5e05y5j30op07s74h.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNly1gric5g9h25j30qp03e0sn.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNly1gric5hq4kgj30th05v0su.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNly1gric5liurrj30xb0rbq5h.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNly1gric5p8qxyj30s306bmx7.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNly1gric5ufcs3j30p006lgly.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNly1gric5r2o4oj30rb02emx6.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNly1gric5vteb6j30qb0ea74l.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNly1gric60xe87j30ug0jxwfy.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNly1gric65n9lzj30yi0gc40s.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNly1gric69tttcj30al0a7wft.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNly1gric6ey651j308i0a10tq.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNly1gric6k6ey3j60xd0dyt9s02.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNly1gric6neu3xj30xj0jygs9.jpg">
<meta property="article:published_time" content="2021-06-14T18:05:35.000Z">
<meta property="article:modified_time" content="2021-06-14T18:16:33.419Z">
<meta property="article:author" content="Armin">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://tva1.sinaimg.cn/large/008i3skNly1gric3k4xpzj311m0ekjtu.jpg">

<link rel="canonical" href="http://example.com/2021/06/15/Redis/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Redis | LEMON</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">LEMON</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">死记性不如烂笔头</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/06/15/Redis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/armin.png">
      <meta itemprop="name" content="Armin">
      <meta itemprop="description" content="记录生活中的点点滴滴">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LEMON">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Redis
        </h1>

        <div class="post-meta">

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
      
        <!--toc-->
<span id="more"></span>

<h1 id="Redis入门"><a href="#Redis入门" class="headerlink" title="Redis入门"></a>Redis入门</h1><h2 id="Redis-概述"><a href="#Redis-概述" class="headerlink" title="Redis 概述"></a>Redis 概述</h2><blockquote>
<p><strong>Redis 是什么？</strong></p>
</blockquote>
<p>Redis（Remote Dictionary Server )，即远程字典服务 !</p>
<p>是一个开源的使用ANSI C语言编写、支持网络、可基于内存亦可持久化的日志型、Key-Value数据库，并提供多种语言的API。</p>
<p>redis会周期性的把更新的数据写入磁盘或者把修改操作写入追加的记录文件，并且在此基础上实现了master-slave(主从)同步。</p>
<p>免费和开源！是当下最热门的 NoSQL 技术之一！也被人们称之为结构化数据库！</p>
<blockquote>
<p><strong>Redis 能干嘛？</strong></p>
</blockquote>
<p>1、内存存储、持久化，内存中是断电即失、所以说持久化很重要（rdb、aof）<br>2、效率高，可以用于高速缓存<br>3、发布订阅系统<br>4、地图信息分析<br>5、计时器、计数器（浏览量！）<br>6、……..</p>
<blockquote>
<p><strong>Redis有什么特性？</strong></p>
</blockquote>
<p>1、多样的数据类型<br>2、持久化<br>3、集群<br>4、事务<br>5、……</p>
<blockquote>
<p><strong>Redis官方</strong></p>
</blockquote>
<p>1、官网：<a target="_blank" rel="noopener" href="https://redis.io/">https://redis.io/</a></p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gric3k4xpzj311m0ekjtu.jpg" alt="image-20200620112315949"></p>
<p>2、中文网：<a target="_blank" rel="noopener" href="http://www.redis.cn/">http://www.redis.cn/</a></p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gric3mcir7j311m0ckq4v.jpg" alt="image-20200620112250860"></p>
<h2 id="Redis的数据回收策略"><a href="#Redis的数据回收策略" class="headerlink" title="Redis的数据回收策略"></a>Redis的数据回收策略</h2><p><em><strong>volatile-lru：</strong></em>从已设置过期时间的数据集（server.db[i].expires）中挑选最近最少使用的数据淘汰；</p>
<p><em><strong>volatile-ttl：</strong></em>从已设置过期时间的数据集（server.db[i].expires）中挑选将要过期的数据淘汰；</p>
<p><em><strong>volatile-random：</strong></em>从已设置过期时间的数据集（server.db[i].expires）中任意选择数据淘汰；</p>
<p><em><strong>allkeys-lru：</strong></em>从数据集（server.db[i].dict）中挑选最近最少使用的数据淘汰；</p>
<p><em><strong>allkeys-random：</strong></em>从数据集（server.db[i].dict）中任意选择数据淘汰；</p>
<p><em><strong>no-enviction：</strong></em>（驱逐）禁止驱逐数据；</p>
<h2 id="Redis-应用部署"><a href="#Redis-应用部署" class="headerlink" title="Redis 应用部署"></a>Redis 应用部署</h2><blockquote>
<p><strong>1、下载安装包：<code>redis-5.0.8.tar.gz</code></strong></p>
</blockquote>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gric3tdrazj311407y3zv.jpg" alt="image-20200620112734219"></p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gric3qhy77j30vm06p751.jpg" alt="image-20200620112819418"></p>
<blockquote>
<p><strong>2、解压Redis的安装包 至 /usr/local/src目录下</strong></p>
</blockquote>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gric3wn6oaj30rp0460sx.jpg" alt="image-20200620114441168"></p>
<blockquote>
<p><strong>3、进入解压后的文件，可以看到我们redis的配置文件</strong></p>
</blockquote>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gric3zg91gj30w2048dg6.jpg" alt="image-20200620114524896"></p>
<blockquote>
<p><strong>4、编译 Redis 源码</strong></p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@redis01 redis-5.0.8]<span class="comment"># yum -y install gcc-c++</span></span><br><span class="line"></span><br><span class="line">[root@redis01 redis-5.0.8]<span class="comment"># make &amp;&amp; echo $?</span></span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gric41snu0j30tp092q3b.jpg" alt="image-20200620115402887"></p>
<blockquote>
<p><strong>5、创建redis安装目录</strong></p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@redis01 redis-5.0.8]<span class="comment"># mkdir -p /usr/local/redis         #Redis家目录</span></span><br><span class="line">[root@redis01 redis-5.0.8]<span class="comment"># mkdir -p /usr/local/redis/pid</span></span><br><span class="line">[root@redis01 redis-5.0.8]<span class="comment"># mkdir -p /usr/local/redis/log</span></span><br><span class="line">[root@redis01 redis-5.0.8]<span class="comment"># mkdir -p /usr/local/redis/bin</span></span><br><span class="line">[root@redis01 redis-5.0.8]<span class="comment"># mkdir -p /usr/local/redis/conf</span></span><br><span class="line">[root@redis01 redis-5.0.8]<span class="comment"># ll /usr/local/redis/</span></span><br><span class="line">总用量 0</span><br><span class="line">drwxr-xr-x 2 root root 6 6月  20 11:58 bin</span><br><span class="line">drwxr-xr-x 2 root root 6 6月  20 11:58 conf</span><br><span class="line">drwxr-xr-x 2 root root 6 6月  20 11:58 <span class="built_in">log</span></span><br><span class="line">drwxr-xr-x 2 root root 6 6月  20 11:57 pid</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>6、拷贝Redis相关文件至此目录中</strong></p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@redis01 redis-5.0.8]<span class="comment"># cp redis.conf /usr/local/redis/conf/</span></span><br><span class="line">[root@redis01 redis-5.0.8]<span class="comment"># cp src/redis-server /usr/local/redis/bin/</span></span><br><span class="line">[root@redis01 redis-5.0.8]<span class="comment"># cp src/redis-cli /usr/local/redis/bin/</span></span><br><span class="line">[root@redis01 redis-5.0.8]<span class="comment"># cp src/redis-benchmark /usr/local/redis/bin/</span></span><br><span class="line">[root@redis01 redis-5.0.8]<span class="comment"># cp src/redis-check-rdb /usr/local/redis/bin/</span></span><br><span class="line">[root@redis01 redis-5.0.8]<span class="comment"># cp src/redis-check-aof /usr/local/redis/bin/</span></span><br><span class="line">[root@redis01 redis-5.0.8]<span class="comment"># cp src/redis-sentinel /usr/local/redis/bin/</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>文件</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>redis.conf</td>
<td>redis配置文件</td>
</tr>
<tr>
<td>redis-server</td>
<td>redis服务端程序</td>
</tr>
<tr>
<td>redis-cli</td>
<td>redis客户端程序</td>
</tr>
<tr>
<td>redis-benchmark</td>
<td>用于进行测试redis性能测试的工具</td>
</tr>
<tr>
<td>redis-check-rdb</td>
<td>用于修复出现问题的dump.rdb文件</td>
</tr>
<tr>
<td>redis-check-aof</td>
<td>用于修复出现问题的aof文件</td>
</tr>
<tr>
<td>redis-sentinel</td>
<td>用于哨兵集群管理工具</td>
</tr>
</tbody></table>
<blockquote>
<p><strong>7、配置Redis命令的软连接</strong></p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@redis01 ~]<span class="comment"># ln -s /usr/local/redis/bin/* /usr/local/bin/</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>8、修改Redis配置文件</strong></p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@redis01 ~]<span class="comment"># vim /usr/local/redis/conf/redis.conf</span></span><br><span class="line">69 <span class="built_in">bind</span> 192.168.2.1                                  <span class="comment">#修改监听的IP地址</span></span><br><span class="line">88 protected-mode no                                 <span class="comment">#关闭redis的保护模式</span></span><br><span class="line">136 daemonize yes                                    <span class="comment">#开启redis的后台守护进程模式</span></span><br><span class="line">158 pidfile <span class="string">&quot;/usr/local/redis/pid/redis_6379.pid&quot;</span>    <span class="comment">#指定pid文件位置</span></span><br><span class="line">171 logfile <span class="string">&quot;/usr/local/redis/log/redis_6379.log&quot;</span>    <span class="comment">#指定log文件位置</span></span><br><span class="line">263 dir <span class="string">&quot;/usr/local/redis/&quot;</span>                          <span class="comment">#指定本地快照数据库存放目录（dump.rdb）</span></span><br><span class="line">507 requirepass 123456                               <span class="comment">#开启redis密码 并 设置redis的密码为123456</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>9、Redis配置文件详解</strong></p>
</blockquote>
<table>
<thead>
<tr>
<th>配置</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>daemonize yes</td>
<td>以后台daemon方式运行redis</td>
</tr>
<tr>
<td>pidfile “redis.pid”</td>
<td>默认pid文件路径</td>
</tr>
<tr>
<td>port 6379</td>
<td>默认端口</td>
</tr>
<tr>
<td>bind 127.0.0.1</td>
<td>默认绑定本机所有ip地址，为了安全，可以只监听内网ip</td>
</tr>
<tr>
<td>timeout 300</td>
<td>客户端超时设置，单位为秒</td>
</tr>
<tr>
<td>loglevel verbose</td>
<td>设置日志级别，支持四个级别：debug、notice、verbose、warning</td>
</tr>
<tr>
<td>logfile stdout</td>
<td>日志记录方式，默认为标准输出，logs不写文件，输出到空设备/deb/null</td>
</tr>
<tr>
<td>logfile “redis.log”</td>
<td>可以指定日志文件路径</td>
</tr>
<tr>
<td>databases 16</td>
<td>开启数据库的数量</td>
</tr>
<tr>
<td>save 900 1</td>
<td>创建本地数据库快照；900秒内，执行1次写操作后触发快照</td>
</tr>
<tr>
<td>save 300 10</td>
<td>创建本地数据库快照；300秒内，执行10次写操作</td>
</tr>
<tr>
<td>save 60 10000</td>
<td>创建本地数据库快照；60秒内，执行10000次写操作</td>
</tr>
<tr>
<td>rdbcompression yes</td>
<td>启用数据库lzf压缩，也可以设置为no</td>
</tr>
<tr>
<td>dbfilename dump.rdb</td>
<td>本地快照数据库名称</td>
</tr>
<tr>
<td>dir “/usr/local/redis”</td>
<td>本地快照数据库存放目录（默认在启动redis的路径）</td>
</tr>
<tr>
<td>requirepass 123456</td>
<td>设置redis数据库连接密码</td>
</tr>
<tr>
<td>appendfsync everysec</td>
<td>设置日志同步的频率, 每秒执行同步, 还有两个参数always、no一般设置为everysec, 相当于MySQL事物日志的写方式</td>
</tr>
<tr>
<td>Slaveof</td>
<td>设置数据库为其他数据库的从数据库</td>
</tr>
<tr>
<td>Masterauth</td>
<td>主数据库连接需要的密码验证</td>
</tr>
<tr>
<td>vm-enabled</td>
<td>是否开启虚拟内存支持 (vm开头的参数都是配置虚拟内存的)</td>
</tr>
<tr>
<td>vm-swap-file</td>
<td>设置虚拟内存的交换文件路径</td>
</tr>
<tr>
<td>vm-max-memory</td>
<td>设置redis使用的最大物理内存大小</td>
</tr>
<tr>
<td>vm-page-size</td>
<td>设置虚拟内存的页大小</td>
</tr>
<tr>
<td>vm-pages</td>
<td>设置交换文件的总的page数量</td>
</tr>
<tr>
<td>vm-max-threads</td>
<td>设置使用swap存储同时使用的线程数量，通常设置值为核心数相同，如果设置为0，则会以串行方式，对数据的完整性有着极大的保证</td>
</tr>
<tr>
<td>Glueoutputbuf</td>
<td>把小的输出缓存存放在一起</td>
</tr>
<tr>
<td>hash-max-zipmap-entries</td>
<td>设置hash的临界值</td>
</tr>
<tr>
<td>Activerehashing</td>
<td>重新hash</td>
</tr>
</tbody></table>
<blockquote>
<p><strong>10、编写启动脚本并启动Redis</strong></p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">[root@redis01 ~]<span class="comment"># vim /etc/init.d/redis</span></span><br><span class="line"><span class="comment">#!/bin/sh</span></span><br><span class="line"><span class="comment"># chkconfig: 2345 80 90</span></span><br><span class="line"><span class="comment"># description: Start and Stop redis</span></span><br><span class="line"><span class="comment">#PATH=/usr/local/bin:/sbin:/usr/bin:/bin</span></span><br><span class="line">REDISPORT=6379</span><br><span class="line">EXEC=/usr/<span class="built_in">local</span>/redis/bin/redis-server</span><br><span class="line">REDIS_CLI=/usr/<span class="built_in">local</span>/redis/bin/redis-cli</span><br><span class="line">PIDFILE=/usr/<span class="built_in">local</span>/redis/pid/redis_6379.pid</span><br><span class="line">CONF=<span class="string">&quot;/usr/local/redis/conf/redis.conf&quot;</span></span><br><span class="line">AUTH=<span class="string">&quot;123456&quot;</span></span><br><span class="line">LISTEN_IP=$(netstat -utpln |grep redis-server |awk <span class="string">&#x27;&#123;print $4&#125;&#x27;</span>|awk -F<span class="string">&#x27;:&#x27;</span> <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;<span class="variable">$1</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">    start)</span><br><span class="line">        <span class="keyword">if</span> [ -f <span class="variable">$PIDFILE</span> ]</span><br><span class="line">        <span class="keyword">then</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$PIDFILE</span> exists, process is already running or crashed&quot;</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&quot;Starting Redis server...&quot;</span></span><br><span class="line">                <span class="variable">$EXEC</span> <span class="variable">$CONF</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">if</span> [ <span class="string">&quot;$?&quot;</span>=<span class="string">&quot;0&quot;</span> ]</span><br><span class="line">        <span class="keyword">then</span></span><br><span class="line">              <span class="built_in">echo</span> <span class="string">&quot;Redis is running...&quot;</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">        ;;</span><br><span class="line">    stop)</span><br><span class="line">        <span class="keyword">if</span> [ ! -f <span class="variable">$PIDFILE</span> ]</span><br><span class="line">        <span class="keyword">then</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$PIDFILE</span> does not exist, process is not running&quot;</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">                PID=$(cat <span class="variable">$PIDFILE</span>)</span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&quot;Stopping ...&quot;</span></span><br><span class="line">                <span class="variable">$REDIS_CLI</span> -h <span class="variable">$LISTEN_IP</span> -p <span class="variable">$REDISPORT</span> -a <span class="variable">$AUTH</span> SHUTDOWN</span><br><span class="line">                <span class="keyword">while</span> [ -x <span class="variable">$&#123;PIDFILE&#125;</span> ]</span><br><span class="line">               <span class="keyword">do</span></span><br><span class="line">                    <span class="built_in">echo</span> <span class="string">&quot;Waiting for Redis to shutdown ...&quot;</span></span><br><span class="line">                    sleep 1</span><br><span class="line">                <span class="keyword">done</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&quot;Redis stopped&quot;</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">        ;;</span><br><span class="line">   restart|force-reload)</span><br><span class="line">        <span class="variable">$&#123;0&#125;</span> stop</span><br><span class="line">        <span class="variable">$&#123;0&#125;</span> start</span><br><span class="line">        ;;</span><br><span class="line">  *)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Usage: /etc/init.d/redis &#123;start|stop|restart|force-reload&#125;&quot;</span> &gt;&amp;2</span><br><span class="line">        <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"></span><br><span class="line">[root@redis01 ~]<span class="comment"># chmod 755 /etc/init.d/redis  #给予脚本执行权限</span></span><br><span class="line">[root@redis01 ~]<span class="comment"># /etc/init.d/redis start      #启动Redis</span></span><br><span class="line">Starting Redis server...</span><br><span class="line">Redis is running...</span><br><span class="line">[root@redis01 ~]<span class="comment"># netstat -anptu|grep &quot;6379&quot;</span></span><br><span class="line">tcp        0      0 192.168.2.1:6379        0.0.0.0:*            LISTEN      22704/redis-server</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>11、查看redis家目录生成的文件</strong></p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@redis01 ~]<span class="comment"># tree /usr/local/redis/</span></span><br><span class="line">/usr/<span class="built_in">local</span>/redis/</span><br><span class="line">├── bin</span><br><span class="line">│   ├── redis-benchmark</span><br><span class="line">│   ├── redis-check-aof</span><br><span class="line">│   ├── redis-check-rdb</span><br><span class="line">│   ├── redis-cli</span><br><span class="line">│   ├── redis-sentinel</span><br><span class="line">│   └── redis-server</span><br><span class="line">├── conf</span><br><span class="line">│   └── redis.conf</span><br><span class="line">├── dump.rdb</span><br><span class="line">├── <span class="built_in">log</span></span><br><span class="line">│   └── redis_6379.log</span><br><span class="line">└── pid</span><br><span class="line">    └── redis_6379.pid</span><br><span class="line"></span><br><span class="line">4 directories, 10 files</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>12、使用redis-cli 连接Redis服务方式</strong></p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 方式一：redis-cli -h IP -p port -a password       #不推荐在公司这么用，适合学习的时候用</span></span><br><span class="line">[root@redis01 ~]<span class="comment"># redis-cli -h 192.168.2.1 -p 6379 -a 123456</span></span><br><span class="line">Warning: Using a password with <span class="string">&#x27;-a&#x27;</span> or <span class="string">&#x27;-u&#x27;</span> option on the <span class="built_in">command</span> line interface may not be safe.</span><br><span class="line">192.168.2.1:6379&gt; keys *</span><br><span class="line">(empty list or <span class="built_in">set</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 方式二：redis-cli -h IP -p port                   #这种的方式，再进去之后需要用AUTH认证密码</span></span><br><span class="line">[root@redis01 ~]<span class="comment"># redis-cli -h 192.168.2.1 -p 6379</span></span><br><span class="line">192.168.2.1:6379&gt; keys *</span><br><span class="line">(error) NOAUTH Authentication required.</span><br><span class="line">192.168.2.1:6379&gt; AUTH 123456</span><br><span class="line">OK</span><br><span class="line">192.168.2.1:6379&gt; keys *</span><br><span class="line">(empty list or <span class="built_in">set</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 可能会出现错误信息：(error) ERR Client sent AUTH, but no password is set</span></span><br><span class="line">解决方法如下：</span><br><span class="line">192.168.1.1:6379&gt; CONFIG SET requirepass <span class="string">&quot;123456&quot;</span>   <span class="comment">#设置密码</span></span><br><span class="line">OK</span><br><span class="line">192.168.1.1:6379&gt; AUTH 123456</span><br><span class="line">OK</span><br></pre></td></tr></table></figure>



<h2 id="配置文件详解"><a href="#配置文件详解" class="headerlink" title="配置文件详解"></a>配置文件详解</h2><blockquote>
<p><strong>模块化，包含，类似于Nginx中的include</strong></p>
</blockquote>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gric47vvyvj30rm01sgli.jpg" alt="image-20200620170715446"></p>
<blockquote>
<p><strong>网络配置</strong></p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">port 6379                          <span class="comment"># 端口设置</span></span><br><span class="line"><span class="built_in">bind</span> 127.0.0.1                     <span class="comment"># 默认绑定本机所有ip地址，为了安全，可以只监听内网ip</span></span><br><span class="line">protected-mode yes                 <span class="comment"># 保护模式</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>SECURITY 安全配置</strong></p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">requirepass 123456                 <span class="comment"># 设置redis数据库连接密码，默认是没有密码！</span></span><br><span class="line">masterauth &lt;master-password&gt;       <span class="comment"># 主数据库连接需要的密码验证</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>通用配置 GENERAL</strong></p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">daemonize yes                      <span class="comment"># 以守护进程的方式运行，默认是 no，我们需要自己开启为yes！</span></span><br><span class="line">pidfile <span class="string">&quot;redis.pid&quot;</span>                <span class="comment"># 默认pid文件路径</span></span><br><span class="line">logfile <span class="string">&quot;redis.log&quot;</span>                <span class="comment"># 指定日志文件路径</span></span><br><span class="line">loglevel notice                    <span class="comment"># 设置日志级别，支持四个级别：debug、notice、verbose、warning</span></span><br><span class="line">databases 16                       <span class="comment"># 开启数据库的数量，默认是 16 个数据库</span></span><br><span class="line">always-show-logo yes               <span class="comment"># 是否总是显示LOGO</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>rdb快照配置</strong></p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">save 900 1                         <span class="comment"># 如果900s内，如果至少有一个1 key进行了修改，我们及进行持久化操作</span></span><br><span class="line">save 300 10                        <span class="comment"># 如果300s内，如果至少10 key进行了修改，我们及进行持久化操作</span></span><br><span class="line">save 60 10000                      <span class="comment"># 如果60s内，如果至少10000 key进行了修改，我们及进行持久化操作</span></span><br><span class="line">rdbcompression yes                 <span class="comment"># 是否压缩 rdb 文件，需要消耗一些cpu资源！</span></span><br><span class="line">dbfilename dump.rdb                <span class="comment"># 本地快照数据库名称</span></span><br><span class="line">dir ./                             <span class="comment"># 本地快照数据库存放目录（默认在启动redis的路径）</span></span><br><span class="line">stop-writes-on-bgsave-error yes    <span class="comment"># 持久化如果出错，是否还需要继续工作！</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>AOF配置</strong></p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">appendonly no                      <span class="comment"># 默认关闭的，默认是使用rdb方式持久化的，在大部分所有的情况下，rdb完全够用！</span></span><br><span class="line">appendfilename <span class="string">&quot;appendonly.aof&quot;</span>    <span class="comment"># aof持久化的文件的名字</span></span><br><span class="line">appendfsync always                 <span class="comment"># 每次修改都会 sync。消耗性能</span></span><br><span class="line">appendfsync everysec               <span class="comment"># 每秒执行一次 sync，可能会丢失这1s的数据！</span></span><br><span class="line">appendfsync no                     <span class="comment"># 不执行 sync，这个时候操作系统自己同步数据，速度最快！</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>限制 CLIENTS</strong></p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">maxclients 10000                   <span class="comment"># 设置能连接上redis的最大客户端的数量</span></span><br><span class="line">timeout 300                        <span class="comment"># 客户端超时设置，单位为秒</span></span><br><span class="line">maxmemory &lt;bytes&gt;                  <span class="comment"># redis 配置最大的内存容量</span></span><br><span class="line">maxmemory-policy noeviction        <span class="comment"># 内存到达上限之后的处理策略, 如下:</span></span><br><span class="line">  1、allkeys-random    随机删除</span><br><span class="line">  2、volatile-random   随机删除即将过期key </span><br><span class="line">  3、allkeys-lru       删除lru算法的key </span><br><span class="line">  4、volatile-ttl      删除即将过期的 </span><br><span class="line">  5、noeviction        永不过期，返回错误</span><br><span class="line">  6、volatile-lru      只对设置了过期时间的key进行LRU（默认值）</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>REPLICATION 复制，集群配置</strong></p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">min-slaves-to-write 3       <span class="comment"># 设置slave节点数量，如果slave节点数量少于此值，那么master节点将停止客户端一切写请求</span></span><br><span class="line">min-slaves-max-lag 10       <span class="comment"># master与slave之间同步数据的超时时间，超过此时间，master节点将停止客户端一切写操作</span></span><br><span class="line">slaveof IP PORT             <span class="comment"># slave节点指定主master的ip地址以及端口</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>虚拟内存配置</strong></p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vm-enabled                         <span class="comment"># 是否开启虚拟内存支持</span></span><br><span class="line">vm-swap-file                       <span class="comment"># 设置虚拟内存的交换文件路径</span></span><br><span class="line">vm-max-memory                      <span class="comment"># 设置redis使用的最大物理内存大小</span></span><br><span class="line">vm-page-size                       <span class="comment"># 设置虚拟内存的页大小</span></span><br><span class="line">vm-pages                           <span class="comment"># 设置交换文件的总的page数量</span></span><br></pre></td></tr></table></figure>



<h2 id="Redis-测试性能"><a href="#Redis-测试性能" class="headerlink" title="Redis 测试性能"></a>Redis 测试性能</h2><p><strong>redis-benchmark</strong> 是一个压力测试工具，官方自带的性能测试工具。</p>
<blockquote>
<p><strong>常用选项：</strong></p>
</blockquote>
<table>
<thead>
<tr>
<th>选项</th>
<th>描述</th>
<th>默认值</th>
</tr>
</thead>
<tbody><tr>
<td><strong>-h</strong></td>
<td>指定服务器主机名</td>
<td>127.0.0.1</td>
</tr>
<tr>
<td><strong>-p</strong></td>
<td>指定服务器端口</td>
<td>6379</td>
</tr>
<tr>
<td><strong>-s</strong></td>
<td>指定服务器 socket</td>
<td></td>
</tr>
<tr>
<td><strong>-c</strong></td>
<td>指定并发连接数</td>
<td>50</td>
</tr>
<tr>
<td><strong>-n</strong></td>
<td>指定请求数</td>
<td>10000</td>
</tr>
<tr>
<td><strong>-d</strong></td>
<td>以字节的形式指定 SET/GET 值的数据大小</td>
<td>2</td>
</tr>
<tr>
<td><strong>-k</strong></td>
<td>1=keep alive 0=reconnect</td>
<td>1</td>
</tr>
<tr>
<td><strong>-r</strong></td>
<td>SET/GET/INCR 使用随机 key, SADD 使用随机值</td>
<td></td>
</tr>
<tr>
<td><strong>-P</strong></td>
<td>通过管道传输 <numreq> 请求</td>
<td>1</td>
</tr>
<tr>
<td><strong>-q</strong></td>
<td>强制退出 redis。仅显示 query/sec 值</td>
<td></td>
</tr>
<tr>
<td><strong>–csv</strong></td>
<td>以 CSV 格式输出</td>
<td></td>
</tr>
<tr>
<td><strong>-l</strong></td>
<td>生成循环，永久执行测试</td>
<td></td>
</tr>
<tr>
<td><strong>-t</strong></td>
<td>仅运行以逗号分隔的测试命令列表。</td>
<td></td>
</tr>
<tr>
<td><strong>-I</strong></td>
<td>Idle 模式。仅打开 N 个 idle 连接并等待。</td>
<td></td>
</tr>
</tbody></table>
<blockquote>
<p><strong>简单测试下</strong></p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 测试：100个并发连接 100000请求</span></span><br><span class="line">redis-benchmark -h 192.168.2.1 -p 6379 -c 100 -n 100000</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gric4gnqoyj60t80in0ts02.jpg" alt="image-20200620130500634"></p>
<blockquote>
<p><strong>如何查看这些分析呢？</strong></p>
</blockquote>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gric4hq67hj30sb085acy.jpg" alt="image-20200620130539716"></p>
<h2 id="Redis-基础Key-Value"><a href="#Redis-基础Key-Value" class="headerlink" title="Redis 基础Key-Value"></a>Redis 基础Key-Value</h2><blockquote>
<p><strong>Redis 是单线程的！</strong></p>
</blockquote>
<p>明白Redis是很快的，官方表示，Redis是基于内存操作，CPU不是Redis性能瓶颈，Redis的瓶颈是根据机器的内存和网络带宽，既然可以使用单线程来实现，就使用单线程了！所有就使用了单线程了！</p>
<p>Redis 是C 语言写的，官方提供的数据为 100000+ 的QPS，完全不比同样是使用 key-vale的Memecache差！</p>
<blockquote>
<p><strong>Redis 为什么单线程还这么快？</strong></p>
</blockquote>
<p>1、误区1：高性能的服务器一定是多线程的？</p>
<p>2、误区2：多线程（CPU上下文会切换！）一定比单线程效率高！</p>
<p>3、对CPU&gt;内存&gt;硬盘的速度要有所了解！</p>
<p>4、核心：redis 是将所有的数据全部放在内存中的，所以说使用单线程去操作效率就是最高的，多线程（CPU上下文会切换：耗时的操作！！！），对于内存系统来说，如果没有上下文切换效率就是最高的！多次读写都是在一个CPU上的，在内存情况下，这个就是最佳的方案！</p>
<blockquote>
<p><strong>redis默认有16个数据库，默认使用的是第0个，可以使用 select 进行切换数据库！</strong></p>
</blockquote>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gric4lecrmj30v2043wep.jpg" alt="image-20200620131047944"></p>
<blockquote>
<p><strong>后面如果遇到不会的命令，可以在官网查看帮助文档！</strong></p>
</blockquote>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gric4o7jj5j30uh01sjrd.jpg" alt="image-20200620143436298"></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">192.168.2.1:6379&gt; select 3               <span class="comment"># 切换数据库</span></span><br><span class="line">OK</span><br><span class="line">192.168.2.1:6379[3]&gt; dbsize              <span class="comment"># 查看DB的key个数！</span></span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">192.168.2.1:6379[3]&gt; <span class="built_in">set</span> name lemon      <span class="comment"># 创建一对key value</span></span><br><span class="line">OK</span><br><span class="line">192.168.2.1:6379[3]&gt; dbsize</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">192.168.2.1:6379[3]&gt; <span class="built_in">type</span> name           <span class="comment"># 查看key的value数据类型</span></span><br><span class="line">string</span><br><span class="line">192.168.2.1:6379[3]&gt; get name            <span class="comment"># 查看key的value值</span></span><br><span class="line"><span class="string">&quot;lemon&quot;</span></span><br><span class="line">192.168.2.1:6379[3]&gt; exists name         <span class="comment"># 判断当前的key是否存在; 1代表存在, 0代表不存在</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">192.168.2.1:6379[3]&gt; exists name1</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">192.168.2.1:6379[3]&gt; <span class="built_in">set</span> AA aa</span><br><span class="line">OK</span><br><span class="line">192.168.2.1:6379[3]&gt; dbsize</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">192.168.2.1:6379[3]&gt; del AA              <span class="comment"># 删除key</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">192.168.2.1:6379[3]&gt; dbsize</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">192.168.2.1:6379[3]&gt; select 1</span><br><span class="line">OK</span><br><span class="line">192.168.2.1:6379[1]&gt; <span class="built_in">set</span> age 20</span><br><span class="line">OK</span><br><span class="line">192.168.2.1:6379[1]&gt; <span class="built_in">set</span> height 1.8</span><br><span class="line">OK</span><br><span class="line">192.168.2.1:6379[1]&gt; randomkey           <span class="comment">#随机返回一个Key</span></span><br><span class="line"><span class="string">&quot;height&quot;</span></span><br><span class="line">192.168.2.1:6379[1]&gt; randomkey</span><br><span class="line"><span class="string">&quot;age&quot;</span></span><br><span class="line">192.168.2.1:6379[1]&gt; keys *              <span class="comment"># 查看当前数据库所有的key</span></span><br><span class="line">1) <span class="string">&quot;height&quot;</span></span><br><span class="line">2) <span class="string">&quot;age&quot;</span></span><br><span class="line">192.168.2.1:6379[1]&gt; keys h*             <span class="comment"># 查看当前数据库所有以h开头的key</span></span><br><span class="line">1) <span class="string">&quot;height&quot;</span></span><br><span class="line">192.168.2.1:6379[1]&gt; expire age 10       <span class="comment"># 设置key的过期时间，单位是秒</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">192.168.2.1:6379[1]&gt; ttl age             <span class="comment"># 查看当前key的剩余时间</span></span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">192.168.2.1:6379[1]&gt; ttl age</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">192.168.2.1:6379[1]&gt; ttl age</span><br><span class="line">(<span class="built_in">integer</span>) -2</span><br><span class="line">192.168.2.1:6379[1]&gt; keys *</span><br><span class="line">1) <span class="string">&quot;height&quot;</span></span><br><span class="line">192.168.2.1:6379[1]&gt; rename height AA    <span class="comment"># 修改key名</span></span><br><span class="line">OK</span><br><span class="line">192.168.2.1:6379[1]&gt; keys *</span><br><span class="line">1) <span class="string">&quot;AA&quot;</span></span><br><span class="line">192.168.2.1:6379[1]&gt; flushdb             <span class="comment"># 清空当前数据库的内容</span></span><br><span class="line">OK</span><br><span class="line">192.168.2.1:6379[1]&gt; keys *</span><br><span class="line">(empty list or <span class="built_in">set</span>)</span><br><span class="line">192.168.2.1:6379[1]&gt; flushall            <span class="comment"># 清空全部数据库的内容</span></span><br><span class="line">OK</span><br><span class="line">192.168.2.1:6379[1]&gt; select 3</span><br><span class="line">OK</span><br><span class="line">192.168.2.1:6379[3]&gt; keys *</span><br><span class="line">(empty list or <span class="built_in">set</span>)</span><br></pre></td></tr></table></figure>



<h2 id="Redis中操作之其他操作"><a href="#Redis中操作之其他操作" class="headerlink" title="Redis中操作之其他操作"></a>Redis中操作之其他操作</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">192.168.2.1:6379&gt; dbsize 				<span class="comment">#查看所有key的数目 </span></span><br><span class="line">192.168.2.1:6379&gt; flushdb  				<span class="comment">#删除当前选择数据库中的所有key </span></span><br><span class="line">192.168.2.1:6379&gt; flushall  			<span class="comment">#删除所有数据库中的所有key </span></span><br><span class="line">192.168.2.1:6379&gt; save					<span class="comment">#将数据同步保存到磁盘 </span></span><br><span class="line">192.168.2.1:6379&gt; bgsave 				<span class="comment">#异步保存 </span></span><br><span class="line">192.168.2.1:6379&gt; lastsave 				<span class="comment">#上次成功保存到磁盘的Unix时间戳 </span></span><br><span class="line">192.168.2.1:6379&gt; info					<span class="comment">#查询server信息 </span></span><br><span class="line">192.168.2.1:6379&gt; slaveof				<span class="comment">#改变复制策略设置</span></span><br></pre></td></tr></table></figure>





<h1 id="Redis五大数据类型"><a href="#Redis五大数据类型" class="headerlink" title="Redis五大数据类型"></a>Redis五大数据类型</h1><blockquote>
<p><strong>官网文档</strong></p>
</blockquote>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gric4rzyyfj30xb0is775.jpg" alt="image-20200620141701476"></p>
<h2 id="String（字符串）"><a href="#String（字符串）" class="headerlink" title="String（字符串）"></a>String（字符串）</h2><blockquote>
<p>String是简单的 key-value 键值对，value 不仅可以是 String，也可以是数字；String在redis内部存储默认就是一个字符串，被redisObject所引用，当遇到incr,decr等操作时会转成数值型进行计算，此时redisObject的encoding字段为int。</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line">--------------------------------------------------------------------------------------------------</span><br><span class="line">192.168.2.1:6379&gt; <span class="built_in">set</span> key1 v1</span><br><span class="line">OK</span><br><span class="line">192.168.2.1:6379&gt; get key1</span><br><span class="line"><span class="string">&quot;v1&quot;</span></span><br><span class="line">192.168.2.1:6379&gt; append key1 <span class="string">&quot;hello&quot;</span>         <span class="comment"># 追加字符串，如果当前key不存在，就相当于set key</span></span><br><span class="line">(<span class="built_in">integer</span>) 7</span><br><span class="line">192.168.2.1:6379&gt; get key1</span><br><span class="line"><span class="string">&quot;v1hello&quot;</span></span><br><span class="line">192.168.2.1:6379&gt; strlen key1                 <span class="comment"># 获取字符串的长度</span></span><br><span class="line">(<span class="built_in">integer</span>) 7</span><br><span class="line">--------------------------------------------------------------------------------------------------</span><br><span class="line"><span class="comment"># i++</span></span><br><span class="line"><span class="comment"># 步长 i+=</span></span><br><span class="line">192.168.2.1:6379&gt; <span class="built_in">set</span> key2 0                  <span class="comment"># 初始浏览量为0</span></span><br><span class="line">OK</span><br><span class="line">192.168.2.1:6379&gt; get key2</span><br><span class="line"><span class="string">&quot;0&quot;</span></span><br><span class="line">192.168.2.1:6379&gt; incr key2                   <span class="comment"># 自增1 浏览量变为1</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">192.168.2.1:6379&gt; incr key2</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">192.168.2.1:6379&gt; get key2</span><br><span class="line"><span class="string">&quot;2&quot;</span></span><br><span class="line">192.168.2.1:6379&gt; decr key2                   <span class="comment"># 自减1  浏览量-1</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">192.168.2.1:6379&gt; decr key2</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">192.168.2.1:6379&gt; get key2</span><br><span class="line"><span class="string">&quot;0&quot;</span></span><br><span class="line">192.168.2.1:6379&gt; incrby key2 10              <span class="comment"># 可以设置步长，指定增量！</span></span><br><span class="line">(<span class="built_in">integer</span>) 10</span><br><span class="line">192.168.2.1:6379&gt; incrby key2 10</span><br><span class="line">(<span class="built_in">integer</span>) 20</span><br><span class="line">192.168.2.1:6379&gt; get key2</span><br><span class="line"><span class="string">&quot;20&quot;</span></span><br><span class="line">192.168.2.1:6379&gt; decrby key2 10              <span class="comment"># 可以设置步长，指定减量！</span></span><br><span class="line">(<span class="built_in">integer</span>) 10</span><br><span class="line">192.168.2.1:6379&gt; decrby key2 10</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">192.168.2.1:6379&gt; get key2</span><br><span class="line"><span class="string">&quot;0&quot;</span></span><br><span class="line">--------------------------------------------------------------------------------------------------</span><br><span class="line"><span class="comment"># 字符串范围 range</span></span><br><span class="line">192.168.2.1:6379&gt; <span class="built_in">set</span> key3 <span class="string">&quot;hello,world&quot;</span></span><br><span class="line">OK</span><br><span class="line">192.168.2.1:6379&gt; get key3</span><br><span class="line"><span class="string">&quot;hello,world&quot;</span></span><br><span class="line">192.168.2.1:6379&gt; getrange key3 0 4           <span class="comment"># 截取字符串 [0,4]</span></span><br><span class="line"><span class="string">&quot;hello&quot;</span></span><br><span class="line">192.168.2.1:6379&gt; getrange key3 0 -1          <span class="comment"># 获取全部的字符串 和 get key是一样的</span></span><br><span class="line"><span class="string">&quot;hello,world&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 替换</span></span><br><span class="line">192.168.2.1:6379&gt; <span class="built_in">set</span> key4 abcdefg</span><br><span class="line">OK</span><br><span class="line">192.168.2.1:6379&gt; get key4</span><br><span class="line"><span class="string">&quot;abcdefg&quot;</span></span><br><span class="line">192.168.2.1:6379&gt; setrange key4 1 xx</span><br><span class="line">(<span class="built_in">integer</span>) 7</span><br><span class="line">192.168.2.1:6379&gt; get key4</span><br><span class="line"><span class="string">&quot;axxdefg&quot;</span></span><br><span class="line">--------------------------------------------------------------------------------------------------</span><br><span class="line"><span class="comment"># setex (set with expire)   # 设置过期时间</span></span><br><span class="line"><span class="comment"># setnx (set if not exist)  # 不存在在设置 （在分布式锁中会常常使用！）</span></span><br><span class="line">192.168.2.1:6379&gt; setex key5 30 <span class="string">&quot;hello&quot;</span>       <span class="comment"># 设置key5 的值为 hello, 30秒后过期</span></span><br><span class="line">OK</span><br><span class="line">192.168.2.1:6379&gt; ttl key5</span><br><span class="line">(<span class="built_in">integer</span>) 26</span><br><span class="line">192.168.2.1:6379&gt; get key5</span><br><span class="line"><span class="string">&quot;hello&quot;</span></span><br><span class="line">192.168.2.1:6379&gt; setnx mykey <span class="string">&quot;redis&quot;</span>        <span class="comment"># 如果mykey 不存在，创建mykey</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">192.168.2.1:6379&gt; keys *</span><br><span class="line">1) <span class="string">&quot;mykey&quot;</span></span><br><span class="line">2) <span class="string">&quot;key1&quot;</span></span><br><span class="line">3) <span class="string">&quot;key5&quot;</span></span><br><span class="line">4) <span class="string">&quot;key4&quot;</span></span><br><span class="line">5) <span class="string">&quot;key3&quot;</span></span><br><span class="line">6) <span class="string">&quot;key2&quot;</span></span><br><span class="line">192.168.2.1:6379&gt; ttl key5</span><br><span class="line">(<span class="built_in">integer</span>) -2</span><br><span class="line">192.168.2.1:6379&gt; keys *</span><br><span class="line">1) <span class="string">&quot;mykey&quot;</span></span><br><span class="line">2) <span class="string">&quot;key1&quot;</span></span><br><span class="line">3) <span class="string">&quot;key4&quot;</span></span><br><span class="line">4) <span class="string">&quot;key3&quot;</span></span><br><span class="line">5) <span class="string">&quot;key2&quot;</span></span><br><span class="line">192.168.2.1:6379&gt; setnx mykey <span class="string">&quot;MongoDB&quot;</span>      <span class="comment"># 如果mykey存在，创建失败！</span></span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">--------------------------------------------------------------------------------------------------</span><br><span class="line"><span class="comment"># mset  同时创建多个键值</span></span><br><span class="line"><span class="comment"># mget  同时获取多个键的值</span></span><br><span class="line">192.168.2.1:6379&gt; mset k1 <span class="string">&#x27;v1&#x27;</span> k2 <span class="string">&#x27;v2&#x27;</span> k3 <span class="string">&#x27;v3&#x27;</span></span><br><span class="line">OK</span><br><span class="line">192.168.2.1:6379&gt; keys *</span><br><span class="line">1) <span class="string">&quot;k2&quot;</span></span><br><span class="line">2) <span class="string">&quot;mykey&quot;</span></span><br><span class="line">3) <span class="string">&quot;k1&quot;</span></span><br><span class="line">4) <span class="string">&quot;key3&quot;</span></span><br><span class="line">5) <span class="string">&quot;key1&quot;</span></span><br><span class="line">6) <span class="string">&quot;key2&quot;</span></span><br><span class="line">7) <span class="string">&quot;key4&quot;</span></span><br><span class="line">8) <span class="string">&quot;k3&quot;</span></span><br><span class="line">192.168.2.1:6379&gt; mget k1 k2 k3</span><br><span class="line">1) <span class="string">&quot;v1&quot;</span></span><br><span class="line">2) <span class="string">&quot;v2&quot;</span></span><br><span class="line">3) <span class="string">&quot;v3&quot;</span></span><br><span class="line">--------------------------------------------------------------------------------------------------</span><br><span class="line">getset <span class="comment"># 先get然后在set</span></span><br><span class="line">192.168.2.1:6379&gt; getset db <span class="string">&#x27;redis&#x27;</span>          <span class="comment"># 如果不存在值，则返回 nil, 在设置k-v</span></span><br><span class="line">(nil)</span><br><span class="line">192.168.2.1:6379&gt; get db</span><br><span class="line"><span class="string">&quot;redis&quot;</span></span><br><span class="line">192.168.2.1:6379&gt; getset db <span class="string">&#x27;mongodb&#x27;</span>        <span class="comment"># 如果存在值，获取原来的值，并设置新的值</span></span><br><span class="line"><span class="string">&quot;redis&quot;</span></span><br><span class="line">192.168.2.1:6379&gt; get db</span><br><span class="line"><span class="string">&quot;mongodb&quot;</span></span><br><span class="line">--------------------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>



<h2 id="List（列表）"><a href="#List（列表）" class="headerlink" title="List（列表）"></a>List（列表）</h2><blockquote>
<p><strong>概述：</strong>Redis列表是简单的字符串列表，可以类比到C++中的std::list，简单的说就是一个列表或者说是一个队列。可以从头部或尾部向Redis列表添加元素。列表的最大长度为2^32 - 1，也即每个列表支持超过40亿个元素。Redis list的实现为一个双向列表，即可以支持反向查找和遍历，更方便操作，不过带来了部分额外的内存开销，Redis内部的很多实现，包括发送缓冲队列等也都是用的这个数据结构。</p>
<p><strong>场景：</strong>Redis list的应用场景非常多，也是Redis最重要的数据结构之一，比如twitter的关注列表、粉丝列表等都可以用Redis的list结构来实现，再比如有的应用使用Redis的list类型实现一个简单的轻量级消息队列，生产者push，消费者pop/bpop。</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line">--------------------------------------------------------------------------------------------------</span><br><span class="line"><span class="comment">#rpush</span></span><br><span class="line"><span class="comment">#lpush</span></span><br><span class="line"><span class="comment">#lrange</span></span><br><span class="line">192.168.2.1:6379&gt; rpush list1 1         <span class="comment"># 创建列表并在尾部添加元素 &#123;追加&#125;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">192.168.2.1:6379&gt; rpush list1 2</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">192.168.1.1:6379&gt; lrange list1 0 -1     <span class="comment"># 获取list中所有的元素值！</span></span><br><span class="line">1) <span class="string">&quot;1&quot;</span></span><br><span class="line">2) <span class="string">&quot;2&quot;</span></span><br><span class="line">192.168.2.1:6379&gt; lpush list1 one       <span class="comment"># 将一个值或者多个值，添加到列表头部 &#123;插入&#125;</span></span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">192.168.2.1:6379&gt; lpush list1 two</span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br><span class="line">192.168.2.1:6379&gt; lrange list1 0 -1</span><br><span class="line">1) <span class="string">&quot;two&quot;</span></span><br><span class="line">2) <span class="string">&quot;one&quot;</span></span><br><span class="line">3) <span class="string">&quot;1&quot;</span></span><br><span class="line">4) <span class="string">&quot;2&quot;</span></span><br><span class="line">192.168.2.1:6379&gt; lrange list1 1 2      <span class="comment"># 通过区间获取具体的值！</span></span><br><span class="line">1) <span class="string">&quot;one&quot;</span></span><br><span class="line">2) <span class="string">&quot;1&quot;</span></span><br><span class="line">--------------------------------------------------------------------------------------------------</span><br><span class="line"><span class="comment">#lpop</span></span><br><span class="line"><span class="comment">#rpop</span></span><br><span class="line">192.168.2.1:6379&gt; lrange list1 0 -1</span><br><span class="line">1) <span class="string">&quot;two&quot;</span></span><br><span class="line">2) <span class="string">&quot;one&quot;</span></span><br><span class="line">3) <span class="string">&quot;1&quot;</span></span><br><span class="line">4) <span class="string">&quot;2&quot;</span></span><br><span class="line">192.168.2.1:6379&gt; lpop list1           <span class="comment"># 移除list1的第一个元素</span></span><br><span class="line"><span class="string">&quot;two&quot;</span></span><br><span class="line">192.168.2.1:6379&gt; rpop list1           <span class="comment"># 移除list1的最后一个元素</span></span><br><span class="line"><span class="string">&quot;2&quot;</span></span><br><span class="line">192.168.2.1:6379&gt; lrange list1 0 -1</span><br><span class="line">1) <span class="string">&quot;one&quot;</span></span><br><span class="line">2) <span class="string">&quot;1&quot;</span></span><br><span class="line">--------------------------------------------------------------------------------------------------</span><br><span class="line"><span class="comment">#lindex</span></span><br><span class="line">192.168.2.1:6379&gt; lrange list1 0 -1</span><br><span class="line">1) <span class="string">&quot;one&quot;</span></span><br><span class="line">2) <span class="string">&quot;1&quot;</span></span><br><span class="line">192.168.2.1:6379&gt; lindex list1 1       <span class="comment"># 通过下标获得 list 中的某一个值！</span></span><br><span class="line"><span class="string">&quot;1&quot;</span></span><br><span class="line">192.168.2.1:6379&gt; lindex list1 0</span><br><span class="line"><span class="string">&quot;one&quot;</span></span><br><span class="line">--------------------------------------------------------------------------------------------------</span><br><span class="line"><span class="comment">#Llen</span></span><br><span class="line">192.168.2.1:6379&gt; lpush list2 one two three three</span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br><span class="line">192.168.2.1:6379&gt; llen list2           <span class="comment"># 返回列表的长度</span></span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br><span class="line">--------------------------------------------------------------------------------------------------</span><br><span class="line"><span class="comment">#移除指定的值！</span></span><br><span class="line"><span class="comment">#取关 uid</span></span><br><span class="line"><span class="comment">#Lrem</span></span><br><span class="line">192.168.2.1:6379&gt; lrange list2 0 -1</span><br><span class="line">1) <span class="string">&quot;three&quot;</span></span><br><span class="line">2) <span class="string">&quot;three&quot;</span></span><br><span class="line">3) <span class="string">&quot;two&quot;</span></span><br><span class="line">4) <span class="string">&quot;one&quot;</span></span><br><span class="line">192.168.2.1:6379&gt; lrem list2 1 one          <span class="comment"># 移除list2列表中指定个数的value，精确匹配</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">192.168.2.1:6379&gt; lrange list2 0 -1</span><br><span class="line">1) <span class="string">&quot;three&quot;</span></span><br><span class="line">2) <span class="string">&quot;three&quot;</span></span><br><span class="line">3) <span class="string">&quot;two&quot;</span></span><br><span class="line">192.168.2.1:6379&gt; lrem list2 2 three</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">192.168.2.1:6379&gt; lrange list2 0 -1</span><br><span class="line">1) <span class="string">&quot;two&quot;</span></span><br><span class="line">--------------------------------------------------------------------------------------------------</span><br><span class="line"><span class="comment">#ltrim : list 截断!</span></span><br><span class="line">192.168.2.1:6379&gt; rpush mylist <span class="string">&#x27;hello-1&#x27;</span> <span class="string">&#x27;hello-2&#x27;</span> <span class="string">&#x27;hello-3&#x27;</span> <span class="string">&#x27;hello-4&#x27;</span></span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br><span class="line">192.168.2.1:6379&gt; ltrim mylist 1 2    <span class="comment"># 通过下标截取指定的长度，这个list已经被改变了，截断了只剩下截取的元素！</span></span><br><span class="line">OK</span><br><span class="line">192.168.2.1:6379&gt; lrange mylist 0 -1</span><br><span class="line">1) <span class="string">&quot;hello-2&quot;</span></span><br><span class="line">2) <span class="string">&quot;hello-3&quot;</span></span><br><span class="line">--------------------------------------------------------------------------------------------------</span><br><span class="line"><span class="comment">#rpoplpush : 移除列表的最后一个元素，将他移动到新的列表中！</span></span><br><span class="line">192.168.2.1:6379&gt; rpush mylist <span class="string">&quot;hello&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">192.168.2.1:6379&gt; lrange mylist 0 -1</span><br><span class="line">1) <span class="string">&quot;hello-2&quot;</span></span><br><span class="line">2) <span class="string">&quot;hello-3&quot;</span></span><br><span class="line">3) <span class="string">&quot;hello&quot;</span></span><br><span class="line">192.168.2.1:6379&gt; rpoplpush mylist myotherlist      <span class="comment"># 将列表最后一个元素移动到新的列表中</span></span><br><span class="line"><span class="string">&quot;hello&quot;</span></span><br><span class="line">192.168.2.1:6379&gt; lrange mylist 0 -1                <span class="comment"># 查看原来的列表</span></span><br><span class="line">1) <span class="string">&quot;hello-2&quot;</span></span><br><span class="line">2) <span class="string">&quot;hello-3&quot;</span></span><br><span class="line">192.168.2.1:6379&gt; lrange myotherlist 0 -1           <span class="comment"># 查看目标列表中，确实存在改值</span></span><br><span class="line">1) <span class="string">&quot;hello&quot;</span></span><br><span class="line">--------------------------------------------------------------------------------------------------</span><br><span class="line"><span class="comment">#lset : 将列表中指定下标的值替换为另外一个值，更新操作</span></span><br><span class="line">192.168.2.1:6379&gt; exists list3             <span class="comment"># 判断这个列表是否存在</span></span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">192.168.2.1:6379&gt; lset list3 0 <span class="string">&#x27;item&#x27;</span>      <span class="comment"># 如果不存在列表我们去更新就会报错</span></span><br><span class="line">(error) ERR no such key</span><br><span class="line">192.168.2.1:6379&gt; lpush list3 <span class="string">&#x27;value1&#x27;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">192.168.2.1:6379&gt; LRANGE list3 0 -1</span><br><span class="line">1) <span class="string">&quot;value1&quot;</span></span><br><span class="line">192.168.2.1:6379&gt; lset list3 0 <span class="string">&#x27;item&#x27;</span>      <span class="comment"># 如果存在，更新当前下标的值</span></span><br><span class="line">OK</span><br><span class="line">192.168.2.1:6379&gt; LRANGE list3 0 -1</span><br><span class="line">1) <span class="string">&quot;item&quot;</span></span><br><span class="line">--------------------------------------------------------------------------------------------------</span><br><span class="line"><span class="comment">#linsert : 将某个具体的value插入到列把你中某个元素的前面或者后面！</span></span><br><span class="line">192.168.2.1:6379&gt; rpush list4 <span class="string">&quot;hello&quot;</span> <span class="string">&quot;world&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">192.168.2.1:6379&gt; linsert list4 before <span class="string">&quot;world&quot;</span> <span class="string">&quot;other&quot;</span>        <span class="comment"># 插入</span></span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">192.168.2.1:6379&gt; lrange list4 0 -1</span><br><span class="line">1) <span class="string">&quot;hello&quot;</span></span><br><span class="line">2) <span class="string">&quot;other&quot;</span></span><br><span class="line">3) <span class="string">&quot;world&quot;</span></span><br><span class="line">192.168.2.1:6379&gt; linsert list4 after <span class="string">&#x27;world&#x27;</span> <span class="string">&#x27;new&#x27;</span>           <span class="comment"># 追加</span></span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br><span class="line">192.168.2.1:6379&gt; lrange list4 0 -1</span><br><span class="line">1) <span class="string">&quot;hello&quot;</span></span><br><span class="line">2) <span class="string">&quot;other&quot;</span></span><br><span class="line">3) <span class="string">&quot;world&quot;</span></span><br><span class="line">4) <span class="string">&quot;new&quot;</span></span><br><span class="line">--------------------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>



<h2 id="Set（集合）"><a href="#Set（集合）" class="headerlink" title="Set（集合）"></a>Set（集合）</h2><blockquote>
<p><strong>概述：</strong>可以理解为一堆值不重复的列表，类似数学领域中的集合概念，且Redis也提供了针对集合的求交集、并集、差集等操作。set 的内部实现是一个 value永远为null的HashMap，实际就是通过计算hash的方式来快速排重的，这也是set能提供判断一个成员是否在集合内的原因。</p>
<p><strong>场景：</strong>Redis set对外提供的功能与list类似是一个列表的功能，特殊之处在于set是可以自动排重的，当你需要存储一个列表数据，又不希望出现重复数据时，set是一个很好的选择，并且set提供了判断某个成员是否在一个set集合内的重要接口，这个也是list所不能提供的。又或者在微博应用中，每个用户关注的人存在一个集合中，就很容易实现求两个人的共同好友功能。</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line">--------------------------------------------------------------------------------------------------</span><br><span class="line"><span class="comment">#sadd ：创建集合并赋值</span></span><br><span class="line"><span class="comment">#smembers ：查看集合的值</span></span><br><span class="line"><span class="comment">#sismember ：判断某一个值是不是在set集合中！</span></span><br><span class="line">192.168.2.1:6379&gt; sadd myset <span class="string">&quot;one&quot;</span>              <span class="comment"># 创建myset并赋值one</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">192.168.2.1:6379&gt; sadd myset <span class="string">&quot;two&quot;</span> <span class="string">&quot;three&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">192.168.2.1:6379&gt; smembers myset                <span class="comment"># 查看指定set的所有值</span></span><br><span class="line">1) <span class="string">&quot;two&quot;</span></span><br><span class="line">2) <span class="string">&quot;one&quot;</span></span><br><span class="line">3) <span class="string">&quot;three&quot;</span></span><br><span class="line">192.168.2.1:6379&gt; sismember myset <span class="string">&#x27;one&#x27;</span>         <span class="comment"># 判断某一个值是不是在set集合中！</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">192.168.2.1:6379&gt; sismember myset <span class="string">&#x27;ten&#x27;</span></span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">--------------------------------------------------------------------------------------------------</span><br><span class="line"><span class="comment">#scard</span></span><br><span class="line">192.168.2.1:6379&gt; scard myset                   <span class="comment"># 获取set集合中的内容元素个数！</span></span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">--------------------------------------------------------------------------------------------------</span><br><span class="line"><span class="comment">#srem ：移除</span></span><br><span class="line">192.168.2.1:6379&gt; srem myset <span class="string">&#x27;one&#x27;</span>              <span class="comment"># 移除set集合中的指定元素</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">192.168.2.1:6379&gt; scard myset</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">192.168.2.1:6379&gt; smembers myset</span><br><span class="line">1) <span class="string">&quot;two&quot;</span></span><br><span class="line">2) <span class="string">&quot;three&quot;</span></span><br><span class="line">--------------------------------------------------------------------------------------------------</span><br><span class="line"><span class="comment">#set 无序不重复集合。抽随机！</span></span><br><span class="line">127.0.0.1:6379&gt; smembers myset</span><br><span class="line">1) <span class="string">&quot;lovekuangshen2&quot;</span></span><br><span class="line">2) <span class="string">&quot;lovekuangshen&quot;</span></span><br><span class="line">3) <span class="string">&quot;kuangshen&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; srandmember myset  <span class="comment"># 随机抽选出一个元素</span></span><br><span class="line"><span class="string">&quot;kuangshen&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; SRANDMEMBER myset</span><br><span class="line"><span class="string">&quot;kuangshen&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; SRANDMEMBER myset</span><br><span class="line"><span class="string">&quot;kuangshen&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; SRANDMEMBER myset</span><br><span class="line"><span class="string">&quot;kuangshen&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; SRANDMEMBER myset 2  <span class="comment"># 随机抽选出指定个数的元素</span></span><br><span class="line">1) <span class="string">&quot;lovekuangshen&quot;</span></span><br><span class="line">2) <span class="string">&quot;lovekuangshen2&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; SRANDMEMBER myset 2</span><br><span class="line">1) <span class="string">&quot;lovekuangshen&quot;</span></span><br><span class="line">2) <span class="string">&quot;lovekuangshen2&quot;</span></span><br><span class="line"></span><br><span class="line">192.168.2.1:6379&gt; sadd myset <span class="string">&quot;one&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">192.168.2.1:6379&gt; smembers myset</span><br><span class="line">1) <span class="string">&quot;one&quot;</span></span><br><span class="line">2) <span class="string">&quot;two&quot;</span></span><br><span class="line">3) <span class="string">&quot;three&quot;</span></span><br><span class="line">192.168.2.1:6379&gt; srandmember myset       <span class="comment"># 随机抽选出一个元素</span></span><br><span class="line"><span class="string">&quot;three&quot;</span></span><br><span class="line">192.168.2.1:6379&gt; srandmember myset</span><br><span class="line"><span class="string">&quot;two&quot;</span></span><br><span class="line">192.168.2.1:6379&gt; srandmember myset</span><br><span class="line"><span class="string">&quot;one&quot;</span></span><br><span class="line">192.168.2.1:6379&gt; srandmember myset 2     <span class="comment"># 随机抽选出指定个数的元素</span></span><br><span class="line">1) <span class="string">&quot;two&quot;</span></span><br><span class="line">2) <span class="string">&quot;one&quot;</span></span><br><span class="line">192.168.2.1:6379&gt; srandmember myset 2</span><br><span class="line">1) <span class="string">&quot;two&quot;</span></span><br><span class="line">2) <span class="string">&quot;three&quot;</span></span><br><span class="line">--------------------------------------------------------------------------------------------------</span><br><span class="line"><span class="comment">#spop : 随机删除key！</span></span><br><span class="line">192.168.2.1:6379&gt; smembers myset</span><br><span class="line">1) <span class="string">&quot;one&quot;</span></span><br><span class="line">2) <span class="string">&quot;two&quot;</span></span><br><span class="line">3) <span class="string">&quot;three&quot;</span></span><br><span class="line">192.168.2.1:6379&gt; spop myset          <span class="comment"># 随机删除一些set集合中的元素！</span></span><br><span class="line"><span class="string">&quot;two&quot;</span></span><br><span class="line">192.168.2.1:6379&gt; spop myset</span><br><span class="line"><span class="string">&quot;one&quot;</span></span><br><span class="line">192.168.2.1:6379&gt; smembers myset</span><br><span class="line">1) <span class="string">&quot;three&quot;</span></span><br><span class="line">--------------------------------------------------------------------------------------------------</span><br><span class="line"><span class="comment">#smove : 将一个指定的值，移动到另外一个set集合！</span></span><br><span class="line">192.168.2.1:6379&gt; sadd myset <span class="string">&quot;hello&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">192.168.2.1:6379&gt; smembers myset</span><br><span class="line">1) <span class="string">&quot;hello&quot;</span></span><br><span class="line">2) <span class="string">&quot;three&quot;</span></span><br><span class="line">192.168.2.1:6379&gt; smove myset myset2 <span class="string">&quot;hello&quot;</span>      <span class="comment"># 将一个指定的值，移动到另外一个set集合！</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">192.168.2.1:6379&gt; smembers myset</span><br><span class="line">1) <span class="string">&quot;three&quot;</span></span><br><span class="line">192.168.2.1:6379&gt; smembers myset2</span><br><span class="line">1) <span class="string">&quot;hello&quot;</span></span><br><span class="line">--------------------------------------------------------------------------------------------------</span><br><span class="line"><span class="comment">#微博，B站，共同关注！(并集)</span></span><br><span class="line"><span class="comment">#数字集合类：</span></span><br><span class="line"><span class="comment">#- 差集 SDIFF</span></span><br><span class="line"><span class="comment">#- 交集 SINTER</span></span><br><span class="line"><span class="comment">#- 并集 SUNION</span></span><br><span class="line">192.168.2.1:6379&gt; sadd set1 a b c</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">192.168.2.1:6379&gt; sadd set2 c d e</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">192.168.2.1:6379&gt; SDIFF set1 set2        <span class="comment"># 差集  不同的</span></span><br><span class="line">1) <span class="string">&quot;b&quot;</span></span><br><span class="line">2) <span class="string">&quot;a&quot;</span></span><br><span class="line">192.168.2.1:6379&gt; SINTER set1 set2       <span class="comment"># 交集  相同的; 共同好友就可以这样实现</span></span><br><span class="line">1) <span class="string">&quot;c&quot;</span></span><br><span class="line">192.168.2.1:6379&gt; SUNION set1 set2       <span class="comment"># 并集  共同的</span></span><br><span class="line">1) <span class="string">&quot;e&quot;</span></span><br><span class="line">2) <span class="string">&quot;c&quot;</span></span><br><span class="line">3) <span class="string">&quot;a&quot;</span></span><br><span class="line">4) <span class="string">&quot;b&quot;</span></span><br><span class="line">5) <span class="string">&quot;d&quot;</span></span><br><span class="line">--------------------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>



<h2 id="Zset（有序集合）"><a href="#Zset（有序集合）" class="headerlink" title="Zset（有序集合）"></a>Zset（有序集合）</h2><blockquote>
<p><strong>概述：</strong>有序集合 类似 无序集合，它只是在set的基础上，增加了一个值，set k1 v1 zset k1 score1 v1</p>
<p><strong>场景：</strong>Redis sorted set的使用场景与set类似，区别是set不是自动有序的，而sorted set可以通过用户额外提供一个优先级(score)的参数来为成员排序，并且是插入有序的，即自动排序。当你需要一个有序的并且不重复的集合列表，那么可以选择sorted set数据结构。</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">--------------------------------------------------------------------------------------------------</span><br><span class="line"><span class="comment">#zadd ：创建有序集合</span></span><br><span class="line">192.168.2.1:6379&gt; zadd myzset1 1 <span class="string">&#x27;one&#x27;</span>                 <span class="comment"># 添加一个值</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">192.168.2.1:6379&gt; zadd myzset1 2 <span class="string">&#x27;two&#x27;</span> 3 <span class="string">&#x27;three&#x27;</span>       <span class="comment"># 添加多个值</span></span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">192.168.2.1:6379&gt; zrange myzset1 0 -1</span><br><span class="line">1) <span class="string">&quot;one&quot;</span></span><br><span class="line">2) <span class="string">&quot;two&quot;</span></span><br><span class="line">3) <span class="string">&quot;three&quot;</span></span><br><span class="line">--------------------------------------------------------------------------------------------------</span><br><span class="line"><span class="comment">#ZRANGEBYSCORE ：实现排序</span></span><br><span class="line">192.168.2.1:6379&gt; zadd salary 2500 zhangsan          <span class="comment"># 添加三个用户</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">192.168.2.1:6379&gt; zadd salary 3500 lisi</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">192.168.2.1:6379&gt; zadd salary 4500 wangwu</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">192.168.2.1:6379&gt; zrangebyscore salary -inf +inf     <span class="comment"># 显示全部的用户 从小到大！</span></span><br><span class="line">1) <span class="string">&quot;zhangsan&quot;</span></span><br><span class="line">2) <span class="string">&quot;lisi&quot;</span></span><br><span class="line">3) <span class="string">&quot;wangwu&quot;</span></span><br><span class="line">192.168.2.1:6379&gt; zrevrange salary 0 -1              <span class="comment"># 从大到小进行排序！</span></span><br><span class="line">1) <span class="string">&quot;wangwu&quot;</span></span><br><span class="line">2) <span class="string">&quot;lisi&quot;</span></span><br><span class="line">3) <span class="string">&quot;zhangsan&quot;</span></span><br><span class="line">192.168.2.1:6379&gt; zrangebyscore salary -inf +inf withscores      <span class="comment"># 显示全部的用户并且附带成绩</span></span><br><span class="line">1) <span class="string">&quot;zhangsan&quot;</span></span><br><span class="line">2) <span class="string">&quot;2500&quot;</span></span><br><span class="line">3) <span class="string">&quot;lisi&quot;</span></span><br><span class="line">4) <span class="string">&quot;3500&quot;</span></span><br><span class="line">5) <span class="string">&quot;wangwu&quot;</span></span><br><span class="line">6) <span class="string">&quot;4500&quot;</span></span><br><span class="line">192.168.2.1:6379&gt; zrangebyscore salary -inf 3500 withscores      <span class="comment"># 显示工资小于等于3500员工的升序排序！</span></span><br><span class="line">1) <span class="string">&quot;zhangsan&quot;</span></span><br><span class="line">2) <span class="string">&quot;2500&quot;</span></span><br><span class="line">3) <span class="string">&quot;lisi&quot;</span></span><br><span class="line">4) <span class="string">&quot;3500&quot;</span></span><br><span class="line">--------------------------------------------------------------------------------------------------</span><br><span class="line"><span class="comment"># 移除rem中的元素</span></span><br><span class="line">192.168.2.1:6379&gt; zrange salary 0 -1</span><br><span class="line">1) <span class="string">&quot;zhangsan&quot;</span></span><br><span class="line">2) <span class="string">&quot;lisi&quot;</span></span><br><span class="line">3) <span class="string">&quot;wangwu&quot;</span></span><br><span class="line">192.168.2.1:6379&gt; zrem salary lisi        <span class="comment"># 移除有序集合中的指定元素</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">192.168.2.1:6379&gt; zrange salary 0 -1</span><br><span class="line">1) <span class="string">&quot;zhangsan&quot;</span></span><br><span class="line">2) <span class="string">&quot;wangwu&quot;</span></span><br><span class="line">192.168.2.1:6379&gt; zcard salary            <span class="comment"># 获取有序集合中的个数</span></span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">--------------------------------------------------------------------------------------------------</span><br><span class="line">192.168.2.1:6379&gt; zadd myzset2 1 hello 2 world 3 good</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">192.168.2.1:6379&gt; zcount myzset2 1 3      <span class="comment"># 获取指定区间的成员数量！</span></span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">192.168.2.1:6379&gt; zcount myzset2 1 2</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br></pre></td></tr></table></figure>



<h2 id="Hash（哈希）"><a href="#Hash（哈希）" class="headerlink" title="Hash（哈希）"></a>Hash（哈希）</h2><blockquote>
<p><strong>概述：</strong>Map集合，key-map! 时候这个值是一个map集合！ 本质和String类型没有太大区别，还是一个简单的key-vlaue！</p>
<p><strong>场景：</strong>假设有多个用户及对应的用户信息，可以用来存储以用户ID为key，将用户信息序列化为比如json格式做为value进行保存</p>
</blockquote>
<p><strong>hash变更的数据 user, 尤其是是用户信息之类的，经常变动的信息！ hash 更适合于对象的存储，String更加适合字符串存储！</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">--------------------------------------------------------------------------------------------------</span><br><span class="line">192.168.2.1:6379&gt; hset myhash1 field1 <span class="string">&#x27;cool&#x27;</span>      <span class="comment"># set一个具体 key-vlaue</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">192.168.2.1:6379&gt; hmset myhash1 field1 <span class="string">&#x27;hello&#x27;</span> field2 <span class="string">&#x27;world&#x27;</span>      <span class="comment"># set多个 key-vlaue</span></span><br><span class="line">OK</span><br><span class="line">192.168.2.1:6379&gt; hget myhash1 field1             <span class="comment"># 获取一个字段值</span></span><br><span class="line"><span class="string">&quot;hello&quot;</span></span><br><span class="line">192.168.2.1:6379&gt; hmget myhash1 field1 field2     <span class="comment"># 获取多个字段值</span></span><br><span class="line">1) <span class="string">&quot;hello&quot;</span></span><br><span class="line">2) <span class="string">&quot;world&quot;</span></span><br><span class="line">192.168.2.1:6379&gt; hgetall myhash1                 <span class="comment"># 获取全部的数据，</span></span><br><span class="line">1) <span class="string">&quot;field1&quot;</span></span><br><span class="line">2) <span class="string">&quot;hello&quot;</span></span><br><span class="line">3) <span class="string">&quot;field2&quot;</span></span><br><span class="line">4) <span class="string">&quot;world&quot;</span></span><br><span class="line">192.168.2.1:6379&gt; hdel myhash1 field1             <span class="comment"># 删除hash指定key字段！对应的value值也就消失了！</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">192.168.2.1:6379&gt; hgetall myhash1</span><br><span class="line">1) <span class="string">&quot;field2&quot;</span></span><br><span class="line">2) <span class="string">&quot;world&quot;</span></span><br><span class="line">--------------------------------------------------------------------------------------------------</span><br><span class="line"><span class="comment">#hlen</span></span><br><span class="line">192.168.2.1:6379&gt; hmset myhash2 field1 <span class="string">&#x27;hello&#x27;</span> field2 <span class="string">&#x27;world&#x27;</span></span><br><span class="line">OK</span><br><span class="line">192.168.2.1:6379&gt; hgetall myhash2</span><br><span class="line">1) <span class="string">&quot;field1&quot;</span></span><br><span class="line">2) <span class="string">&quot;hello&quot;</span></span><br><span class="line">3) <span class="string">&quot;field2&quot;</span></span><br><span class="line">4) <span class="string">&quot;world&quot;</span></span><br><span class="line">192.168.2.1:6379&gt; hlen myhash2            <span class="comment"># 获取hash表的字段数量！</span></span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">--------------------------------------------------------------------------------------------------</span><br><span class="line">192.168.2.1:6379&gt; hexists myhash2 field1  <span class="comment"># 判断hash中指定字段是否存在！</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">192.168.2.1:6379&gt; hexists myhash2 field3</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">--------------------------------------------------------------------------------------------------</span><br><span class="line">192.168.2.1:6379&gt; hkeys myhash2           <span class="comment"># 只获得所有field</span></span><br><span class="line">1) <span class="string">&quot;field1&quot;</span></span><br><span class="line">2) <span class="string">&quot;field2&quot;</span></span><br><span class="line">192.168.2.1:6379&gt; hvals myhash2           <span class="comment"># 只获得所有value</span></span><br><span class="line">1) <span class="string">&quot;hello&quot;</span></span><br><span class="line">2) <span class="string">&quot;world&quot;</span></span><br><span class="line">--------------------------------------------------------------------------------------------------</span><br><span class="line"><span class="comment">#incr  decr</span></span><br><span class="line">192.168.2.1:6379&gt; hset myhash2 field3 <span class="string">&#x27;5&#x27;</span>           <span class="comment">#指定增量！</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">192.168.2.1:6379&gt; hincrby myhash2 field3 1</span><br><span class="line">(<span class="built_in">integer</span>) 6</span><br><span class="line">192.168.2.1:6379&gt; hincrby myhash2 field3 -1</span><br><span class="line">(<span class="built_in">integer</span>) 5</span><br><span class="line">192.168.2.1:6379&gt; hsetnx myhash2 field4 hello       <span class="comment"># 如果不存在则可以设置</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">192.168.2.1:6379&gt; hsetnx myhash2 field4 world       <span class="comment"># 如果存在则不能设置</span></span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">--------------------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>





<h1 id="Redis-事务"><a href="#Redis-事务" class="headerlink" title="Redis 事务"></a>Redis 事务</h1><blockquote>
<p><strong>Redis事务的概念</strong></p>
</blockquote>
<p>Redis 事务的本质是一组命令的集合。事务支持一次执行多个命令，一个事务中所有命令都会被序列化。在事务执行过程，会按照顺序串行化执行队列中的命令，其他客户端提交的命令请求不会插入到事务执行命令序列中。</p>
<p>Redis事务实际上就是一次性、顺序性、排他性的执行一个队列中的一系列命令。所有的命令在事务中，并没有直接被执行！只有发起执行命令的时候才会执行！</p>
<p><strong>Redis事务没有隔离级别的概念;</strong>   批量操作在发送 EXEC 命令前被放入队列缓存，并不会被实际执行，也就不存在事务内的查询要看到事务里的更新，事务外查询不能看到。</p>
<p>**Redis不保证原子性; ** Redis中，单条命令是原子性执行的，但事务不保证原子性，且没有回滚。事务中任意命令执行失败，其余的命令仍会被执行。</p>
<h2 id="Redis事务相关命令"><a href="#Redis事务相关命令" class="headerlink" title="Redis事务相关命令"></a>Redis事务相关命令</h2><table>
<thead>
<tr>
<th align="left">命令</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">WATCH  key  key …</td>
<td align="left">监视一或多个key, 如果在事务执行之前，被监视的key被其他命令改动，则事务被打断（类似乐观锁 ）</td>
</tr>
<tr>
<td align="left">MULTI</td>
<td align="left">标记一个事务块的开始</td>
</tr>
<tr>
<td align="left">EXEC</td>
<td align="left">执行所有事务块内的命令</td>
</tr>
<tr>
<td align="left">DISCARD</td>
<td align="left">取消事务，放弃执行事务块内的所有命令</td>
</tr>
<tr>
<td align="left">UNWATCH</td>
<td align="left">取消 WATCH 命令对所有 key 的监视</td>
</tr>
</tbody></table>
<h2 id="Redis事务的3个阶段"><a href="#Redis事务的3个阶段" class="headerlink" title="Redis事务的3个阶段"></a>Redis事务的3个阶段</h2><ul>
<li>开启事务（multi）</li>
<li>命令入队（……）</li>
<li>执行事务（exec）</li>
</ul>
<h2 id="Redis事务使用案例"><a href="#Redis事务使用案例" class="headerlink" title="Redis事务使用案例"></a>Redis事务使用案例</h2><blockquote>
<p><strong>正常执行事务！</strong></p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">192.168.2.1:6379&gt; multi          <span class="comment"># 开启事务</span></span><br><span class="line">OK</span><br><span class="line">192.168.2.1:6379&gt; <span class="built_in">set</span> k1 <span class="string">&#x27;v1&#x27;</span>    <span class="comment"># 命令入队</span></span><br><span class="line">QUEUED</span><br><span class="line">192.168.2.1:6379&gt; <span class="built_in">set</span> k2 <span class="string">&#x27;v2&#x27;</span></span><br><span class="line">QUEUED</span><br><span class="line">192.168.2.1:6379&gt; get k2</span><br><span class="line">QUEUED</span><br><span class="line">192.168.2.1:6379&gt; <span class="built_in">set</span> k3 <span class="string">&#x27;v3&#x27;</span></span><br><span class="line">QUEUED</span><br><span class="line">192.168.2.1:6379&gt; <span class="built_in">exec</span>           <span class="comment"># 执行事务</span></span><br><span class="line">1) OK</span><br><span class="line">2) OK</span><br><span class="line">3) <span class="string">&quot;v2&quot;</span></span><br><span class="line">4) OK</span><br><span class="line">192.168.2.1:6379&gt; keys *         <span class="comment">#检查事务中的命令是否成功执行</span></span><br><span class="line">1) <span class="string">&quot;k3&quot;</span></span><br><span class="line">2) <span class="string">&quot;k2&quot;</span></span><br><span class="line">3) <span class="string">&quot;k1&quot;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>放弃事务！</strong></p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">192.168.2.1:6379&gt; multi          <span class="comment"># 开启事务</span></span><br><span class="line">OK</span><br><span class="line">192.168.2.1:6379&gt; <span class="built_in">set</span> k4 <span class="string">&#x27;v4&#x27;</span></span><br><span class="line">QUEUED</span><br><span class="line">192.168.2.1:6379&gt; <span class="built_in">set</span> k5 <span class="string">&#x27;v5&#x27;</span></span><br><span class="line">QUEUED</span><br><span class="line">192.168.2.1:6379&gt; DISCARD        <span class="comment"># 取消事务</span></span><br><span class="line">OK</span><br><span class="line">192.168.2.1:6379&gt; keys *         <span class="comment"># 事务队列中命令都不会被执行！</span></span><br><span class="line">1) <span class="string">&quot;k3&quot;</span></span><br><span class="line">2) <span class="string">&quot;k2&quot;</span></span><br><span class="line">3) <span class="string">&quot;k1&quot;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>编译型异常</strong>（源代码有问题！ 命令有错！） ，事务中所有的命令都不会被执行！</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">192.168.2.1:6379&gt; multi         <span class="comment"># 开始事务</span></span><br><span class="line">OK</span><br><span class="line">192.168.2.1:6379&gt; <span class="built_in">set</span> k4 <span class="string">&#x27;v4&#x27;</span></span><br><span class="line">QUEUED</span><br><span class="line">192.168.2.1:6379&gt; <span class="built_in">set</span> k5 <span class="string">&#x27;v5&#x27;</span></span><br><span class="line">QUEUED</span><br><span class="line">192.168.2.1:6379&gt; getset k5     <span class="comment"># 执行错误的命令</span></span><br><span class="line">(error) ERR wrong number of arguments <span class="keyword">for</span> <span class="string">&#x27;getset&#x27;</span> <span class="built_in">command</span></span><br><span class="line">192.168.2.1:6379&gt; <span class="built_in">set</span> k6 <span class="string">&#x27;v6&#x27;</span></span><br><span class="line">QUEUED</span><br><span class="line">192.168.2.1:6379&gt; <span class="built_in">exec</span>          <span class="comment"># 执行事务报错！</span></span><br><span class="line">(error) EXECABORT Transaction discarded because of previous errors.</span><br><span class="line">192.168.2.1:6379&gt; keys *        <span class="comment"># 所有的命令都不会被执行！</span></span><br><span class="line">1) <span class="string">&quot;k3&quot;</span></span><br><span class="line">2) <span class="string">&quot;k2&quot;</span></span><br><span class="line">3) <span class="string">&quot;k1&quot;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>运行时异常</strong>（1/0）， 如果事务队列中存在语法性，那么执行命令的时候，其他命令是可以正常执行的，错误命令抛出异常！</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">192.168.2.1:6379&gt; <span class="built_in">set</span> k4 <span class="string">&#x27;v4&#x27;</span></span><br><span class="line">OK</span><br><span class="line">192.168.2.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">192.168.2.1:6379&gt; incr k4              <span class="comment"># 会执行的时候失败！</span></span><br><span class="line">QUEUED</span><br><span class="line">192.168.2.1:6379&gt; <span class="built_in">set</span> k5 <span class="string">&#x27;v5&#x27;</span></span><br><span class="line">QUEUED</span><br><span class="line">192.168.2.1:6379&gt; get k5</span><br><span class="line">QUEUED</span><br><span class="line">192.168.2.1:6379&gt; <span class="built_in">exec</span>                 <span class="comment"># 虽然第一条事务命令报错了，但是依旧正常执行成功了！</span></span><br><span class="line">1) (error) ERR value is not an <span class="built_in">integer</span> or out of range</span><br><span class="line">2) OK</span><br><span class="line">3) <span class="string">&quot;v5&quot;</span></span><br><span class="line">192.168.2.1:6379&gt; keys *</span><br><span class="line">1) <span class="string">&quot;k2&quot;</span></span><br><span class="line">2) <span class="string">&quot;k1&quot;</span></span><br><span class="line">3) <span class="string">&quot;k5&quot;</span></span><br><span class="line">4) <span class="string">&quot;k4&quot;</span></span><br><span class="line">5) <span class="string">&quot;k3&quot;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>监控</strong>！ Watch （面试常问！）</p>
</blockquote>
<p><strong>悲观锁：</strong></p>
<ul>
<li>很悲观，认为什么时候都会出问题，无论做什么都会加锁！</li>
</ul>
<p><strong>乐观锁：</strong></p>
<ul>
<li>很乐观，认为什么时候都不会出问题，所以不会上锁！ 更新数据的时候去判断一下，在此期间是否有人修改过这个数据</li>
</ul>
<blockquote>
<p><strong>Redis监控测试</strong></p>
</blockquote>
<p>正常执行成功！</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">192.168.2.1:6379&gt; <span class="built_in">set</span> money 100</span><br><span class="line">OK</span><br><span class="line">192.168.2.1:6379&gt; <span class="built_in">set</span> out 0</span><br><span class="line">OK</span><br><span class="line">192.168.2.1:6379&gt; watch money         <span class="comment"># 监视 money 对象</span></span><br><span class="line">OK</span><br><span class="line">192.168.2.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">192.168.2.1:6379&gt; decrby money 20</span><br><span class="line">QUEUED</span><br><span class="line">192.168.2.1:6379&gt; incrby out 20</span><br><span class="line">QUEUED</span><br><span class="line">192.168.2.1:6379&gt; <span class="built_in">exec</span>               <span class="comment"># 事务正常结束，数据期间没有发生变动，这个时候就正常执行成功！</span></span><br><span class="line">1) (<span class="built_in">integer</span>) 80</span><br><span class="line">2) (<span class="built_in">integer</span>) 20</span><br></pre></td></tr></table></figure>

<p>模拟测试多线程修改值 , 使用 watch 可以当做redis的乐观锁操作！</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">192.168.2.1:6379&gt; watch money       <span class="comment"># 监视 money</span></span><br><span class="line">OK</span><br><span class="line">192.168.2.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">192.168.2.1:6379&gt; decrby money 10</span><br><span class="line">QUEUED</span><br><span class="line">192.168.2.1:6379&gt; incrby out 10</span><br><span class="line">QUEUED</span><br><span class="line">192.168.2.1:6379&gt; <span class="built_in">exec</span>              <span class="comment"># 执行之前，另外一个线程，修改了我们的值，这个时候，就会导致事务执行失败！</span></span><br><span class="line">(nil)</span><br></pre></td></tr></table></figure>

<p>那怎么解决这个问题呢？</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gric55q4fdj30qq0bkgmu.jpg" alt="image-20200630200813319"></p>
<h1 id="Redis-持久化"><a href="#Redis-持久化" class="headerlink" title="Redis 持久化"></a>Redis 持久化</h1><h2 id="持久化概述"><a href="#持久化概述" class="headerlink" title="持久化概述"></a>持久化概述</h2><blockquote>
<p><strong>作用：</strong></p>
<ul>
<li>Redis的所有数据都是保存在内存中, 如果没有配置持久化, redis重启后数据就全丢失了, 于是需要开启redis的持久化功能, 将数据保存到磁盘上, 当redis重启后, 可以从磁盘中恢复数据。</li>
<li>那么不定期的通过异步方式保存到磁盘上（半持久化模式）; 也可以把每一次数据变化都写入到一个append only file里面（全持久化模式）。 如若在服务器中开启了两种持久化的方式，默认执行AOF持久化方式。</li>
</ul>
<p><strong>实现方式：</strong></p>
<ul>
<li><p>RDB持久化：将Reids在内存中的数据库记录,定时dump到磁盘上，<em><strong>类似于快照功能</strong></em>。</p>
</li>
<li><p>AOF持久化：原理是将Reids的操作日志以追加的方式写入文件，<em><strong>近似实时性</strong></em>。</p>
</li>
<li><p>默认redis用的就是RDB方式的持久化，如果两种持久化都开启的话，则优先使用AOF</p>
</li>
</ul>
<p><strong>二者区别：</strong></p>
<ul>
<li><em><strong>RDB</strong></em>持久化是指在指定的时间间隔内将内存中的数据集快照写入磁盘，实际操作过程是fork一个子进程，先将数据集写入临时文件，写入成功后，再替换之前的文件，用二进制压缩存储。</li>
<li><em><strong>AOF</strong></em>持久化是以日志的形式记录服务器所处理的每一个写、删除操作，查询操作不会记录，以文本的方式记录，可以打开文件看到详细的操作记录。</li>
</ul>
<p><strong>应用场景：</strong></p>
<ul>
<li><p>愿意牺牲一些性能（选择AOF）；</p>
</li>
<li><p>换取更高的缓存一致性，保证数据库最高可能的完整性（选择AOF）；</p>
</li>
<li><p>愿意写操作频繁的时候，不启用备份来换取更高的性能，待手动运行save的时候，再做备份（RDB）；</p>
</li>
</ul>
</blockquote>
<h2 id="RDB（Redis-DataBase）"><a href="#RDB（Redis-DataBase）" class="headerlink" title="RDB（Redis DataBase）"></a>RDB（Redis DataBase）</h2><blockquote>
<p><strong>什么是RDB ?</strong></p>
<p>在指定的时间间隔内将内存中的数据集快照写入磁盘, 也就是行话讲的Snapshot快照, 它恢复时是将快照文件直接读到内存里。</p>
<p>Redis会单独创建（fork）一个子进程来进行持久化，会先将数据写入到一个临时文件中，待持久化过程都结束了，再用这个临时文件替换上次持久化好的文件。整个过程中，主进程是不进行任何IO操作的。这就确保了极高的性能。如果需要进行大规模数据的恢复，且对于数据恢复的完整性不是非常敏感，那RDB方式要比AOF方式更加的高效。RDB的缺点是最后一次持久化后的数据可能丢失。我们默认的就是RDB，一般情况下不需要修改这个配置！</p>
<p>有时候在生产环境我们会将这个文件进行备份！（dump.rdb）</p>
<p><strong>优点：</strong></p>
<ul>
<li>适合大规模的数据恢复！</li>
<li>对数据的完整性要不高！</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>需要一定的时间间隔进程操作！如果redis意外宕机了，这个最后一次修改数据就没有的了！</li>
<li>fork进程的时候，会占用一定的内容空间！！</li>
</ul>
</blockquote>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gric5b7phvj60yv0trdhf02.jpg" alt="image-20200630065642027"></p>
<p><strong>rdb保存的文件是dump.rdb</strong> 都是在配置文件中快照中进行配置的！</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 开启RDB快照功能，在900秒内完成一个key值得变动触发快照功能，如若将所有save配置项都注释掉，那么则将关闭RDB快照功能</span></span><br><span class="line">218 save 900 1</span><br><span class="line">219 save 300 10</span><br><span class="line">220 save 60 10000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 当RDB快照后台进程失败，不影响用户得写操作</span></span><br><span class="line">235 stop-writes-on-bgsave-error yes</span><br><span class="line"></span><br><span class="line"><span class="comment"># 是否将RDB快照文件压缩，关闭后会增加性能</span></span><br><span class="line">241 rdbcompression yes</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭RDB快照文件的检查校验，增加性能</span></span><br><span class="line">250 rdbchecksum no</span><br><span class="line"></span><br><span class="line"><span class="comment"># 快照文件的名称</span></span><br><span class="line">253 dbfilename dump.rdb</span><br><span class="line"></span><br><span class="line"><span class="comment"># 快照文件的存储路径</span></span><br><span class="line">263 dir /usr/<span class="built_in">local</span>/redis/</span><br></pre></td></tr></table></figure>

<p><strong>测试一下：</strong></p>
<blockquote>
<p><em><strong>只要 60s 内修改了 2 次 key，就会触发 RDB 操作</strong></em></p>
</blockquote>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gric5e05y5j30op07s74h.jpg" alt="image-20200630092722202"></p>
<blockquote>
<p><strong>触发机制</strong></p>
</blockquote>
<p>1、save的规则满足的情况下，会自动触发rdb规则</p>
<p>2、执行 flushall 命令，也会触发我们的rdb规则！</p>
<p>3、退出redis，也会产生 rdb 文件！</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gric5g9h25j30qp03e0sn.jpg" alt="image-20200630094131322"></p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gric5hq4kgj30th05v0su.jpg" alt="image-20200630094206024"></p>
<blockquote>
<p><strong>恢复rdb文件</strong></p>
</blockquote>
<p>1、redis在启动的时候会自动检查dump.rdb 恢复其中的数据！</p>
<p>2、查看需要存在的位置</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">192.168.2.1:6379&gt; config get dir</span><br><span class="line">1) <span class="string">&quot;dir&quot;</span></span><br><span class="line">2) <span class="string">&quot;/usr/local/redis&quot;</span></span><br></pre></td></tr></table></figure>



<h2 id="AOF（Append-Only-File）"><a href="#AOF（Append-Only-File）" class="headerlink" title="AOF（Append Only File）"></a>AOF（Append Only File）</h2><blockquote>
<p><strong>什么是AOF ？</strong></p>
<ul>
<li><p>就相当于我们的所有命令都记录下来，history，恢复的时候就把这个文件全部在执行一遍！</p>
</li>
<li><p>以日志的形式来记录每个写操作, 将Redis执行过的所有指令记录下来（读操作不记录）, 只许追加文件但不可以改写文件, redis启动之初会读取该文件重新构建数据，换言之，redis重启的话就根据日志文件的内容将写指令从前到后执行一次以完成数据的恢复工作。</p>
</li>
</ul>
<p><strong>AOF 文件的生成过程具体包括命令追加，文件写入，文件同步三个步骤。</strong> </p>
<ul>
<li>AOF保存的是 appendonly.aof 文件</li>
<li>Redis 打开 AOF 持久化功能后，Redis 在执行完一个写命令后，都会将执行的写命令追回到 Redis 内部的缓冲区的末尾。这个过程是命令的追加过程。 接下来，缓冲区的写命令会被写入到 AOF 文件，这一过程是文件写入过程。对于操作系统来说，调用write函数并不会立刻将数据写入到硬盘，为了将数据真正写入硬盘，还需要调用fsync函数，调用fsync函数即是文件同步的过程。只有经过文件同步过程，AOF 文件才在硬盘中真正保存了 Redis 的写命令。appendfsync 配置选项正是用来配置将写命令同步到文件的频率的，各个选项的值的含义如表 1 所示。而值为no的话表示为写入AOF文件，但是不进行磁盘同步，根据linux系统默认进行磁盘同步，默认30s，效率是最高的。</li>
</ul>
<p><strong>优点：</strong></p>
<ul>
<li>每一次修改都同步，文件的完整会更加好！</li>
<li>每秒同步一次，可能会丢失一秒的数据</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>相对于数据文件来说，aof远远大于 rdb，修复的速度也比 rdb慢！</li>
<li>AOF 运行效率也要比 rdb 慢，所以我们redis默认的配置就是rdb持久化！</li>
</ul>
</blockquote>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gric5liurrj30xb0rbq5h.jpg" alt="image-20200630065829868"></p>
<p><strong>aof保存的文件是 appendonly.aof</strong> 都是在配置文件中快照中进行配置的！</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 关闭RDB持久化</span></span><br><span class="line">218 <span class="comment">#save 900 1</span></span><br><span class="line">219 <span class="comment">#save 300 10</span></span><br><span class="line">220 <span class="comment">#save 60 10000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 开启AOF持久化方式</span></span><br><span class="line">672 appendonly yes</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定AOF持久化的文件名</span></span><br><span class="line">676 appendfilename <span class="string">&quot;appendonly.aof&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 同步频率，具体参数见下方表一</span></span><br><span class="line">702 appendfsync everysec</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如若设置为yes，则redis执行的命令会存放到缓冲区，待系统自动同步到硬盘</span></span><br><span class="line">724 no-appendfsync-on-rewrite no</span><br><span class="line"></span><br><span class="line"><span class="comment">#若当前写入的AOF文件达到了上次rewrite文件大小的100%，则触发rewrite操作</span></span><br><span class="line">743 auto-aof-rewrite-percentage 100</span><br><span class="line"></span><br><span class="line"><span class="comment">#设置AOF持久化重写文件的最小值，当达到60M并且符合100%的条件时，则触发rewrite操作</span></span><br><span class="line">744 auto-aof-rewrite-min-size 64mb</span><br></pre></td></tr></table></figure>

<p><strong>同步频率级别（推荐no | everysec）</strong></p>
<table>
<thead>
<tr>
<th>频率级别</th>
<th>频率作用</th>
</tr>
</thead>
<tbody><tr>
<td>always</td>
<td>每个Redis 命令都要同步写入硬盘；这个级别严重降低 Redis的性能</td>
</tr>
<tr>
<td>everysec</td>
<td>每秒执行一次同步，显示的将 写 多个命令同步到硬盘</td>
</tr>
<tr>
<td>no</td>
<td>让操作系统来决定如何进行同步</td>
</tr>
</tbody></table>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gric5p8qxyj30s306bmx7.jpg" alt="image-20200630100833103"></p>
<p>默认是不开启的，我们需要手动进行配置！我们只需要将 appendonly 改为yes就开启了 aof ;  重启 redis 就可以生效了！</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gric5ufcs3j30p006lgly.jpg" alt="image-20200630101058952"></p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gric5r2o4oj30rb02emx6.jpg" alt="image-20200630103558878"></p>
<blockquote>
<p><strong>触发机制</strong></p>
</blockquote>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gric5vteb6j30qb0ea74l.jpg" alt="image-20200630103844193"></p>
<blockquote>
<p><strong>重写规则说明</strong></p>
</blockquote>
<p>aof 默认就是文件的无限追加，文件会越来越大！</p>
<p>如果 aof 文件大于了 64mb，Redis 会重新 fork一个新的进程来将我们的文件进行重写！</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gric60xe87j30ug0jxwfy.jpg" alt="image-20200630105249045"></p>
<h2 id="RDB转换AOF持久化"><a href="#RDB转换AOF持久化" class="headerlink" title="RDB转换AOF持久化"></a>RDB转换AOF持久化</h2><blockquote>
<p><strong>RDB持久化的数据，当改为AOF持久化的时候，数据是无法同步的，倘若想要RDB里边的数据，操作如下：</strong></p>
<p><em><strong>建议：不要轻易改变持久化的方式</strong></em></p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">[root@redis01 ~]<span class="comment"># vim /usr/local/redis/conf/redis.conf</span></span><br><span class="line">218 save 900 1            <span class="comment">#暂时开启rdb</span></span><br><span class="line">219 save 300 10</span><br><span class="line">220 save 60 10000</span><br><span class="line">672 appendonly no         <span class="comment">#暂时关掉aof</span></span><br><span class="line">:wq!</span><br><span class="line">[root@redis01 ~]<span class="comment"># /etc/init.d/redis restart</span></span><br><span class="line">[root@redis01 ~]<span class="comment"># redis-cli -h 192.168.2.1 -p 6379 -a 123456</span></span><br><span class="line">192.168.2.1:6379&gt; keys *</span><br><span class="line">1) <span class="string">&quot;name&quot;</span></span><br><span class="line">2) <span class="string">&quot;age&quot;</span></span><br><span class="line">192.168.2.1:6379&gt; save</span><br><span class="line">192.168.2.1:6379&gt; config <span class="built_in">set</span> appendonly yes</span><br><span class="line">192.168.2.1:6379&gt; save</span><br><span class="line">192.168.2.1:6379&gt; shutdown save</span><br><span class="line">not connected&gt; <span class="built_in">exit</span></span><br><span class="line"><span class="comment"># 最后修改配置文件，把RDB改成AOF</span></span><br><span class="line">[root@redis01 ~]<span class="comment"># vim /usr/local/redis/conf/redis.conf</span></span><br><span class="line">218 <span class="comment">#save 900 1            #关闭rdb</span></span><br><span class="line">219 <span class="comment">#save 300 10</span></span><br><span class="line">220 <span class="comment">#save 60 10000</span></span><br><span class="line">672 appendonly yes         <span class="comment">#开启aof</span></span><br><span class="line">:wq!</span><br><span class="line">[root@redis01 ~]<span class="comment"># /etc/init.d/redis restart</span></span><br><span class="line">[root@redis01 ~]<span class="comment"># redis-cli -h 192.168.2.1 -p 6379 -a 123123</span></span><br><span class="line">192.168.2.1:6379&gt; keys *</span><br><span class="line">1) <span class="string">&quot;age&quot;</span></span><br><span class="line">2) <span class="string">&quot;name&quot;</span></span><br><span class="line">192.168.2.1:6379&gt; <span class="built_in">exit</span></span><br><span class="line">[root@redis01 ~]<span class="comment"># cat /usr/local/redis/appendonly.aof </span></span><br><span class="line">*2</span><br><span class="line"><span class="variable">$6</span></span><br><span class="line">SELECT</span><br><span class="line"><span class="variable">$1</span></span><br><span class="line">0</span><br><span class="line">*3</span><br><span class="line"><span class="variable">$3</span></span><br><span class="line">SET</span><br><span class="line"><span class="variable">$4</span></span><br><span class="line">name</span><br><span class="line"><span class="variable">$5</span></span><br><span class="line">lemon</span><br><span class="line">*3</span><br><span class="line"><span class="variable">$3</span></span><br><span class="line">SET</span><br><span class="line"><span class="variable">$3</span></span><br><span class="line">age</span><br><span class="line"><span class="variable">$2</span></span><br><span class="line">18</span><br></pre></td></tr></table></figure>



<h2 id="持久化总结"><a href="#持久化总结" class="headerlink" title="持久化总结"></a>持久化总结</h2><p>1、RDB 持久化方式能够在指定的时间间隔内对你的数据进行快照存储</p>
<p>2、AOF 持久化方式记录每次对服务器写的操作，当服务器重启的时候会重新执行这些命令来恢复原始的数据，AOF命令以Redis 协议追加保存每次写的操作到文件末尾，Redis还能对AOF文件进行后台重写，使得AOF文件的体积不至于过大。</p>
<p>3、只做缓存，如果你只希望你的数据在服务器运行的时候存在，你也可以不使用任何持久化</p>
<p>4、同时开启两种持久化方式</p>
<ul>
<li><p>在这种情况下，当redis重启的时候会优先载入AOF文件来恢复原始的数据，因为在通常情况下AOF文件保存的数据集要比RDB文件保存的数据集要完整。</p>
</li>
<li><p>RDB 的数据不实时，同时使用两者时服务器重启也只会找AOF文件，那要不要只使用AOF呢？作者建议不要，因为RDB更适合用于备份数据库（AOF在不断变化不好备份），快速重启，而且不会有AOF可能潜在的Bug，留着作为一个万一的手段。</p>
</li>
</ul>
<p>5、性能建议</p>
<ul>
<li>因为RDB文件只用作后备用途，建议只在Slave上持久化RDB文件，而且只要15分钟备份一次就够了，只保留 save 900 1 这条规则。</li>
<li>如果Enable AOF ，好处是在最恶劣情况下也只会丢失不超过两秒数据，启动脚本较简单只load自己的AOF文件就可以了，代价一是带来了持续的IO，二是AOF rewrite 的最后将 rewrite 过程中产生的新数据写到新文件造成的阻塞几乎是不可避免的。只要硬盘许可，应该尽量减少AOF rewrite的频率，AOF重写的基础大小默认值64M太小了，可以设到5G以上，默认超过原大小100%大小重写可以改到适当的数值。</li>
<li>如果不Enable AOF ，仅靠 Master-Slave Repllcation 实现高可用性也可以，能省掉一大笔IO，也减少了rewrite时带来的系统波动。代价是如果Master/Slave 同时倒掉，会丢失十几分钟的数据，启动脚本也要比较两个 Master/Slave 中的 RDB文件，载入较新的那个，微博就是这种架构。</li>
</ul>
<h1 id="Redis缓存穿透和雪崩"><a href="#Redis缓存穿透和雪崩" class="headerlink" title="Redis缓存穿透和雪崩"></a><strong>Redis缓存穿透和雪崩</strong></h1><blockquote>
<p><strong>服务的高可用问题！</strong></p>
</blockquote>
<p>在这里我们不会详细的区分析解决方案的底层！</p>
<p>Redis缓存的使用，极大的提升了应用程序的性能和效率，特别是数据查询方面。但同时，它也带来了一些问题。其中，最要害的问题，就是数据的一致性问题，从严格意义上讲，这个问题无解。如果对数据的一致性要求很高，那么就不能使用缓存。</p>
<p>另外的一些典型问题就是，缓存穿透、缓存雪崩和缓存击穿。目前，业界也都有比较流行的解决方案。</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gric65n9lzj30yi0gc40s.jpg" alt="image-20200630225949201"></p>
<h2 id="缓存穿透（查不到）"><a href="#缓存穿透（查不到）" class="headerlink" title="缓存穿透（查不到）"></a>缓存穿透（查不到）</h2><blockquote>
<p><strong>概念</strong></p>
</blockquote>
<p>缓存穿透的概念很简单，用户想要查询一个数据，发现redis内存数据库没有，也就是缓存没有命中，于是向持久层数据库查询。发现也没有，于是本次查询失败。当用户很多的时候，缓存都没有命中（秒杀！），于是都去请求了持久层数据库。这会给持久层数据库造成很大的压力，这时候就相当于出现了缓存穿透。</p>
<blockquote>
<p><strong>解决方案</strong></p>
</blockquote>
<p><em><strong>1、布隆过滤器</strong></em></p>
<p>布隆过滤器是一种数据结构，对所有可能查询的参数以hash形式存储，在控制层先进行校验，不符合则<br>丢弃，从而避免了对底层存储系统的查询压力；</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gric69tttcj30al0a7wft.jpg" alt="image-20200630230148135"></p>
<p><em><strong>2、缓存空对象</strong></em></p>
<p>当存储层不命中后，即使返回的空对象也将其缓存起来，同时会设置一个过期时间，之后再访问这个数据将会从缓存中获取，保护了后端数据源；</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gric6ey651j308i0a10tq.jpg" alt="image-20200630230349775"></p>
<p>但是这种方法会存在两个问题：</p>
<p>1、如果空值能够被缓存起来，这就意味着缓存需要更多的空间存储更多的键，因为这当中可能会有很多的空值的键；</p>
<p>2、即使对空值设置了过期时间，还是会存在缓存层和存储层的数据会有一段时间窗口的不一致，这对于需要保持一致性的业务会有影响。</p>
<h2 id="缓存击穿（量太大，缓存过期！）"><a href="#缓存击穿（量太大，缓存过期！）" class="headerlink" title="缓存击穿（量太大，缓存过期！）"></a>缓存击穿（量太大，缓存过期！）</h2><blockquote>
<p><strong>概述</strong></p>
</blockquote>
<p>这里需要注意和缓存击穿的区别，缓存击穿，是指一个key非常热点，在不停的扛着大并发，大并发集中对这一个点进行访问，当这个key在失效的瞬间，持续的大并发就穿破缓存，直接请求数据库，就像在一个屏障上凿开了一个洞。</p>
<p>当某个key在过期的瞬间, 有大量的请求并发访问, 这类数据一般是热点数据, 由于缓存过期, 会同时访问数据库来查询最新数据，并且回写缓存，会导使数据库瞬间压力过大。</p>
<blockquote>
<p><strong>解决方案</strong></p>
</blockquote>
<p><em><strong>1、设置热点数据永不过期</strong></em></p>
<p>从缓存层面来看，没有设置过期时间，所以不会出现热点 key 过期后产生的问题。</p>
<p><em><strong>2、加互斥锁</strong></em></p>
<p>分布式锁：使用分布式锁，保证对于每个key同时只有一个线程去查询后端服务，其他线程没有获得分布式锁的权限，因此只需要等待即可。这种方式将高并发的压力转移到了分布式锁，因此对分布式锁的考验很大。</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gric6k6ey3j60xd0dyt9s02.jpg" alt="image-20200630230709208"></p>
<h2 id="缓存雪崩"><a href="#缓存雪崩" class="headerlink" title="缓存雪崩"></a>缓存雪崩</h2><blockquote>
<p><strong>概念</strong></p>
</blockquote>
<p>缓存雪崩，是指在某一个时间段，缓存集中过期失效。Redis 宕机！</p>
<p>产生雪崩的原因之一, 比如在写本文的时候, 马上就要到双十二零点, 很快就会迎来一波抢购, 这波商品时间比较集中的放入了缓存,假设缓存一个小时。那么到了凌晨一点钟的时候, 这批商品的缓存就都过期了。而对这批商品的访问查询, 都落到了数据库上，对于数据库而言，就会产生周期性的压力波峰。于是所有的请求都会达到存储层，存储层的调用量会暴增，造成存储层也会挂掉的情况。</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gric6neu3xj30xj0jygs9.jpg" alt="image-20200630230859339"></p>
<p>其实集中过期，倒不是非常致命，比较致命的缓存雪崩，是缓存服务器某个节点宕机或断网。因为自然形成的缓存雪崩，一定是在某个时间段集中创建缓存，这个时候，数据库也是可以顶住压力的。无非就是对数据库产生周期性的压力而已。而缓存服务节点的宕机，对数据库服务器造成的压力是不可预知的，很有可能瞬间就把数据库压垮。</p>
<blockquote>
<p><strong>解决方案</strong></p>
</blockquote>
<p><em><strong>1、redis高可用</strong></em></p>
<p>这个思想的含义是，既然redis有可能挂掉，那我多增设几台redis，这样一台挂掉之后其他的还可以继续工作，其实就是搭建的集群。（异地多活！）</p>
<p><em><strong>2、限流降级</strong></em></p>
<p>这个解决方案的思想是，在缓存失效后，通过加锁或者队列来控制读数据库写缓存的线程数量。比如对某个key只允许一个线程查询数据和写缓存，其他线程等待。</p>
<p><em><strong>3、数据预热</strong></em></p>
<p>数据加热的含义就是在正式部署之前，我先把可能的数据先预先访问一遍，这样部分可能大量访问的数据就会加载到缓存中。在将发生大并发访问前手动触发加载缓存不同的key，设置不同的过期时间，让缓存失效的时间点尽量均匀。</p>

    </div>

    
    
    

      <div>
        
          <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>

        
      </div>

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/06/15/Zabbix/" rel="prev" title="Zabbix">
      <i class="fa fa-chevron-left"></i> Zabbix
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/06/15/KVM%E8%99%9A%E6%8B%9F%E5%8C%96/" rel="next" title="KVM虚拟化">
      KVM虚拟化 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Redis%E5%85%A5%E9%97%A8"><span class="nav-text">Redis入门</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Redis-%E6%A6%82%E8%BF%B0"><span class="nav-text">Redis 概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Redis%E7%9A%84%E6%95%B0%E6%8D%AE%E5%9B%9E%E6%94%B6%E7%AD%96%E7%95%A5"><span class="nav-text">Redis的数据回收策略</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Redis-%E5%BA%94%E7%94%A8%E9%83%A8%E7%BD%B2"><span class="nav-text">Redis 应用部署</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%A6%E8%A7%A3"><span class="nav-text">配置文件详解</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Redis-%E6%B5%8B%E8%AF%95%E6%80%A7%E8%83%BD"><span class="nav-text">Redis 测试性能</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Redis-%E5%9F%BA%E7%A1%80Key-Value"><span class="nav-text">Redis 基础Key-Value</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Redis%E4%B8%AD%E6%93%8D%E4%BD%9C%E4%B9%8B%E5%85%B6%E4%BB%96%E6%93%8D%E4%BD%9C"><span class="nav-text">Redis中操作之其他操作</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Redis%E4%BA%94%E5%A4%A7%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="nav-text">Redis五大数据类型</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#String%EF%BC%88%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%89"><span class="nav-text">String（字符串）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#List%EF%BC%88%E5%88%97%E8%A1%A8%EF%BC%89"><span class="nav-text">List（列表）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Set%EF%BC%88%E9%9B%86%E5%90%88%EF%BC%89"><span class="nav-text">Set（集合）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Zset%EF%BC%88%E6%9C%89%E5%BA%8F%E9%9B%86%E5%90%88%EF%BC%89"><span class="nav-text">Zset（有序集合）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hash%EF%BC%88%E5%93%88%E5%B8%8C%EF%BC%89"><span class="nav-text">Hash（哈希）</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Redis-%E4%BA%8B%E5%8A%A1"><span class="nav-text">Redis 事务</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Redis%E4%BA%8B%E5%8A%A1%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4"><span class="nav-text">Redis事务相关命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Redis%E4%BA%8B%E5%8A%A1%E7%9A%843%E4%B8%AA%E9%98%B6%E6%AE%B5"><span class="nav-text">Redis事务的3个阶段</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Redis%E4%BA%8B%E5%8A%A1%E4%BD%BF%E7%94%A8%E6%A1%88%E4%BE%8B"><span class="nav-text">Redis事务使用案例</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Redis-%E6%8C%81%E4%B9%85%E5%8C%96"><span class="nav-text">Redis 持久化</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8C%81%E4%B9%85%E5%8C%96%E6%A6%82%E8%BF%B0"><span class="nav-text">持久化概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RDB%EF%BC%88Redis-DataBase%EF%BC%89"><span class="nav-text">RDB（Redis DataBase）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#AOF%EF%BC%88Append-Only-File%EF%BC%89"><span class="nav-text">AOF（Append Only File）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RDB%E8%BD%AC%E6%8D%A2AOF%E6%8C%81%E4%B9%85%E5%8C%96"><span class="nav-text">RDB转换AOF持久化</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8C%81%E4%B9%85%E5%8C%96%E6%80%BB%E7%BB%93"><span class="nav-text">持久化总结</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Redis%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F%E5%92%8C%E9%9B%AA%E5%B4%A9"><span class="nav-text">Redis缓存穿透和雪崩</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F%EF%BC%88%E6%9F%A5%E4%B8%8D%E5%88%B0%EF%BC%89"><span class="nav-text">缓存穿透（查不到）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BC%93%E5%AD%98%E5%87%BB%E7%A9%BF%EF%BC%88%E9%87%8F%E5%A4%AA%E5%A4%A7%EF%BC%8C%E7%BC%93%E5%AD%98%E8%BF%87%E6%9C%9F%EF%BC%81%EF%BC%89"><span class="nav-text">缓存击穿（量太大，缓存过期！）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BC%93%E5%AD%98%E9%9B%AA%E5%B4%A9"><span class="nav-text">缓存雪崩</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Armin"
      src="/uploads/armin.png">
  <p class="site-author-name" itemprop="name">Armin</p>
  <div class="site-description" itemprop="description">记录生活中的点点滴滴</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">18</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/" title="GitHub → https:&#x2F;&#x2F;github.com" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://aws.amazon.com/cn/" title="AWS → https:&#x2F;&#x2F;aws.amazon.com&#x2F;cn&#x2F;" rel="noopener" target="_blank"><i class="fab fa-aws fa-fw"></i>AWS</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.processon.com/" title="processon → https:&#x2F;&#x2F;www.processon.com&#x2F;" rel="noopener" target="_blank"><i class="fab fa-accusoft fa-fw"></i>processon</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.cn-ki.net/" title="知识库 → https:&#x2F;&#x2F;www.cn-ki.net&#x2F;" rel="noopener" target="_blank"><i class="fas fa-book-open fa-fw"></i>知识库</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tophub.today/" title="看新闻 → https:&#x2F;&#x2F;tophub.today&#x2F;" rel="noopener" target="_blank"><i class="far fa-newspaper fa-fw"></i>看新闻</a>
      </span>
      <span class="links-of-author-item">
        <a href="http://m.zxjsq.net/" title="计算器 → http:&#x2F;&#x2F;m.zxjsq.net" rel="noopener" target="_blank"><i class="fas fa-calculator fa-fw"></i>计算器</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://shijisuishu.bmcx.com/20010314__shijisuishu/" title="计龄器 → https:&#x2F;&#x2F;shijisuishu.bmcx.com&#x2F;20010314__shijisuishu&#x2F;" rel="noopener" target="_blank"><i class="fas fa-calculator fa-fw"></i>计龄器</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tool.oschina.net/hexconvert" title="进制转换 → https:&#x2F;&#x2F;tool.oschina.net&#x2F;hexconvert" rel="noopener" target="_blank"><i class="fas fa-calculator fa-fw"></i>进制转换</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.sojson.com/convert/subnetmask.html" title="子网计算 → https:&#x2F;&#x2F;www.sojson.com&#x2F;convert&#x2F;subnetmask.html" rel="noopener" target="_blank"><i class="fas fa-calculator fa-fw"></i>子网计算</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.baidu.com/" title="百度一下 → https:&#x2F;&#x2F;www.baidu.com&#x2F;" rel="noopener" target="_blank"><i class="fas fa-search fa-fw"></i>百度一下</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2020 – 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Armin</span>
</div>

<div class="powered-by">

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
